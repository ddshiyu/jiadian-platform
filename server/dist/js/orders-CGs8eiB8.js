var Oe=Object.defineProperty,Ce=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var ae=(c,i,d)=>i in c?Oe(c,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[i]=d,le=(c,i)=>{for(var d in i||(i={}))Te.call(i,d)&&ae(c,d,i[d]);if(te)for(var d of te(i))Ae.call(i,d)&&ae(c,d,i[d]);return c},re=(c,i)=>Ce(c,Ie(i));var $=(c,i,d)=>new Promise((N,b)=>{var T=s=>{try{v(d.next(s))}catch(h){b(h)}},p=s=>{try{v(d.throw(s))}catch(h){b(h)}},v=s=>s.done?N(s.value):Promise.resolve(s.value).then(T,p);v((d=d.apply(c,i)).next())});import{a4 as Fe,cb as Re,aD as J,aE as Ye,aF as O,aI as j,aG as oe,aH as w,n as ne,B as Y,bF as xe,aJ as E,aK as se,aL as G,cc as Pe,o as _,aM as $e}from"./bootstrap-DQlkkZAY.js";import{x as a,a3 as Ue,P as D,T as L,ao as ze,a4 as M,a5 as f,ah as l,aa as t,at as u,aK as I,aB as g,ae as q,au as m,bl as qe}from"../jse/index-index-_HsMvMo5.js";import{T as ue,h as Be,i as je,j as Ee,s as Le,r as Ve}from"./operation-Cao-9zmS.js";import{C as ie}from"./index-CrE2fLll.js";import{D as de,a as k}from"./index-D0b7gJ03.js";import{P as He}from"./index-CQs6e48e.js";import"./Dropdown-BE9qtqDz.js";import"./index-BAe2oAwF.js";var Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"};function pe(c){for(var i=1;i<arguments.length;i++){var d=arguments[i]!=null?Object(arguments[i]):{},N=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(N=N.concat(Object.getOwnPropertySymbols(d).filter(function(b){return Object.getOwnPropertyDescriptor(d,b).enumerable}))),N.forEach(function(b){Ge(c,b,d[b])})}return c}function Ge(c,i,d){return i in c?Object.defineProperty(c,i,{value:d,enumerable:!0,configurable:!0,writable:!0}):c[i]=d,c}var Q=function(i,d){var N=pe({},i,d.attrs);return a(Fe,pe({},N,{icon:Je}),null)};Q.displayName="ReloadOutlined";Q.inheritAttrs=!1;const Qe={class:"table-header"},Ke={class:"table-action"},We={key:0},Xe={key:1,class:"price"},Ze={key:4},et={key:0},tt={key:0},at={key:0,class:"product-info"},lt=["src"],rt={key:1,class:"price"},ot={key:2,class:"price"},nt=Ue({__name:"orders",setup(c){const{RangePicker:i}=Re,d=[{title:"订单信息",key:"orderInfo",width:200},{title:"订单金额",key:"amount",width:100},{title:"订单状态",key:"status",width:120},{title:"支付状态",key:"paymentStatus",width:120},{title:"时间信息",key:"time",width:200},{title:"操作",key:"action",width:200}],N=[{title:"商品信息",key:"product",width:"40%"},{title:"单价",key:"price",width:"15%"},{title:"数量",dataIndex:"quantity",key:"quantity",width:"15%"},{title:"金额",key:"total",width:"15%"}],b=D([]),T=D(!1),p=D(null),v=L({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`共 ${n} 条记录`}),s=L({orderNo:"",userName:"",status:"",paymentStatus:"",startDate:"",endDate:""}),h=D(void 0),B=D(!1),U=D(!1),S=L({orderId:0,company:"",trackingNumber:""}),V=D(null),me={company:[{required:!0,message:"请输入快递公司名称",trigger:"blur",type:"string"}],trackingNumber:[{required:!0,message:"请输入快递单号",trigger:"blur",type:"string"}]},z=D(!1),A=L({orderId:0,remark:""}),H=D(null),ce={remark:[{required:!0,message:"请输入订单备注",trigger:"blur",type:"string"}]},x=D(!1),C=()=>$(this,null,function*(){var n,e;T.value=!0;try{h.value&&h.value.length===2?(s.startDate=h.value[0].format("YYYY-MM-DD"),s.endDate=h.value[1].format("YYYY-MM-DD")):(s.startDate="",s.endDate="");const o={orderNo:s.orderNo,userName:s.userName,status:s.status||void 0,paymentStatus:s.paymentStatus||void 0,startDate:s.startDate||void 0,endDate:s.endDate||void 0,pageNum:v.current,pageSize:v.pageSize};try{const r=yield Be(o);if(r)b.value=r.list||[],v.total=((n=r.pagination)==null?void 0:n.total)||0,v.current=((e=r.pagination)==null?void 0:e.current)||1;else throw new Error("获取订单列表失败: 空响应")}catch(r){console.error("获取订单API失败，使用模拟数据:",r),_.warning("当前使用测试数据，接口异常："+(r.message||r));let y=[...ve()];s.orderNo&&(y=y.filter(R=>R.orderNo.includes(s.orderNo))),s.userName&&(y=y.filter(R=>R.userName.includes(s.userName))),s.status&&(y=y.filter(R=>R.status===s.status)),s.paymentStatus&&(y=y.filter(R=>R.paymentStatus===s.paymentStatus));const ee=(v.current-1)*v.pageSize,Ne=ee+v.pageSize;b.value=y.slice(ee,Ne),v.total=y.length}}catch(o){console.error("获取订单列表失败:",o),_.error("获取订单列表失败"),b.value=[],v.total=0}finally{T.value=!1}}),ve=()=>{const n=["pending_payment","pending_delivery","delivered","completed","cancelled"],e=["unpaid","paid","refunded"];return Array.from({length:25}).map((o,r)=>{const F=n[Math.floor(Math.random()*n.length)],y=F==="pending_payment"?"unpaid":F==="cancelled"?e[Math.floor(Math.random()*e.length)]:"paid";return{id:r+1,orderNo:`ORD${String(r+10001).padStart(5,"0")}`,userId:r+100,userName:`测试用户${r+1}`,totalAmount:Math.floor(Math.random()*1e4)/100+100,status:F,paymentStatus:y,paymentMethod:y!=="unpaid"?"微信支付":void 0,paymentTime:y!=="unpaid"?new Date(Date.now()-Math.random()*864e5*30).toISOString():void 0,deliveryTime:["delivered","completed"].includes(F)?new Date(Date.now()-Math.random()*864e5*15).toISOString():void 0,completionTime:F==="completed"?new Date(Date.now()-Math.random()*864e5*5).toISOString():void 0,cancelTime:F==="cancelled"?new Date(Date.now()-Math.random()*864e5*10).toISOString():void 0,remark:Math.random()>.7?`订单备注${r+1}`:void 0,address:`测试地址${r+1}`,consignee:`收货人${r+1}`,phone:`1380000${String(r+1).padStart(4,"0")}`,createdAt:new Date(Date.now()-Math.random()*864e5*60).toISOString(),updatedAt:new Date(Date.now()-Math.random()*864e5*30).toISOString(),items:[{id:r*2+1,productId:r*3+100,productName:`测试商品${r*2+1}`,price:Math.floor(Math.random()*1e3)/100+50,quantity:Math.floor(Math.random()*5)+1,totalAmount:0,productCover:`https://via.placeholder.com/100?text=商品${r*2+1}`},{id:r*2+2,productId:r*3+101,productName:`测试商品${r*2+2}`,price:Math.floor(Math.random()*1e3)/100+50,quantity:Math.floor(Math.random()*5)+1,totalAmount:0,productCover:`https://via.placeholder.com/100?text=商品${r*2+2}`}]}}).map(o=>(o.items=o.items.map(r=>re(le({},r),{totalAmount:r.price*r.quantity})),o))},fe=()=>{v.current=1,C()},ye=()=>{Object.assign(s,{orderNo:"",userName:"",status:"",paymentStatus:"",startDate:"",endDate:""}),h.value=void 0,v.current=1,C()},ge=n=>{v.current=n.current,v.pageSize=n.pageSize,C()},ke=n=>$(this,null,function*(){try{T.value=!0;try{const e=yield je(n.id);if(e)p.value=e,B.value=!0;else throw new Error("订单详情获取失败: 空响应")}catch(e){console.error("获取订单详情API失败，使用模拟数据:",e),_.warning("当前使用测试数据，接口异常："+(e.message||e)),p.value=n,B.value=!0}}catch(e){console.error("获取订单详情失败:",e),_.error("获取订单详情失败")}finally{T.value=!1}}),be=n=>{S.orderId=n.id,S.company="",S.trackingNumber="",U.value=!0},he=()=>{U.value=!1},Se=()=>$(this,null,function*(){if(V.value)try{yield V.value.validate(),x.value=!0,yield Le(S.orderId,S.trackingNumber,S.company),_.success("发货成功"),U.value=!1,C()}catch(n){console.error("发货失败:",n),_.error("发货失败")}finally{x.value=!1}}),we=n=>$(this,null,function*(){try{yield Ee(n.id,"管理员取消"),_.success("订单已取消"),C()}catch(e){console.error("取消订单失败:",e),_.error("取消订单失败")}}),_e=n=>{A.orderId=n.id,A.remark=n.remark||"",z.value=!0},De=()=>{z.value=!1},Me=()=>$(this,null,function*(){if(H.value)try{yield H.value.validate(),x.value=!0,yield Ve(A.orderId,A.remark),_.success("备注成功"),z.value=!1,C()}catch(n){console.error("备注失败:",n),_.error("备注失败")}finally{x.value=!1}}),P=n=>n?qe(n).format("YYYY-MM-DD HH:mm:ss"):"",K=n=>({pending_payment:"待支付",pending_delivery:"待发货",delivered:"已发货",completed:"已完成",cancelled:"已取消"})[n]||n,W=n=>({pending_payment:"orange",pending_delivery:"blue",delivered:"cyan",completed:"green",cancelled:"red"})[n]||"default",X=n=>({unpaid:"未支付",paid:"已支付",refunded:"已退款"})[n]||n,Z=n=>({unpaid:"orange",paid:"green",refunded:"purple"})[n]||"default";return ze(()=>{C()}),(n,e)=>(f(),M("div",null,[a(t(ie),{bordered:!1,class:"mb-20"},{default:l(()=>[a(t(J),{model:s,layout:"inline",class:"search-form",onSubmit:Ye(fe,["prevent"])},{default:l(()=>[a(t(O),{label:"订单号"},{default:l(()=>[a(t(j),{value:s.orderNo,"onUpdate:value":e[0]||(e[0]=o=>s.orderNo=o),placeholder:"请输入订单号","allow-clear":""},null,8,["value"])]),_:1}),a(t(O),{label:"用户名"},{default:l(()=>[a(t(j),{value:s.userName,"onUpdate:value":e[1]||(e[1]=o=>s.userName=o),placeholder:"请输入用户名","allow-clear":""},null,8,["value"])]),_:1}),a(t(O),{label:"订单状态"},{default:l(()=>[a(t(oe),{value:s.status,"onUpdate:value":e[2]||(e[2]=o=>s.status=o),placeholder:"请选择订单状态",style:{width:"160px"},"allow-clear":""},{default:l(()=>[a(t(w),{value:""},{default:l(()=>e[11]||(e[11]=[u("全部")])),_:1}),a(t(w),{value:"pending_payment"},{default:l(()=>e[12]||(e[12]=[u("待支付")])),_:1}),a(t(w),{value:"pending_delivery"},{default:l(()=>e[13]||(e[13]=[u("待发货")])),_:1}),a(t(w),{value:"delivered"},{default:l(()=>e[14]||(e[14]=[u("已发货")])),_:1}),a(t(w),{value:"completed"},{default:l(()=>e[15]||(e[15]=[u("已完成")])),_:1}),a(t(w),{value:"cancelled"},{default:l(()=>e[16]||(e[16]=[u("已取消")])),_:1})]),_:1},8,["value"])]),_:1}),a(t(O),{label:"支付状态"},{default:l(()=>[a(t(oe),{value:s.paymentStatus,"onUpdate:value":e[3]||(e[3]=o=>s.paymentStatus=o),placeholder:"请选择支付状态",style:{width:"140px"},"allow-clear":""},{default:l(()=>[a(t(w),{value:""},{default:l(()=>e[17]||(e[17]=[u("全部")])),_:1}),a(t(w),{value:"unpaid"},{default:l(()=>e[18]||(e[18]=[u("未支付")])),_:1}),a(t(w),{value:"paid"},{default:l(()=>e[19]||(e[19]=[u("已支付")])),_:1}),a(t(w),{value:"refunded"},{default:l(()=>e[20]||(e[20]=[u("已退款")])),_:1})]),_:1},8,["value"])]),_:1}),a(t(O),{label:"下单时间"},{default:l(()=>[a(t(i),{value:h.value,"onUpdate:value":e[4]||(e[4]=o=>h.value=o),format:"YYYY-MM-DD",placeholder:["开始日期","结束日期"],style:{width:"240px"}},null,8,["value"])]),_:1}),a(t(O),null,{default:l(()=>[a(t(ne),null,{default:l(()=>[a(t(Y),{type:"primary","html-type":"submit"},{default:l(()=>e[21]||(e[21]=[u("查询")])),_:1}),a(t(Y),{onClick:ye},{default:l(()=>e[22]||(e[22]=[u("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(t(ie),{bordered:!1},{default:l(()=>[I("div",Qe,[e[23]||(e[23]=I("div",{class:"table-title"},"订单列表",-1)),I("div",Ke,[a(t(xe),{title:"刷新"},{default:l(()=>[a(t(Y),{onClick:C},{icon:l(()=>[a(t(Q))]),_:1})]),_:1})])]),a(t(ue),{columns:d,"data-source":b.value,loading:T.value,pagination:v,onChange:ge,"row-key":"id"},{bodyCell:l(({column:o,record:r})=>[o.key==="orderInfo"?(f(),M("div",We,[I("div",null,"订单号: "+m(r.orderNo),1),I("div",null,"用户: "+m(r.userName),1)])):g("",!0),o.key==="amount"?(f(),M("div",Xe,"¥"+m(r.totalAmount.toFixed(2)),1)):g("",!0),o.key==="status"?(f(),q(t(E),{key:2,color:W(r.status)},{default:l(()=>[u(m(K(r.status)),1)]),_:2},1032,["color"])):g("",!0),o.key==="paymentStatus"?(f(),q(t(E),{key:3,color:Z(r.paymentStatus)},{default:l(()=>[u(m(X(r.paymentStatus)),1)]),_:2},1032,["color"])):g("",!0),o.key==="time"?(f(),M("div",Ze,[I("div",null,"下单: "+m(P(r.createdAt)),1),r.paymentTime?(f(),M("div",et,"支付: "+m(P(r.paymentTime)),1)):g("",!0)])):g("",!0),o.key==="action"?(f(),q(t(ne),{key:5},{default:l(()=>[a(t(Y),{type:"link",onClick:()=>ke(r)},{default:l(()=>e[24]||(e[24]=[u("详情")])),_:2},1032,["onClick"]),r.status==="pending_delivery"?(f(),q(t(Y),{key:0,type:"link",onClick:()=>be(r)},{default:l(()=>e[25]||(e[25]=[u("发货")])),_:2},1032,["onClick"])):g("",!0),r.status==="pending_payment"?(f(),q(t(He),{key:1,title:"确定取消该订单吗？",onConfirm:()=>we(r),"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[a(t(Y),{type:"link",danger:""},{default:l(()=>e[26]||(e[26]=[u("取消订单")])),_:1})]),_:2},1032,["onConfirm"])):g("",!0),a(t(Y),{type:"link",onClick:()=>_e(r)},{default:l(()=>e[27]||(e[27]=[u("备注")])),_:2},1032,["onClick"])]),_:2},1024)):g("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),a(t(G),{visible:B.value,"onUpdate:visible":e[5]||(e[5]=o=>B.value=o),title:"订单详情",width:"800px",footer:null,maskClosable:!0},{default:l(()=>[p.value?(f(),M("div",tt,[a(t(de),{title:"基本信息",bordered:"",column:2},{default:l(()=>[a(t(k),{label:"订单号"},{default:l(()=>[u(m(p.value.orderNo),1)]),_:1}),a(t(k),{label:"下单时间"},{default:l(()=>[u(m(P(p.value.createdAt)),1)]),_:1}),a(t(k),{label:"用户"},{default:l(()=>[u(m(p.value.userName),1)]),_:1}),a(t(k),{label:"总金额"},{default:l(()=>[u("¥"+m(p.value.totalAmount.toFixed(2)),1)]),_:1}),a(t(k),{label:"订单状态"},{default:l(()=>[a(t(E),{color:W(p.value.status)},{default:l(()=>[u(m(K(p.value.status)),1)]),_:1},8,["color"])]),_:1}),a(t(k),{label:"支付状态"},{default:l(()=>[a(t(E),{color:Z(p.value.paymentStatus)},{default:l(()=>[u(m(X(p.value.paymentStatus)),1)]),_:1},8,["color"])]),_:1}),a(t(k),{label:"支付方式",span:2},{default:l(()=>[u(m(p.value.paymentMethod||"-"),1)]),_:1}),a(t(k),{label:"支付时间",span:2},{default:l(()=>[u(m(p.value.paymentTime?P(p.value.paymentTime):"-"),1)]),_:1}),a(t(k),{label:"发货时间",span:2},{default:l(()=>[u(m(p.value.deliveryTime?P(p.value.deliveryTime):"-"),1)]),_:1}),a(t(k),{label:"完成时间",span:2},{default:l(()=>[u(m(p.value.completionTime?P(p.value.completionTime):"-"),1)]),_:1}),a(t(k),{label:"备注",span:2},{default:l(()=>[u(m(p.value.remark||"-"),1)]),_:1})]),_:1}),a(t(se)),a(t(de),{title:"收货信息",bordered:"",column:1},{default:l(()=>[a(t(k),{label:"收货人"},{default:l(()=>[u(m(p.value.consignee||"-"),1)]),_:1}),a(t(k),{label:"联系电话"},{default:l(()=>[u(m(p.value.phone||"-"),1)]),_:1}),a(t(k),{label:"收货地址"},{default:l(()=>[u(m(p.value.address||"-"),1)]),_:1})]),_:1}),a(t(se)),e[28]||(e[28]=I("h3",null,"商品信息",-1)),a(t(ue),{columns:N,"data-source":p.value.items,pagination:!1,"row-key":"id"},{bodyCell:l(({column:o,record:r})=>[o.key==="product"?(f(),M("div",at,[r.productCover?(f(),M("img",{key:0,src:r.productCover,alt:"商品图片",class:"product-img"},null,8,lt)):g("",!0),I("div",null,m(r.productName),1)])):g("",!0),o.key==="price"?(f(),M("div",rt,"¥"+m(r.price.toFixed(2)),1)):g("",!0),o.key==="total"?(f(),M("div",ot,"¥"+m(r.totalAmount.toFixed(2)),1)):g("",!0)]),_:1},8,["data-source"])])):g("",!0)]),_:1},8,["visible"]),a(t(G),{visible:U.value,"onUpdate:visible":e[8]||(e[8]=o=>U.value=o),title:"订单发货",onOk:Se,confirmLoading:x.value,onCancel:he,okText:"确认发货",cancelText:"取消"},{default:l(()=>[a(t(J),{ref_key:"shipFormRef",ref:V,model:S,rules:me,"label-col":{span:6},"wrapper-col":{span:16}},{default:l(()=>[a(t(O),{label:"快递公司",name:"company"},{default:l(()=>[a(t(j),{value:S.company,"onUpdate:value":e[6]||(e[6]=o=>S.company=o),placeholder:"请输入快递公司名称"},null,8,["value"])]),_:1}),a(t(O),{label:"快递单号",name:"trackingNumber"},{default:l(()=>[a(t(j),{value:S.trackingNumber,"onUpdate:value":e[7]||(e[7]=o=>S.trackingNumber=o),placeholder:"请输入快递单号"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirmLoading"]),a(t(G),{visible:z.value,"onUpdate:visible":e[10]||(e[10]=o=>z.value=o),title:"订单备注",onOk:Me,confirmLoading:x.value,onCancel:De,okText:"确定",cancelText:"取消"},{default:l(()=>[a(t(J),{ref_key:"remarkFormRef",ref:H,model:A,rules:ce,"label-col":{span:4},"wrapper-col":{span:18}},{default:l(()=>[a(t(O),{label:"备注",name:"remark"},{default:l(()=>[a(t(Pe),{value:A.remark,"onUpdate:value":e[9]||(e[9]=o=>A.remark=o),placeholder:"请输入订单备注",rows:4},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirmLoading"])]))}}),yt=$e(nt,[["__scopeId","data-v-421e300e"]]);export{yt as default};
