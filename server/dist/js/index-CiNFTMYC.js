var _=(q,M,R)=>new Promise((u,x)=>{var T=f=>{try{m(R.next(f))}catch(r){x(r)}},k=f=>{try{m(R.throw(f))}catch(r){x(r)}},m=f=>f.done?u(f.value):Promise.resolve(f.value).then(T,k);m((R=R.apply(q,M)).next())});import{cd as ge,o as d,aD as H,aE as ye,aF as c,aI as J,aG as B,aH as b,n as Y,B as D,aJ as K,aK as Q,ca as O,cf as ke,bC as W,cg as be,ce as X,cc as we,aL as Ce,aM as Ie}from"./bootstrap-DQlkkZAY.js";import{a3 as _e,T as j,P as w,J as he,ao as Re,a4 as y,a5 as p,x as t,ah as o,aa as a,at as i,F,ag as Z,ae as L,au as h,aK as g,aB as S,bl as xe}from"../jse/index-index-_HsMvMo5.js";import{q as Pe,x as Se,T as Ue,y as Ae,z as De,A as Le,B as Te,C as ze}from"./operation-Cao-9zmS.js";import{C as ee,P as N}from"./index-CrE2fLll.js";import{P as $e}from"./index-CQs6e48e.js";import"./Dropdown-BE9qtqDz.js";import"./index-BAe2oAwF.js";const Be={class:"table-header"},Me={class:"table-action"},Oe={key:0,class:"product-cover"},je=["src"],Fe={key:1,class:"price"},Ne=["onClick"],qe=["onClick"],Ve={key:0},Ee=["src"],Ge={key:1},He={key:0},Je={key:1},Ye=_e({__name:"index",setup(q){const M=ge(),R=[{title:"商品图片",dataIndex:"cover",key:"cover",width:100},{title:"商品名称",dataIndex:"name",key:"name"},{title:"价格",dataIndex:"price",key:"price",width:100},{title:"分类",dataIndex:"category",key:"category",customRender:({record:l})=>{var e;return((e=l.category)==null?void 0:e.name)||"-"}},{title:"库存",dataIndex:"stock",key:"stock",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"推荐",dataIndex:"isRecommended",key:"isRecommended",width:80},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150},{title:"操作",key:"action",width:200}],u=j({name:"",categoryId:null,status:null,isRecommended:null}),x=w([]),T=w([]),k=w(!1),m=j({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:l=>`共 ${l} 条数据`}),f=w(null),r=j({id:0,name:"",description:"",price:0,originalPrice:0,stock:0,categoryId:void 0,status:"off_sale",cover:"",images:[],isRecommended:!1}),ae={name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}],status:[{required:!0,message:"请选择商品状态",trigger:"change"}],stock:[{required:!0,message:"请输入库存数量",trigger:"blur"}]},z=w([]),C=w([]),P=w(!1),$=w(!1),te=he(()=>r.id?"编辑商品":"新增商品"),V={Authorization:`Bearer ${M.accessToken}`},le=l=>{if(l.file.status!=="uploading")if(l.file.status==="done"){const e=l.file.response;e.code===0?(r.cover=`http://8.140.251.91${e.data.image.url}`,d.success("封面图上传成功")):d.error("封面图上传失败")}else l.file.status==="error"&&d.error("封面图上传失败")},se=l=>{const e=[...l.fileList].slice(0,5);C.value=e,l.file.status==="done"?l.file.response.code===0&&(r.images=C.value.filter(n=>{var v,U,A;return((A=(U=(v=n.response)==null?void 0:v.data)==null?void 0:U.image)==null?void 0:A.url)||n.url}).map(n=>{var v,U,A;return`http://8.140.251.91${(A=(U=(v=n.response)==null?void 0:v.data)==null?void 0:U.image)==null?void 0:A.url}`}),d.success("商品图片上传成功")):l.file.status==="error"&&d.error("商品图片上传失败")};Re(()=>{oe(),I()});const oe=()=>_(this,null,function*(){try{const l=yield Pe();l&&l.list&&(x.value=re(l.list))}catch(l){console.error("获取分类选项失败:",l),d.error("获取分类选项失败")}}),re=l=>l.filter(e=>!e.parentId||e.parentId===0).map(e=>({id:e.id,name:e.name})),I=()=>_(this,null,function*(){k.value=!0;try{const l={keyword:u.name,categoryId:u.categoryId||void 0,status:u.status||void 0,isRecommended:u.isRecommended,pageNum:m.current,pageSize:m.pageSize},e=yield Se(l);e&&(T.value=e.list,m.total=e.total),k.value=!1}catch(l){console.error("获取商品列表失败:",l),d.error("获取商品列表失败"),k.value=!1}}),ie=l=>{l.current&&(m.current=l.current),l.pageSize&&(m.pageSize=l.pageSize),I()},ne=()=>{m.current=1,I()},de=()=>{Object.assign(u,{name:"",categoryId:null,status:null,isRecommended:null}),m.current=1,I()},ue=()=>{Object.assign(r,{id:0,name:"",description:"",price:0,originalPrice:0,stock:0,categoryId:void 0,status:"off_sale",cover:"",images:[],isRecommended:!1}),z.value=[],C.value=[],P.value=!0},ce=l=>_(this,null,function*(){try{k.value=!0;const e=yield Ae(l.id);if(k.value=!1,e){const s={id:e.id||0,name:e.name,description:e.description||"",price:e.price,originalPrice:e.originalPrice||0,stock:e.stock,categoryId:e.categoryId,status:e.status,cover:e.cover||"",images:e.images||[],isRecommended:e.isRecommended||!1};Object.assign(r,s),z.value=e.cover?[{uid:"-1",name:"cover.jpg",url:e.cover}]:[],C.value=(e.images||[]).map((n,v)=>({uid:`-${v+1}`,name:`image-${v}.jpg`,url:n})),P.value=!0}}catch(e){k.value=!1,console.error("获取商品详情失败:",e),d.error("获取商品详情失败")}}),pe=l=>_(this,null,function*(){try{yield De(l.id),d.success("删除成功"),I()}catch(e){console.error("删除商品失败:",e),d.error("删除商品失败")}}),me=l=>_(this,null,function*(){try{const e=l.status==="on_sale"?"off_sale":"on_sale";yield Le(l.id,e),d.success(e==="on_sale"?"商品已上架":"商品已下架"),I()}catch(e){console.error("修改商品状态失败:",e),d.error("修改商品状态失败")}}),E=()=>{P.value=!1},fe=()=>_(this,null,function*(){if(f.value)try{yield f.value.validate(),$.value=!0;const l={name:r.name,description:r.description,price:r.price,originalPrice:r.originalPrice,stock:r.stock,categoryId:r.categoryId,status:r.status,cover:r.cover,images:r.images,isRecommended:r.isRecommended};try{r.id?(yield Te(r.id,l),d.success("修改成功")):(yield ze(l),d.success("添加成功")),$.value=!1,P.value=!1,I()}catch(e){$.value=!1,console.error("保存商品失败:",e),d.error("保存商品失败")}}catch(l){console.error("表单验证失败:",l)}}),G=l=>{const e=l.type==="image/jpeg"||l.type==="image/png";e||d.error("只能上传JPG或PNG格式的图片!");let s=!0;return l.size!==void 0&&(s=l.size/1024/1024<2),s||d.error("图片大小不能超过2MB!"),e&&s},ve=l=>l?xe(l).format("YYYY-MM-DD HH:mm:ss"):"-";return(l,e)=>(p(),y("div",null,[t(a(ee),{bordered:!1,class:"mb-20"},{default:o(()=>[t(a(H),{model:u,layout:"inline",class:"search-form",onSubmit:ye(ne,["prevent"])},{default:o(()=>[t(a(c),{label:"商品名称"},{default:o(()=>[t(a(J),{value:u.name,"onUpdate:value":e[0]||(e[0]=s=>u.name=s),placeholder:"请输入商品名称","allow-clear":""},null,8,["value"])]),_:1}),t(a(c),{label:"商品分类"},{default:o(()=>[t(a(B),{value:u.categoryId,"onUpdate:value":e[1]||(e[1]=s=>u.categoryId=s),placeholder:"请选择商品分类",style:{width:"200px"},"allow-clear":""},{default:o(()=>[t(a(b),{value:null},{default:o(()=>e[15]||(e[15]=[i("全部")])),_:1}),(p(!0),y(F,null,Z(x.value,s=>(p(),L(a(b),{key:s.id,value:s.id},{default:o(()=>[i(h(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(a(c),{label:"商品状态"},{default:o(()=>[t(a(B),{value:u.status,"onUpdate:value":e[2]||(e[2]=s=>u.status=s),placeholder:"请选择商品状态",style:{width:"200px"},"allow-clear":""},{default:o(()=>[t(a(b),{value:null},{default:o(()=>e[16]||(e[16]=[i("全部")])),_:1}),t(a(b),{value:"on_sale"},{default:o(()=>e[17]||(e[17]=[i("在售")])),_:1}),t(a(b),{value:"off_sale"},{default:o(()=>e[18]||(e[18]=[i("下架")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(c),{label:"是否推荐"},{default:o(()=>[t(a(B),{value:u.isRecommended,"onUpdate:value":e[3]||(e[3]=s=>u.isRecommended=s),placeholder:"请选择是否推荐",style:{width:"200px"},"allow-clear":""},{default:o(()=>[t(a(b),{value:null},{default:o(()=>e[19]||(e[19]=[i("全部")])),_:1}),t(a(b),{value:"true"},{default:o(()=>e[20]||(e[20]=[i("推荐")])),_:1}),t(a(b),{value:"false"},{default:o(()=>e[21]||(e[21]=[i("不推荐")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(c),null,{default:o(()=>[t(a(Y),null,{default:o(()=>[t(a(D),{type:"primary","html-type":"submit"},{default:o(()=>e[22]||(e[22]=[i("查询")])),_:1}),t(a(D),{onClick:de},{default:o(()=>e[23]||(e[23]=[i("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(a(ee),{bordered:!1},{default:o(()=>[g("div",Be,[e[25]||(e[25]=g("div",{class:"table-title"},"商品列表",-1)),g("div",Me,[t(a(D),{type:"primary",onClick:ue},{icon:o(()=>[t(a(N))]),default:o(()=>[e[24]||(e[24]=i(" 新增商品 "))]),_:1})])]),t(a(Ue),{columns:R,"data-source":T.value,loading:k.value,pagination:m,onChange:ie,"row-key":"id"},{bodyCell:o(({column:s,record:n})=>[s.key==="cover"?(p(),y("div",Oe,[g("img",{src:n.cover||"/images/default-product.png",alt:"商品图片"},null,8,je)])):S("",!0),s.key==="price"?(p(),y("span",Fe,"¥"+h(n.price),1)):S("",!0),s.key==="status"?(p(),L(a(K),{key:2,color:n.status==="on_sale"?"green":"orange"},{default:o(()=>[i(h(n.status==="on_sale"?"在售":"下架"),1)]),_:2},1032,["color"])):S("",!0),s.key==="isRecommended"?(p(),L(a(K),{key:3,color:n.isRecommended?"blue":"default"},{default:o(()=>[i(h(n.isRecommended?"是":"否"),1)]),_:2},1032,["color"])):S("",!0),s.key==="createdAt"?(p(),y(F,{key:4},[i(h(ve(n.createdAt)),1)],64)):S("",!0),s.key==="action"?(p(),L(a(Y),{key:5},{default:o(()=>[g("a",{onClick:v=>ce(n)},"编辑",8,Ne),t(a(Q),{type:"vertical"}),t(a($e),{title:"确定删除该商品吗？",onConfirm:v=>pe(n),"ok-text":"确定","cancel-text":"取消"},{default:o(()=>e[26]||(e[26]=[g("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"]),t(a(Q),{type:"vertical"}),g("a",{onClick:v=>me(n)},h(n.status==="on_sale"?"下架":"上架"),9,qe)]),_:2},1024)):S("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),t(a(Ce),{visible:P.value,"onUpdate:visible":e[14]||(e[14]=s=>P.value=s),title:te.value,width:"800px","mask-closable":!1,onCancel:E},{footer:o(()=>[t(a(D),{onClick:E},{default:o(()=>e[32]||(e[32]=[i("取消")])),_:1}),t(a(D),{type:"primary",loading:$.value,onClick:fe},{default:o(()=>e[33]||(e[33]=[i(" 确定 ")])),_:1},8,["loading"])]),default:o(()=>[t(a(H),{ref_key:"formRef",ref:f,model:r,rules:ae,"label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[t(a(c),{label:"商品名称",name:"name"},{default:o(()=>[t(a(J),{value:r.name,"onUpdate:value":e[4]||(e[4]=s=>r.name=s),placeholder:"请输入商品名称"},null,8,["value"])]),_:1}),t(a(c),{label:"商品分类",name:"categoryId"},{default:o(()=>[t(a(B),{value:r.categoryId,"onUpdate:value":e[5]||(e[5]=s=>r.categoryId=s),placeholder:"请选择商品分类"},{default:o(()=>[(p(!0),y(F,null,Z(x.value,s=>(p(),L(a(b),{key:s.id,value:s.id},{default:o(()=>[i(h(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(a(c),{label:"商品价格",name:"price"},{default:o(()=>[t(a(O),{value:r.price,"onUpdate:value":e[6]||(e[6]=s=>r.price=s),placeholder:"请输入商品价格",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(c),{label:"原价",name:"originalPrice"},{default:o(()=>[t(a(O),{value:r.originalPrice,"onUpdate:value":e[7]||(e[7]=s=>r.originalPrice=s),placeholder:"请输入商品原价",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(c),{label:"库存",name:"stock"},{default:o(()=>[t(a(O),{value:r.stock,"onUpdate:value":e[8]||(e[8]=s=>r.stock=s),placeholder:"请输入库存数量",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(c),{label:"状态",name:"status"},{default:o(()=>[t(a(ke),{value:r.status,"onUpdate:value":e[9]||(e[9]=s=>r.status=s)},{default:o(()=>[t(a(W),{value:"on_sale"},{default:o(()=>e[27]||(e[27]=[i("上架")])),_:1}),t(a(W),{value:"off_sale"},{default:o(()=>e[28]||(e[28]=[i("下架")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(c),{label:"是否推荐",name:"isRecommended"},{default:o(()=>[t(a(be),{checked:r.isRecommended,"onUpdate:checked":e[10]||(e[10]=s=>r.isRecommended=s),"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:1}),t(a(c),{label:"封面图",name:"cover"},{default:o(()=>[t(a(X),{"file-list":z.value,"onUpdate:fileList":e[11]||(e[11]=s=>z.value=s),"list-type":"picture-card","show-upload-list":!1,action:"http://8.140.251.91/upload/image",headers:V,name:"image","before-upload":G,onChange:le},{default:o(()=>[r.cover?(p(),y("div",Ve,[g("img",{src:r.cover,alt:"商品封面",style:{width:"100%"}},null,8,Ee)])):(p(),y("div",Ge,[t(a(N)),e[29]||(e[29]=g("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),t(a(c),{label:"商品图片",name:"images"},{default:o(()=>[t(a(X),{"file-list":C.value,"onUpdate:fileList":e[12]||(e[12]=s=>C.value=s),"list-type":"picture-card",action:"http://8.140.251.91/upload/image",headers:V,name:"image","before-upload":G,onChange:se},{default:o(()=>[C.value.length>=5?(p(),y("div",He,e[30]||(e[30]=[g("div",null,"最多上传5张",-1)]))):(p(),y("div",Je,[t(a(N)),e[31]||(e[31]=g("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),t(a(c),{label:"商品描述",name:"description"},{default:o(()=>[t(a(we),{value:r.description,"onUpdate:value":e[13]||(e[13]=s=>r.description=s),placeholder:"请输入商品描述",rows:4},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]))}}),la=Ie(Ye,[["__scopeId","data-v-7907974e"]]);export{la as default};
