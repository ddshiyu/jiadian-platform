var h=(O,U,v)=>new Promise((b,_)=>{var S=i=>{try{c(v.next(i))}catch(o){_(o)}},A=i=>{try{c(v.throw(i))}catch(o){_(o)}},c=i=>i.done?b(i.value):Promise.resolve(i.value).then(S,A);c((v=v.apply(O,U)).next())});import{O as te,b as p,P as j,Q as se,R as f,U as N,W as le,X as D,S as L,B as w,Z as oe,a0 as ne,a3 as ie,a4 as re,ac as ue,ad as V,a2 as de,a1 as ce,_ as pe}from"./bootstrap-Be81Tyra.js";import{j as fe,k as me,l as ve,m as ye}from"./operation-Dt6NDkf8.js";import{C as q,P as z}from"./index-thOj1ETX.js";import{I as ge}from"./index-DQxeR_h_.js";import{T as be}from"./index-CIITXkHm.js";import{d as ke,r as y,I as $,c as Ce,o as we,a as I,b as m,A as t,z as l,g as a,B as r,f as g,e as M,l as P,t as Ie}from"../jse/index-index-IK0MbYCQ.js";import{P as _e}from"./index-DmoQSauz.js";const xe={class:"table-header"},he={class:"table-action"},Ue={key:0,class:"category-icon"},Se={key:1,class:"no-icon"},Ae=["onClick"],Be={key:0},De=["src"],Me={key:1},Pe=ke({__name:"category",setup(O){const U=[{title:"分类名称",dataIndex:"name",key:"name",width:"30%"},{title:"图标",dataIndex:"icon",key:"icon",width:100},{title:"排序",dataIndex:"sort",key:"sort",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:200}],v=y([]),b=y(!1),_=te(),S="https://qbylxb.cn/upload/image",A={Authorization:`Bearer ${_.accessToken}`},c=y(!1),i=y(null),o=$({id:0,name:"",parentId:0,icon:"",sort:0,status:"active",description:""}),F={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],status:[{required:!0,message:"请选择分类状态",trigger:"change"}]},x=y([]),k=y(!1),B=y(!1),G=Ce(()=>o.id?"编辑分类":"新增分类"),u=$({name:"",status:""});we(()=>{C()});const C=()=>h(this,null,function*(){b.value=!0;try{const s=yield fe();if(s){const e=E(s);v.value=u.name||u.status?J(e,u):e}b.value=!1}catch(s){console.error("获取分类列表失败:",s),p.error("获取分类列表失败"),b.value=!1}}),E=s=>s.list.filter(e=>!e.parentId||e.parentId===0).map(e=>({id:e.id||0,name:e.name,icon:e.icon||"",sort:e.sort||0,status:e.status||"active",parentId:0,description:e.description||""})),J=(s,e)=>s.filter(n=>{let d=!0,T=!0;return e.name&&(d=n.name.includes(e.name)),e.status&&(T=n.status===e.status),d&&T}),H=()=>{C()},Q=()=>{Object.assign(u,{name:"",status:""}),C()},W=()=>{X()},X=()=>{c.value=!1,Object.assign(o,{id:0,name:"",parentId:0,icon:"",sort:0,status:"active",description:""}),x.value=[],k.value=!0},Z=s=>{c.value=!0,Object.assign(o,{id:s.id,name:s.name,parentId:0,icon:s.icon,sort:s.sort,status:s.status,description:s.description||""}),x.value=s.icon?[{uid:"-1",name:"icon.jpg",url:s.icon}]:[],k.value=!0},K=s=>h(this,null,function*(){try{yield me(s.id),p.success("删除成功"),C()}catch(e){console.error("删除分类失败:",e),p.error("删除分类失败")}}),R=()=>{k.value=!1,c.value=!1},Y=()=>h(this,null,function*(){if(i.value)try{yield i.value.validate(),B.value=!0;const s={name:o.name,icon:o.icon,sort:o.sort,status:o.status,parentId:0};try{o.id?(yield ve(o.id,s),p.success("修改成功")):(yield ye(s),p.success("添加成功")),yield C(),k.value=!1,c.value=!1}catch(e){console.error("保存分类失败:",e),p.error("保存分类失败")}finally{B.value=!1}}catch(s){console.error("表单验证失败:",s)}}),ee=s=>{const e=s.type==="image/jpeg"||s.type==="image/png";e||p.error("只能上传JPG/PNG格式的图片!");const n=s.size!==void 0&&s.size/1024/1024<2;return n||p.error("图片必须小于2MB!"),e&&n},ae=s=>{s.file.status!=="uploading"&&s.file.status==="done"&&(o.icon=`https://qbylxb.cn${s.file.response.data.image.url}`)};return(s,e)=>(m(),I("div",null,[t(a(q),{bordered:!1,class:"mb-20"},{default:l(()=>[t(a(j),{model:u,layout:"inline",class:"search-form",onSubmit:se(H,["prevent"])},{default:l(()=>[t(a(f),{label:"分类名称"},{default:l(()=>[t(a(N),{value:u.name,"onUpdate:value":e[0]||(e[0]=n=>u.name=n),placeholder:"请输入分类名称","allow-clear":""},null,8,["value"])]),_:1}),t(a(f),{label:"状态"},{default:l(()=>[t(a(le),{value:u.status,"onUpdate:value":e[1]||(e[1]=n=>u.status=n),placeholder:"请选择状态",style:{width:"140px"},"allow-clear":""},{default:l(()=>[t(a(D),{value:""},{default:l(()=>e[8]||(e[8]=[r("全部")])),_:1}),t(a(D),{value:"active"},{default:l(()=>e[9]||(e[9]=[r("启用")])),_:1}),t(a(D),{value:"inactive"},{default:l(()=>e[10]||(e[10]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(f),null,{default:l(()=>[t(a(L),null,{default:l(()=>[t(a(w),{type:"primary","html-type":"submit"},{default:l(()=>e[11]||(e[11]=[r("查询")])),_:1}),t(a(w),{onClick:Q},{default:l(()=>e[12]||(e[12]=[r("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(a(q),{bordered:!1},{default:l(()=>[g("div",xe,[e[14]||(e[14]=g("div",{class:"table-title"},"商品分类",-1)),g("div",he,[t(a(w),{type:"primary",onClick:W},{icon:l(()=>[t(a(z))]),default:l(()=>[e[13]||(e[13]=r(" 新增分类 "))]),_:1})])]),t(a(be),{columns:U,"data-source":v.value,loading:b.value,pagination:!1,"row-key":"id"},{bodyCell:l(({column:n,record:d})=>[n.key==="icon"?(m(),I("div",Ue,[d.icon?(m(),P(a(ge),{key:0,src:d.icon,alt:"分类图标",preview:!0},null,8,["src"])):(m(),I("div",Se,"无"))])):M("",!0),n.key==="status"?(m(),P(a(oe),{key:1,color:d.status==="active"?"green":"orange"},{default:l(()=>[r(Ie(d.status==="active"?"启用":"禁用"),1)]),_:2},1032,["color"])):M("",!0),n.key==="action"?(m(),P(a(L),{key:2},{default:l(()=>[g("a",{onClick:()=>Z(d)},"编辑",8,Ae),t(a(ne),{type:"vertical"}),t(a(_e),{title:"确定删除该分类吗？",onConfirm:()=>K(d),"ok-text":"确定","cancel-text":"取消"},{default:l(()=>e[15]||(e[15]=[g("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):M("",!0)]),_:1},8,["data-source","loading"])]),_:1}),t(a(ce),{visible:k.value,"onUpdate:visible":e[7]||(e[7]=n=>k.value=n),title:G.value,width:"600px","mask-closable":!1,onCancel:R},{footer:l(()=>[t(a(w),{onClick:R},{default:l(()=>e[19]||(e[19]=[r("取消")])),_:1}),t(a(w),{type:"primary",loading:B.value,onClick:Y},{default:l(()=>e[20]||(e[20]=[r(" 确定 ")])),_:1},8,["loading"])]),default:l(()=>[t(a(j),{ref_key:"formRef",ref:i,model:o,rules:F,"label-col":{span:4},"wrapper-col":{span:18}},{default:l(()=>[t(a(f),{label:"分类名称",name:"name"},{default:l(()=>[t(a(N),{value:o.name,"onUpdate:value":e[2]||(e[2]=n=>o.name=n),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),t(a(f),{label:"分类图标",name:"icon"},{default:l(()=>[t(a(ie),{"file-list":x.value,"onUpdate:fileList":e[3]||(e[3]=n=>x.value=n),"list-type":"picture-card","show-upload-list":!1,action:S,headers:A,name:"image","before-upload":ee,onChange:ae},{default:l(()=>[o.icon?(m(),I("div",Be,[g("img",{src:o.icon,alt:"分类图标",style:{width:"100%"}},null,8,De)])):(m(),I("div",Me,[t(a(z)),e[16]||(e[16]=g("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),t(a(f),{label:"排序",name:"sort"},{default:l(()=>[t(a(re),{value:o.sort,"onUpdate:value":e[4]||(e[4]=n=>o.sort=n),placeholder:"数字越小越靠前",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(f),{label:"状态",name:"status"},{default:l(()=>[t(a(ue),{value:o.status,"onUpdate:value":e[5]||(e[5]=n=>o.status=n)},{default:l(()=>[t(a(V),{value:"active"},{default:l(()=>e[17]||(e[17]=[r("启用")])),_:1}),t(a(V),{value:"inactive"},{default:l(()=>e[18]||(e[18]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(f),{label:"描述",name:"description"},{default:l(()=>[t(a(de),{value:o.description,"onUpdate:value":e[6]||(e[6]=n=>o.description=n),placeholder:"请输入分类描述",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]))}}),ze=pe(Pe,[["__scopeId","data-v-6bc5819f"]]);export{ze as default};
