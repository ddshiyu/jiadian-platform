var he=Object.defineProperty,we=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var X=(c,d,i)=>d in c?he(c,d,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[d]=i,Z=(c,d)=>{for(var i in d||(d={}))Me.call(d,i)&&X(c,i,d[i]);if(W)for(var i of W(d))Ne.call(d,i)&&X(c,i,d[i]);return c},ee=(c,d)=>we(c,De(d));var z=(c,d,i)=>new Promise((w,b)=>{var O=o=>{try{f(i.next(o))}catch(_){b(_)}},m=o=>{try{f(i.throw(o))}catch(_){b(_)}},f=o=>o.done?w(o.value):Promise.resolve(o.value).then(O,m);f((i=i.apply(c,d)).next())});import{a4 as Oe,ca as Ce,aD as te,aE as Ie,aF as Y,aI as ae,aG as le,aH as S,n as re,B as $,bF as Te,aJ as U,aK as oe,aL as ne,cb as Ae,o as D,aM as Ye}from"./bootstrap-DhTUe00I.js";import{x as a,a3 as Pe,P as M,T as V,ao as Re,a4 as h,a5 as y,ah as l,aa as t,at as u,aK as N,aB as k,ae as j,au as p,bl as $e}from"../jse/index-index-DRKrrGAz.js";import{T as se,h as Fe,i as xe,j as ze,r as Be}from"./operation-DVEqFYlT.js";import{C as ue}from"./index-Cu6YPyTo.js";import{D as de,a as g}from"./index-Cw5SX2YJ.js";import{P as Ue}from"./index-roCd-cpn.js";import"./Dropdown-NjH4VmsC.js";import"./index-Cfl0mBFW.js";var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"};function ie(c){for(var d=1;d<arguments.length;d++){var i=arguments[d]!=null?Object(arguments[d]):{},w=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(w=w.concat(Object.getOwnPropertySymbols(i).filter(function(b){return Object.getOwnPropertyDescriptor(i,b).enumerable}))),w.forEach(function(b){Ee(c,b,i[b])})}return c}function Ee(c,d,i){return d in c?Object.defineProperty(c,d,{value:i,enumerable:!0,configurable:!0,writable:!0}):c[d]=i,c}var H=function(d,i){var w=ie({},d,i.attrs);return a(Oe,ie({},w,{icon:je}),null)};H.displayName="ReloadOutlined";H.inheritAttrs=!1;const qe={class:"table-header"},Ve={class:"table-action"},He={key:0},Le={key:1,class:"price"},Je={key:4},Ge={key:0},Qe={key:0},Ke={key:0,class:"product-info"},We=["src"],Xe={key:1,class:"price"},Ze={key:2,class:"price"},et=Pe({__name:"orders",setup(c){const{RangePicker:d}=Ce,i=[{title:"订单信息",key:"orderInfo",width:200},{title:"订单金额",key:"amount",width:100},{title:"订单状态",key:"status",width:120},{title:"支付状态",key:"paymentStatus",width:120},{title:"时间信息",key:"time",width:200},{title:"操作",key:"action",width:200}],w=[{title:"商品信息",key:"product",width:"40%"},{title:"单价",key:"price",width:"15%"},{title:"数量",dataIndex:"quantity",key:"quantity",width:"15%"},{title:"金额",key:"total",width:"15%"}],b=M([]),O=M(!1),m=M(null),f=V({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`共 ${n} 条记录`}),o=V({orderNo:"",userName:"",status:"",paymentStatus:"",startDate:"",endDate:""}),_=M(void 0),B=M(!1),F=M(!1),C=V({orderId:0,remark:""}),E=M(null),me={remark:[{required:!0,message:"请输入订单备注",trigger:"blur",type:"string"}]},q=M(!1),I=()=>z(this,null,function*(){var n,e;O.value=!0;try{_.value&&_.value.length===2?(o.startDate=_.value[0].format("YYYY-MM-DD"),o.endDate=_.value[1].format("YYYY-MM-DD")):(o.startDate="",o.endDate="");const s={orderNo:o.orderNo,userName:o.userName,status:o.status||void 0,paymentStatus:o.paymentStatus||void 0,startDate:o.startDate||void 0,endDate:o.endDate||void 0,pageNum:f.current,pageSize:f.pageSize};try{const r=yield Fe(s);if(r)b.value=r.list||[],f.total=((n=r.pagination)==null?void 0:n.total)||0,f.current=((e=r.pagination)==null?void 0:e.current)||1;else throw new Error("获取订单列表失败: 空响应")}catch(r){console.error("获取订单API失败，使用模拟数据:",r),D.warning(`当前使用测试数据，接口异常：${r.message||r}`);let v=[...pe()];o.orderNo&&(v=v.filter(A=>A.orderNo.includes(o.orderNo))),o.userName&&(v=v.filter(A=>A.userName.includes(o.userName))),o.status&&(v=v.filter(A=>A.status===o.status)),o.paymentStatus&&(v=v.filter(A=>A.paymentStatus===o.paymentStatus));const x=f.current||1,R=f.pageSize||10,K=(x-1)*R,Se=K+R;b.value=v.slice(K,Se),f.total=v.length}}catch(s){console.error("获取订单列表失败:",s),D.error("获取订单列表失败"),b.value=[],f.total=0}finally{O.value=!1}}),pe=()=>{const n=["pending_payment","pending_delivery","delivered","completed","cancelled"],e=["unpaid","paid","refunded"];return Array.from({length:25}).map((s,r)=>{const T=n[Math.floor(Math.random()*n.length)],v=T==="pending_payment"?"unpaid":T==="cancelled"?e[Math.floor(Math.random()*e.length)]:"paid",x={id:r+1,orderNo:`ORD${String(r+10001).padStart(5,"0")}`,userId:r+100,userName:`测试用户${r+1}`,totalAmount:Number(Math.floor(Math.random()*1e4)/100+100),status:T,paymentStatus:v,paymentMethod:v==="unpaid"?void 0:"微信支付",paymentTime:v==="unpaid"?void 0:new Date(Date.now()-Math.random()*864e5*30).toISOString(),deliveryTime:["completed","delivered"].includes(T)?new Date(Date.now()-Math.random()*864e5*15).toISOString():void 0,completionTime:T==="completed"?new Date(Date.now()-Math.random()*864e5*5).toISOString():void 0,cancelTime:T==="cancelled"?new Date(Date.now()-Math.random()*864e5*10).toISOString():void 0,remark:Math.random()>.7?`订单备注${r+1}`:void 0,address:`测试地址${r+1}`,consignee:`收货人${r+1}`,phone:`1380000${String(r+1).padStart(4,"0")}`,createdAt:new Date(Date.now()-Math.random()*864e5*60).toISOString(),updatedAt:new Date(Date.now()-Math.random()*864e5*30).toISOString(),items:[{id:r*2+1,productId:r*3+100,productName:`测试商品${r*2+1}`,price:Math.floor(Math.random()*1e3)/100+50,quantity:Math.floor(Math.random()*5)+1,totalAmount:0,productCover:`https://via.placeholder.com/100?text=商品${r*2+1}`},{id:r*2+2,productId:r*3+101,productName:`测试商品${r*2+2}`,price:Math.floor(Math.random()*1e3)/100+50,quantity:Math.floor(Math.random()*5)+1,totalAmount:0,productCover:`https://via.placeholder.com/100?text=商品${r*2+2}`}]};return x.items=x.items.map(R=>ee(Z({},R),{totalAmount:R.price*R.quantity})),x})},ce=()=>{f.current=1,I()},fe=()=>{Object.assign(o,{orderNo:"",userName:"",status:"",paymentStatus:"",startDate:"",endDate:""}),_.value=void 0,f.current=1,I()},ve=n=>{f.current=n.current,f.pageSize=n.pageSize,I()},ye=n=>z(this,null,function*(){try{O.value=!0;try{const e=yield xe(n.id);if(e)m.value=e,B.value=!0;else throw new Error("订单详情获取失败: 空响应")}catch(e){console.error("获取订单详情API失败，使用模拟数据:",e),D.warning(`当前使用测试数据，接口异常：${e.message||e}`),m.value=n,B.value=!0}}catch(e){console.error("获取订单详情失败:",e),D.error("获取订单详情失败")}finally{O.value=!1}}),ge=n=>z(this,null,function*(){try{yield ze(n.id,"管理员取消"),D.success("订单已取消"),I()}catch(e){console.error("取消订单失败:",e),D.error("取消订单失败")}}),ke=n=>{C.orderId=n.id,C.remark=n.remark||"",F.value=!0},be=()=>{F.value=!1},_e=()=>z(this,null,function*(){if(E.value)try{yield E.value.validate(),q.value=!0,yield Be(C.orderId,C.remark),D.success("备注成功"),F.value=!1,I()}catch(n){console.error("备注失败:",n),D.error("备注失败")}finally{q.value=!1}}),P=n=>n?$e(n).format("YYYY-MM-DD HH:mm:ss"):"",L=n=>({pending_payment:"待支付",pending_delivery:"待发货",delivered:"已发货",completed:"已完成",cancelled:"已取消"})[n]||n,J=n=>({pending_payment:"orange",pending_delivery:"blue",delivered:"cyan",completed:"green",cancelled:"red"})[n]||"default",G=n=>({unpaid:"未支付",paid:"已支付",refunded:"已退款"})[n]||n,Q=n=>({unpaid:"orange",paid:"green",refunded:"purple"})[n]||"default";return Re(()=>{I()}),(n,e)=>(y(),h("div",null,[a(t(ue),{bordered:!1,class:"mb-20"},{default:l(()=>[a(t(te),{model:o,layout:"inline",class:"search-form",onSubmit:Ie(ce,["prevent"])},{default:l(()=>[a(t(Y),{label:"订单号"},{default:l(()=>[a(t(ae),{value:o.orderNo,"onUpdate:value":e[0]||(e[0]=s=>o.orderNo=s),placeholder:"请输入订单号","allow-clear":""},null,8,["value"])]),_:1}),a(t(Y),{label:"用户名"},{default:l(()=>[a(t(ae),{value:o.userName,"onUpdate:value":e[1]||(e[1]=s=>o.userName=s),placeholder:"请输入用户名","allow-clear":""},null,8,["value"])]),_:1}),a(t(Y),{label:"订单状态"},{default:l(()=>[a(t(le),{value:o.status,"onUpdate:value":e[2]||(e[2]=s=>o.status=s),placeholder:"请选择订单状态",style:{width:"160px"},"allow-clear":""},{default:l(()=>[a(t(S),{value:""},{default:l(()=>e[8]||(e[8]=[u("全部")])),_:1}),a(t(S),{value:"pending_payment"},{default:l(()=>e[9]||(e[9]=[u("待支付")])),_:1}),a(t(S),{value:"pending_delivery"},{default:l(()=>e[10]||(e[10]=[u("待发货")])),_:1}),a(t(S),{value:"delivered"},{default:l(()=>e[11]||(e[11]=[u("已发货")])),_:1}),a(t(S),{value:"completed"},{default:l(()=>e[12]||(e[12]=[u("已完成")])),_:1}),a(t(S),{value:"cancelled"},{default:l(()=>e[13]||(e[13]=[u("已取消")])),_:1})]),_:1},8,["value"])]),_:1}),a(t(Y),{label:"支付状态"},{default:l(()=>[a(t(le),{value:o.paymentStatus,"onUpdate:value":e[3]||(e[3]=s=>o.paymentStatus=s),placeholder:"请选择支付状态",style:{width:"140px"},"allow-clear":""},{default:l(()=>[a(t(S),{value:""},{default:l(()=>e[14]||(e[14]=[u("全部")])),_:1}),a(t(S),{value:"unpaid"},{default:l(()=>e[15]||(e[15]=[u("未支付")])),_:1}),a(t(S),{value:"paid"},{default:l(()=>e[16]||(e[16]=[u("已支付")])),_:1}),a(t(S),{value:"refunded"},{default:l(()=>e[17]||(e[17]=[u("已退款")])),_:1})]),_:1},8,["value"])]),_:1}),a(t(Y),{label:"下单时间"},{default:l(()=>[a(t(d),{value:_.value,"onUpdate:value":e[4]||(e[4]=s=>_.value=s),format:"YYYY-MM-DD",placeholder:["开始日期","结束日期"],style:{width:"240px"}},null,8,["value"])]),_:1}),a(t(Y),null,{default:l(()=>[a(t(re),null,{default:l(()=>[a(t($),{type:"primary","html-type":"submit"},{default:l(()=>e[18]||(e[18]=[u("查询")])),_:1}),a(t($),{onClick:fe},{default:l(()=>e[19]||(e[19]=[u("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(t(ue),{bordered:!1},{default:l(()=>[N("div",qe,[e[20]||(e[20]=N("div",{class:"table-title"},"订单列表",-1)),N("div",Ve,[a(t(Te),{title:"刷新"},{default:l(()=>[a(t($),{onClick:I},{icon:l(()=>[a(t(H))]),_:1})]),_:1})])]),a(t(se),{columns:i,"data-source":b.value,loading:O.value,pagination:f,onChange:ve,"row-key":"id"},{bodyCell:l(({column:s,record:r})=>[s.key==="orderInfo"?(y(),h("div",He,[N("div",null,"订单号: "+p(r.orderNo),1),N("div",null,"用户: "+p(r.userName),1)])):k("",!0),s.key==="amount"?(y(),h("div",Le," ¥"+p(Number(r.totalAmount).toFixed(2)),1)):k("",!0),s.key==="status"?(y(),j(t(U),{key:2,color:J(r.status)},{default:l(()=>[u(p(L(r.status)),1)]),_:2},1032,["color"])):k("",!0),s.key==="paymentStatus"?(y(),j(t(U),{key:3,color:Q(r.paymentStatus)},{default:l(()=>[u(p(G(r.paymentStatus)),1)]),_:2},1032,["color"])):k("",!0),s.key==="time"?(y(),h("div",Je,[N("div",null,"下单: "+p(P(r.createdAt)),1),r.paymentTime?(y(),h("div",Ge," 支付: "+p(P(r.paymentTime)),1)):k("",!0)])):k("",!0),s.key==="action"?(y(),j(t(re),{key:5},{default:l(()=>[a(t($),{type:"link",onClick:()=>ye(r)},{default:l(()=>e[21]||(e[21]=[u(" 详情 ")])),_:2},1032,["onClick"]),r.status==="pending_payment"?(y(),j(t(Ue),{key:0,title:"确定取消该订单吗？",onConfirm:()=>ge(r),"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[a(t($),{type:"link",danger:""},{default:l(()=>e[22]||(e[22]=[u("取消订单")])),_:1})]),_:2},1032,["onConfirm"])):k("",!0),a(t($),{type:"link",onClick:()=>ke(r)},{default:l(()=>e[23]||(e[23]=[u(" 备注 ")])),_:2},1032,["onClick"])]),_:2},1024)):k("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),a(t(ne),{visible:B.value,"onUpdate:visible":e[5]||(e[5]=s=>B.value=s),title:"订单详情",width:"800px",footer:null,"mask-closable":!0},{default:l(()=>[m.value?(y(),h("div",Qe,[a(t(de),{title:"基本信息",bordered:"",column:2},{default:l(()=>[a(t(g),{label:"订单号"},{default:l(()=>[u(p(m.value.orderNo),1)]),_:1}),a(t(g),{label:"下单时间"},{default:l(()=>[u(p(P(m.value.createdAt)),1)]),_:1}),a(t(g),{label:"用户"},{default:l(()=>[u(p(m.value.userName),1)]),_:1}),a(t(g),{label:"总金额"},{default:l(()=>[u(" ¥"+p(Number(m.value.totalAmount).toFixed(2)),1)]),_:1}),a(t(g),{label:"订单状态"},{default:l(()=>[a(t(U),{color:J(m.value.status)},{default:l(()=>[u(p(L(m.value.status)),1)]),_:1},8,["color"])]),_:1}),a(t(g),{label:"支付状态"},{default:l(()=>[a(t(U),{color:Q(m.value.paymentStatus)},{default:l(()=>[u(p(G(m.value.paymentStatus)),1)]),_:1},8,["color"])]),_:1}),a(t(g),{label:"支付方式",span:2},{default:l(()=>[u(p(m.value.paymentMethod||"-"),1)]),_:1}),a(t(g),{label:"支付时间",span:2},{default:l(()=>[u(p(m.value.paymentTime?P(m.value.paymentTime):"-"),1)]),_:1}),a(t(g),{label:"发货时间",span:2},{default:l(()=>[u(p(m.value.deliveryTime?P(m.value.deliveryTime):"-"),1)]),_:1}),a(t(g),{label:"完成时间",span:2},{default:l(()=>[u(p(m.value.completionTime?P(m.value.completionTime):"-"),1)]),_:1}),a(t(g),{label:"备注",span:2},{default:l(()=>[u(p(m.value.remark||"-"),1)]),_:1})]),_:1}),a(t(oe)),a(t(de),{title:"收货信息",bordered:"",column:1},{default:l(()=>[a(t(g),{label:"收货人"},{default:l(()=>[u(p(m.value.consignee||"-"),1)]),_:1}),a(t(g),{label:"联系电话"},{default:l(()=>[u(p(m.value.phone||"-"),1)]),_:1}),a(t(g),{label:"收货地址"},{default:l(()=>[u(p(m.value.address||"-"),1)]),_:1})]),_:1}),a(t(oe)),e[24]||(e[24]=N("h3",null,"商品信息",-1)),a(t(se),{columns:w,"data-source":m.value.items,pagination:!1,"row-key":"id"},{bodyCell:l(({column:s,record:r})=>[s.key==="product"?(y(),h("div",Ke,[r.productCover?(y(),h("img",{key:0,src:r.productCover,alt:"商品图片",class:"product-img"},null,8,We)):k("",!0),N("div",null,p(r.productName),1)])):k("",!0),s.key==="price"?(y(),h("div",Xe,"¥"+p(Number(r.price).toFixed(2)),1)):k("",!0),s.key==="total"?(y(),h("div",Ze," ¥"+p(Number(r.totalAmount).toFixed(2)),1)):k("",!0)]),_:1},8,["data-source"])])):k("",!0)]),_:1},8,["visible"]),a(t(ne),{visible:F.value,"onUpdate:visible":e[7]||(e[7]=s=>F.value=s),title:"订单备注",onOk:_e,"confirm-loading":q.value,onCancel:be,"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[a(t(te),{ref_key:"remarkFormRef",ref:E,model:C,rules:me,"label-col":{span:4},"wrapper-col":{span:18}},{default:l(()=>[a(t(Y),{label:"备注",name:"remark"},{default:l(()=>[a(t(Ae),{value:C.remark,"onUpdate:value":e[6]||(e[6]=s=>C.remark=s),placeholder:"请输入订单备注",rows:4},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])]))}}),it=Ye(et,[["__scopeId","data-v-5688153e"]]);export{it as default};
