var T=(f,c,o)=>new Promise((w,v)=>{var _=i=>{try{d(o.next(i))}catch(p){v(p)}},h=i=>{try{d(o.throw(i))}catch(p){v(p)}},d=i=>i.done?w(i.value):Promise.resolve(i.value).then(_,h);d((o=o.apply(f,c)).next())});import{A as a,d as oe,r as O,I as B,o as ie,a as S,b as g,z as l,f as ue,g as t,G as z,H as M,B as u,t as x,l as D,e as de,J as ce}from"../jse/index-index-Du3oEA_J.js";import{n as me,o as fe,p as ve,q as pe,t as ye,v as ge,w as we}from"./operation-A1Qt9imT.js";import{I as be,N as E,U as R,P as N,R as C,W as V,X as q,S as j,B as k,aE as H,Z as ke,a1 as he,b as m,_ as Ce}from"./bootstrap-BMeI61GG.js";import{R as Te}from"./ReloadOutlined-CXHPlJFU.js";import{P as Ae,C as Oe}from"./index-DtIEgUNp.js";import{T as Se}from"./index-CxgiDpDe.js";import{P as Y}from"./index-CXqpqzVa.js";var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};function J(f){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?Object(arguments[c]):{},w=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(w=w.concat(Object.getOwnPropertySymbols(o).filter(function(v){return Object.getOwnPropertyDescriptor(o,v).enumerable}))),w.forEach(function(v){_e(f,v,o[v])})}return f}function _e(f,c,o){return c in f?Object.defineProperty(f,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):f[c]=o,f}var L=function(c,o){var w=J({},c,o.attrs);return a(be,J({},w,{icon:xe}),null)};L.displayName="EditOutlined";L.inheritAttrs=!1;const ze={class:"p-4"},De={class:"mb-4"},Ie=oe({__name:"announcements",setup(f){const{RangePicker:c}=E,{TextArea:o}=R,w=[{title:"标题",dataIndex:"title",key:"title",width:200,ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"浏览次数",dataIndex:"viewCount",key:"viewCount",width:100},{title:"开始时间",dataIndex:"startTime",key:"startTime",width:150},{title:"结束时间",dataIndex:"endTime",key:"endTime",width:150},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150},{title:"操作",key:"action",fixed:"right",width:280}],v=O([]),_=O(!1),h=O([]),d=B({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条记录`}),i=B({keyword:"",status:""}),p=O(!1),r=B({id:void 0,title:"",content:"",status:"active",startTime:void 0,endTime:void 0}),I=O(null),G={title:[{required:!0,message:"请输入公告标题",trigger:"blur",type:"string"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur",type:"string"}],status:[{required:!0,message:"请选择公告状态",trigger:"change",type:"string"}]},P=O(!1),F=[{label:"激活",value:"active"},{label:"未激活",value:"inactive"}],b=()=>T(this,null,function*(){_.value=!0;try{const s={keyword:i.keyword||void 0,status:i.status||void 0,page:d.current,limit:d.pageSize},e=yield me(s);v.value=e.list,d.total=e.total,d.current=e.page,d.pageSize=e.limit}catch(s){console.error("获取公告列表失败:",s),m.error("获取公告列表失败")}finally{_.value=!1}}),Q=()=>{d.current=1,b()},W=()=>{i.keyword="",i.status="",d.current=1,b()},X=s=>{d.current=s.current,d.pageSize=s.pageSize,b()},Z={selectedRowKeys:h,onChange:s=>{h.value=s}},K=()=>{te(),p.value=!0},ee=s=>T(this,null,function*(){try{const e=yield fe(s.id);Object.assign(r,e),p.value=!0}catch(e){console.error("获取公告详情失败:",e),m.error("获取公告详情失败")}}),te=()=>{var s;Object.assign(r,{id:void 0,title:"",content:"",status:"active",startTime:void 0,endTime:void 0}),(s=I.value)==null||s.resetFields()},ae=()=>T(this,null,function*(){var s;try{if(yield(s=I.value)==null?void 0:s.validate(),P.value=!0,r.id){const e=yield ge(r.id,r);console.log("编辑响应:",e)}else{const e=yield we(r);console.log("创建响应:",e)}m.success(r.id?"更新成功":"创建成功"),p.value=!1,yield b()}catch(e){console.error("提交失败:",e),m.error("提交失败")}finally{P.value=!1}}),le=s=>T(this,null,function*(){try{const e=yield ve(s);e.code===0?(m.success("删除成功"),b()):m.error(e.message||"删除失败")}catch(e){console.error("删除失败:",e),m.error("删除失败")}}),ne=()=>T(this,null,function*(){if(h.value.length===0){m.warning("请选择要删除的公告");return}try{const s=yield pe(h.value);s.code===0?(m.success("批量删除成功"),h.value=[],b()):m.error(s.message||"批量删除失败")}catch(s){console.error("批量删除失败:",s),m.error("批量删除失败")}}),$=(s,e)=>T(this,null,function*(){try{const n=yield ye(s,e);console.log("状态更新响应:",n),m.success(e==="active"?"启用成功":"停用成功"),yield b()}catch(n){console.error("状态更新失败:",n),m.error("状态更新失败")}}),se=s=>s==="active"?"success":"default",U=s=>s?ce(s).format("YYYY-MM-DD HH:mm"):"-";return ie(()=>{b()}),(s,e)=>(g(),S("div",ze,[a(t(Oe),null,{default:l(()=>[a(t(N),{layout:"inline",class:"mb-4"},{default:l(()=>[a(t(C),{label:"关键词"},{default:l(()=>[a(t(R),{value:i.keyword,"onUpdate:value":e[0]||(e[0]=n=>i.keyword=n),placeholder:"搜索标题或内容","allow-clear":"",style:{width:"200px"}},null,8,["value"])]),_:1}),a(t(C),{label:"状态"},{default:l(()=>[a(t(V),{value:i.status,"onUpdate:value":e[1]||(e[1]=n=>i.status=n),placeholder:"请选择状态","allow-clear":"",style:{width:"120px"}},{default:l(()=>[(g(),S(z,null,M(F,n=>a(t(q),{key:n.value,value:n.value},{default:l(()=>[u(x(n.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),a(t(C),null,{default:l(()=>[a(t(j),null,{default:l(()=>[a(t(k),{type:"primary",onClick:Q},{default:l(()=>e[9]||(e[9]=[u("搜索")])),_:1}),a(t(k),{onClick:W},{default:l(()=>e[10]||(e[10]=[u("重置")])),_:1}),a(t(k),{onClick:b},{icon:l(()=>[a(t(Te))]),default:l(()=>[e[11]||(e[11]=u(" 刷新 "))]),_:1})]),_:1})]),_:1})]),_:1}),ue("div",De,[a(t(j),null,{default:l(()=>[a(t(k),{type:"primary",onClick:K},{icon:l(()=>[a(t(Ae))]),default:l(()=>[e[12]||(e[12]=u(" 新增公告 "))]),_:1}),a(t(Y),{title:"确定要删除选中的公告吗？",onConfirm:ne},{default:l(()=>[a(t(k),{type:"primary",danger:"",disabled:h.value.length===0},{icon:l(()=>[a(t(H))]),default:l(()=>[e[13]||(e[13]=u(" 批量删除 "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),a(t(Se),{columns:w,"data-source":v.value,loading:_.value,pagination:d,"row-selection":Z,scroll:{x:1400},onChange:X},{bodyCell:l(({column:n,record:y})=>[n.key==="status"?(g(),D(t(ke),{key:0,color:se(y.status)},{default:l(()=>{var A;return[u(x((A=F.find(re=>re.value===y.status))==null?void 0:A.label),1)]}),_:2},1032,["color"])):n.key==="startTime"?(g(),S(z,{key:1},[u(x(U(y.startTime)),1)],64)):n.key==="endTime"?(g(),S(z,{key:2},[u(x(U(y.endTime)),1)],64)):n.key==="createdAt"?(g(),S(z,{key:3},[u(x(U(y.createdAt)),1)],64)):n.key==="action"?(g(),D(t(j),{key:4},{default:l(()=>[a(t(k),{type:"primary",size:"small",onClick:A=>ee(y)},{icon:l(()=>[a(t(L))]),default:l(()=>[e[14]||(e[14]=u(" 编辑 "))]),_:2},1032,["onClick"]),y.status==="active"?(g(),D(t(k),{key:0,size:"small",onClick:A=>$(y.id,"inactive")},{default:l(()=>e[15]||(e[15]=[u(" 停用 ")])),_:2},1032,["onClick"])):(g(),D(t(k),{key:1,type:"primary",size:"small",onClick:A=>$(y.id,"active")},{default:l(()=>e[16]||(e[16]=[u(" 启用 ")])),_:2},1032,["onClick"])),a(t(Y),{title:"确定要删除这条公告吗？",onConfirm:A=>le(y.id)},{default:l(()=>[a(t(k),{type:"primary",danger:"",size:"small"},{icon:l(()=>[a(t(H))]),default:l(()=>[e[17]||(e[17]=u(" 删除 "))]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):de("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),a(t(he),{open:p.value,"onUpdate:open":e[7]||(e[7]=n=>p.value=n),title:r.id?"编辑公告":"新增公告",width:"800px","confirm-loading":P.value,onOk:ae,onCancel:e[8]||(e[8]=n=>p.value=!1)},{default:l(()=>[a(t(N),{ref_key:"editFormRef",ref:I,model:r,rules:G,"label-col":{span:4},"wrapper-col":{span:20}},{default:l(()=>[a(t(C),{label:"公告标题",name:"title"},{default:l(()=>[a(t(R),{value:r.title,"onUpdate:value":e[2]||(e[2]=n=>r.title=n),placeholder:"请输入公告标题"},null,8,["value"])]),_:1}),a(t(C),{label:"公告内容",name:"content"},{default:l(()=>[a(t(o),{value:r.content,"onUpdate:value":e[3]||(e[3]=n=>r.content=n),placeholder:"请输入公告内容",rows:6},null,8,["value"])]),_:1}),a(t(C),{label:"公告状态",name:"status"},{default:l(()=>[a(t(V),{value:r.status,"onUpdate:value":e[4]||(e[4]=n=>r.status=n),placeholder:"请选择公告状态"},{default:l(()=>[(g(),S(z,null,M(F,n=>a(t(q),{key:n.value,value:n.value},{default:l(()=>[u(x(n.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),a(t(C),{label:"开始时间"},{default:l(()=>[a(t(E),{value:r.startTime,"onUpdate:value":e[5]||(e[5]=n=>r.startTime=n),"show-time":"",placeholder:"请选择开始时间",style:{width:"100%"}},null,8,["value"])]),_:1}),a(t(C),{label:"结束时间"},{default:l(()=>[a(t(E),{value:r.endTime,"onUpdate:value":e[6]||(e[6]=n=>r.endTime=n),"show-time":"",placeholder:"请选择结束时间",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirm-loading"])]))}}),$e=Ce(Ie,[["__scopeId","data-v-1c31fb25"]]);export{$e as default};
