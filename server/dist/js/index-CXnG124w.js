var C=(F,V,_)=>new Promise((p,R)=>{var L=g=>{try{f(_.next(g))}catch(o){R(o)}},w=g=>{try{f(_.throw(g))}catch(o){R(o)}},f=g=>g.done?p(g.value):Promise.resolve(g.value).then(L,w);f((_=_.apply(F,V)).next())});import{cc as ye,o as c,aD as J,aE as he,aF as n,aI as Y,aG as B,aH as k,n as K,B as A,aJ as Q,aK as W,ce as U,cf as we,bC as X,cg as ke,cd as Z,cb as be,aL as Pe,aM as Ie}from"./bootstrap-DhTUe00I.js";import{a3 as xe,T as M,P,J as Ce,ao as _e,a4 as m,a5 as u,x as t,ah as s,aa as a,at as d,F as O,ag as ee,ae as D,au as h,aK as v,aB as b,bl as Re}from"../jse/index-index-DRKrrGAz.js";import{q as Te,w as Ue,T as Se,x as qe,y as Ae,z as De,A as Le,B as $e}from"./operation-DVEqFYlT.js";import{C as ae,P as j}from"./index-Cu6YPyTo.js";import{P as ze}from"./index-roCd-cpn.js";import"./Dropdown-NjH4VmsC.js";import"./index-Cfl0mBFW.js";const Be={class:"table-header"},Ve={class:"table-action"},Me={key:0,class:"product-cover"},Oe=["src"],je={key:1,class:"price"},Fe={key:2,class:"price"},Ne={key:3},Ee={key:4,class:"price"},Ge=["onClick"],He=["onClick"],Je={key:0},Ye=["src"],Ke={key:1},Qe={key:0},We={key:1},Xe=xe({__name:"index",setup(F){const V=ye(),_=[{title:"商品图片",dataIndex:"cover",key:"cover",width:100},{title:"商品名称",dataIndex:"name",key:"name"},{title:"价格",dataIndex:"price",key:"price",width:100},{title:"批发价",dataIndex:"wholesalePrice",key:"wholesalePrice",width:100},{title:"批发阈值",dataIndex:"wholesaleThreshold",key:"wholesaleThreshold",width:100},{title:"VIP价格",dataIndex:"vipPrice",key:"vipPrice",width:100},{title:"分类",dataIndex:"category",key:"category",customRender:({record:r})=>{var e;return((e=r.category)==null?void 0:e.name)||"-"}},{title:"库存",dataIndex:"stock",key:"stock",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"推荐",dataIndex:"isRecommended",key:"isRecommended",width:80},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150},{title:"操作",key:"action",width:200}],p=M({name:"",categoryId:null,status:null,isRecommended:null}),R=P([]),L=P([]),w=P(!1),f=M({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:r=>`共 ${r} 条数据`}),g=P(null),o=M({id:0,name:"",description:"",price:0,originalPrice:0,wholesalePrice:0,wholesaleThreshold:0,vipPrice:0,stock:0,categoryId:void 0,status:"off_sale",cover:"",images:[],isRecommended:!1}),te={name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"}],wholesalePrice:[{required:!0,message:"请输入批发价格",trigger:"blur"}],wholesaleThreshold:[{required:!0,message:"请输入批发阈值",trigger:"blur"}],vipPrice:[{required:!0,message:"请输入VIP价格",trigger:"blur"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}],status:[{required:!0,message:"请选择商品状态",trigger:"change"}],stock:[{required:!0,message:"请输入库存数量",trigger:"blur"}]},$=P([]),I=P([]),T=P(!1),z=P(!1),le=Ce(()=>o.id?"编辑商品":"新增商品"),N={Authorization:`Bearer ${V.accessToken}`},E="https://qbylxb.cn/upload/image",se=r=>{if(r.file.status!=="uploading")if(r.file.status==="done"){const e=r.file.response;e.code===0?(o.cover=`https://qbylxb.cn${e.data.image.url}`,c.success("封面图上传成功")):c.error("封面图上传失败")}else r.file.status==="error"&&c.error("封面图上传失败")},re=r=>{const e=[...r.fileList].slice(0,5);I.value=e,r.file.status==="done"?r.file.response.code===0&&(o.images=I.value.filter(i=>{var y,S,q;return((q=(S=(y=i.response)==null?void 0:y.data)==null?void 0:S.image)==null?void 0:q.url)||i.url}).map(i=>{var y,S,q;return`https://qbylxb.cn${(q=(S=(y=i.response)==null?void 0:y.data)==null?void 0:S.image)==null?void 0:q.url}`}),c.success("商品图片上传成功")):r.file.status==="error"&&c.error("商品图片上传失败")};_e(()=>{oe(),x()});const oe=()=>C(this,null,function*(){try{const r=yield Te();r&&r.list&&(R.value=ie(r.list))}catch(r){console.error("获取分类选项失败:",r),c.error("获取分类选项失败")}}),ie=r=>r.filter(e=>!e.parentId||e.parentId===0).map(e=>({id:e.id,name:e.name})),x=()=>C(this,null,function*(){w.value=!0;try{const r={keyword:p.name,categoryId:p.categoryId||void 0,status:p.status||void 0,isRecommended:p.isRecommended,pageNum:f.current,pageSize:f.pageSize},e=yield Ue(r);e&&(L.value=e.list,f.total=e.total),w.value=!1}catch(r){console.error("获取商品列表失败:",r),c.error("获取商品列表失败"),w.value=!1}}),de=r=>{r.current&&(f.current=r.current),r.pageSize&&(f.pageSize=r.pageSize),x()},ne=()=>{f.current=1,x()},ue=()=>{Object.assign(p,{name:"",categoryId:null,status:null,isRecommended:null}),f.current=1,x()},ce=()=>{Object.assign(o,{id:0,name:"",description:"",price:0,originalPrice:0,wholesalePrice:0,wholesaleThreshold:0,vipPrice:0,stock:0,categoryId:void 0,status:"off_sale",cover:"",images:[],isRecommended:!1}),$.value=[],I.value=[],T.value=!0},pe=r=>C(this,null,function*(){try{w.value=!0;const e=yield qe(r.id);if(w.value=!1,e){const l={id:e.id||0,name:e.name,description:e.description||"",price:e.price,originalPrice:e.originalPrice||0,wholesalePrice:e.wholesalePrice||0,wholesaleThreshold:e.wholesaleThreshold||0,vipPrice:e.vipPrice||0,stock:e.stock,categoryId:e.categoryId,status:e.status,cover:e.cover||"",images:e.images||[],isRecommended:e.isRecommended||!1};Object.assign(o,l),$.value=e.cover?[{uid:"-1",name:"cover.jpg",url:e.cover}]:[],I.value=(e.images||[]).map((i,y)=>({uid:`-${y+1}`,name:`image-${y}.jpg`,url:i})),T.value=!0}}catch(e){w.value=!1,console.error("获取商品详情失败:",e),c.error("获取商品详情失败")}}),me=r=>C(this,null,function*(){try{yield Ae(r.id),c.success("删除成功"),x()}catch(e){console.error("删除商品失败:",e),c.error("删除商品失败")}}),ve=r=>C(this,null,function*(){try{const e=r.status==="on_sale"?"off_sale":"on_sale";yield De(r.id,e),c.success(e==="on_sale"?"商品已上架":"商品已下架"),x()}catch(e){console.error("修改商品状态失败:",e),c.error("修改商品状态失败")}}),G=()=>{T.value=!1},fe=()=>C(this,null,function*(){if(g.value)try{yield g.value.validate(),z.value=!0;const r={name:o.name,description:o.description,price:o.price,originalPrice:o.originalPrice,wholesalePrice:o.wholesalePrice||0,wholesaleThreshold:o.wholesaleThreshold||0,vipPrice:o.vipPrice||0,stock:o.stock,categoryId:o.categoryId,status:o.status,cover:o.cover,images:o.images,isRecommended:o.isRecommended};try{o.id?(yield Le(o.id,r),c.success("修改成功")):(yield $e(r),c.success("添加成功")),z.value=!1,T.value=!1,x()}catch(e){z.value=!1,console.error("保存商品失败:",e),c.error("保存商品失败")}}catch(r){console.error("表单验证失败:",r)}}),H=r=>{const e=r.type==="image/jpeg"||r.type==="image/png";e||c.error("只能上传JPG或PNG格式的图片!");let l=!0;return r.size!==void 0&&(l=r.size/1024/1024<2),l||c.error("图片大小不能超过2MB!"),e&&l},ge=r=>r?Re(r).format("YYYY-MM-DD HH:mm:ss"):"-";return(r,e)=>(u(),m("div",null,[t(a(ae),{bordered:!1,class:"mb-20"},{default:s(()=>[t(a(J),{model:p,layout:"inline",class:"search-form",onSubmit:he(ne,["prevent"])},{default:s(()=>[t(a(n),{label:"商品名称"},{default:s(()=>[t(a(Y),{value:p.name,"onUpdate:value":e[0]||(e[0]=l=>p.name=l),placeholder:"请输入商品名称","allow-clear":""},null,8,["value"])]),_:1}),t(a(n),{label:"商品分类"},{default:s(()=>[t(a(B),{value:p.categoryId,"onUpdate:value":e[1]||(e[1]=l=>p.categoryId=l),placeholder:"请选择商品分类",style:{width:"200px"},"allow-clear":""},{default:s(()=>[t(a(k),{value:null},{default:s(()=>e[18]||(e[18]=[d("全部")])),_:1}),(u(!0),m(O,null,ee(R.value,l=>(u(),D(a(k),{key:l.id,value:l.id},{default:s(()=>[d(h(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(a(n),{label:"商品状态"},{default:s(()=>[t(a(B),{value:p.status,"onUpdate:value":e[2]||(e[2]=l=>p.status=l),placeholder:"请选择商品状态",style:{width:"200px"},"allow-clear":""},{default:s(()=>[t(a(k),{value:null},{default:s(()=>e[19]||(e[19]=[d("全部")])),_:1}),t(a(k),{value:"on_sale"},{default:s(()=>e[20]||(e[20]=[d("在售")])),_:1}),t(a(k),{value:"off_sale"},{default:s(()=>e[21]||(e[21]=[d("下架")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(n),{label:"是否推荐"},{default:s(()=>[t(a(B),{value:p.isRecommended,"onUpdate:value":e[3]||(e[3]=l=>p.isRecommended=l),placeholder:"请选择是否推荐",style:{width:"200px"},"allow-clear":""},{default:s(()=>[t(a(k),{value:null},{default:s(()=>e[22]||(e[22]=[d("全部")])),_:1}),t(a(k),{value:"true"},{default:s(()=>e[23]||(e[23]=[d("推荐")])),_:1}),t(a(k),{value:"false"},{default:s(()=>e[24]||(e[24]=[d("不推荐")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(n),null,{default:s(()=>[t(a(K),null,{default:s(()=>[t(a(A),{type:"primary","html-type":"submit"},{default:s(()=>e[25]||(e[25]=[d("查询")])),_:1}),t(a(A),{onClick:ue},{default:s(()=>e[26]||(e[26]=[d("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(a(ae),{bordered:!1},{default:s(()=>[v("div",Be,[e[28]||(e[28]=v("div",{class:"table-title"},"商品列表",-1)),v("div",Ve,[t(a(A),{type:"primary",onClick:ce},{icon:s(()=>[t(a(j))]),default:s(()=>[e[27]||(e[27]=d(" 新增商品 "))]),_:1})])]),t(a(Se),{columns:_,"data-source":L.value,loading:w.value,pagination:f,onChange:de,"row-key":"id"},{bodyCell:s(({column:l,record:i})=>[l.key==="cover"?(u(),m("div",Me,[v("img",{src:i.cover||"/images/default-product.png",alt:"商品图片"},null,8,Oe)])):b("",!0),l.key==="price"?(u(),m("span",je,"¥"+h(i.price),1)):b("",!0),l.key==="wholesalePrice"?(u(),m("span",Fe,"¥"+h(i.wholesalePrice),1)):b("",!0),l.key==="wholesaleThreshold"?(u(),m("span",Ne,h(i.wholesaleThreshold||"-")+" "+h(i.wholesaleThreshold?"件":""),1)):b("",!0),l.key==="vipPrice"?(u(),m("span",Ee,"¥"+h(i.vipPrice),1)):b("",!0),l.key==="status"?(u(),D(a(Q),{key:5,color:i.status==="on_sale"?"green":"orange"},{default:s(()=>[d(h(i.status==="on_sale"?"在售":"下架"),1)]),_:2},1032,["color"])):b("",!0),l.key==="isRecommended"?(u(),D(a(Q),{key:6,color:i.isRecommended?"blue":"default"},{default:s(()=>[d(h(i.isRecommended?"是":"否"),1)]),_:2},1032,["color"])):b("",!0),l.key==="createdAt"?(u(),m(O,{key:7},[d(h(ge(i.createdAt)),1)],64)):b("",!0),l.key==="action"?(u(),D(a(K),{key:8},{default:s(()=>[v("a",{onClick:y=>pe(i)},"编辑",8,Ge),t(a(W),{type:"vertical"}),t(a(ze),{title:"确定删除该商品吗？",onConfirm:y=>me(i),"ok-text":"确定","cancel-text":"取消"},{default:s(()=>e[29]||(e[29]=[v("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"]),t(a(W),{type:"vertical"}),v("a",{onClick:y=>ve(i)},h(i.status==="on_sale"?"下架":"上架"),9,He)]),_:2},1024)):b("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),t(a(Pe),{visible:T.value,"onUpdate:visible":e[17]||(e[17]=l=>T.value=l),title:le.value,width:"800px","mask-closable":!1,onCancel:G},{footer:s(()=>[t(a(A),{onClick:G},{default:s(()=>e[37]||(e[37]=[d("取消")])),_:1}),t(a(A),{type:"primary",loading:z.value,onClick:fe},{default:s(()=>e[38]||(e[38]=[d(" 确定 ")])),_:1},8,["loading"])]),default:s(()=>[t(a(J),{ref_key:"formRef",ref:g,model:o,rules:te,"label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[t(a(n),{label:"商品名称",name:"name"},{default:s(()=>[t(a(Y),{value:o.name,"onUpdate:value":e[4]||(e[4]=l=>o.name=l),placeholder:"请输入商品名称"},null,8,["value"])]),_:1}),t(a(n),{label:"商品分类",name:"categoryId"},{default:s(()=>[t(a(B),{value:o.categoryId,"onUpdate:value":e[5]||(e[5]=l=>o.categoryId=l),placeholder:"请选择商品分类"},{default:s(()=>[(u(!0),m(O,null,ee(R.value,l=>(u(),D(a(k),{key:l.id,value:l.id},{default:s(()=>[d(h(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(a(n),{label:"商品价格",name:"price"},{default:s(()=>[t(a(U),{value:o.price,"onUpdate:value":e[6]||(e[6]=l=>o.price=l),placeholder:"请输入商品价格",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(n),{label:"原价",name:"originalPrice"},{default:s(()=>[t(a(U),{value:o.originalPrice,"onUpdate:value":e[7]||(e[7]=l=>o.originalPrice=l),placeholder:"请输入商品原价",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(n),{label:"批发价格",name:"wholesalePrice",required:""},{default:s(()=>[t(a(U),{value:o.wholesalePrice,"onUpdate:value":e[8]||(e[8]=l=>o.wholesalePrice=l),placeholder:"请输入批发价格",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(n),{label:"批发阈值",name:"wholesaleThreshold",required:""},{default:s(()=>[t(a(U),{value:o.wholesaleThreshold,"onUpdate:value":e[9]||(e[9]=l=>o.wholesaleThreshold=l),placeholder:"请输入批发阈值（件）",min:0,style:{width:"100%"}},null,8,["value"]),e[30]||(e[30]=v("div",{class:"form-item-help"},"达到此数量可享受批发价",-1))]),_:1}),t(a(n),{label:"VIP价格",name:"vipPrice",required:""},{default:s(()=>[t(a(U),{value:o.vipPrice,"onUpdate:value":e[10]||(e[10]=l=>o.vipPrice=l),placeholder:"请输入VIP价格",min:0,precision:2,style:{width:"100%"}},null,8,["value"]),e[31]||(e[31]=v("div",{class:"form-item-help"},"VIP会员专享价格",-1))]),_:1}),t(a(n),{label:"库存",name:"stock"},{default:s(()=>[t(a(U),{value:o.stock,"onUpdate:value":e[11]||(e[11]=l=>o.stock=l),placeholder:"请输入库存数量",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(n),{label:"状态",name:"status"},{default:s(()=>[t(a(we),{value:o.status,"onUpdate:value":e[12]||(e[12]=l=>o.status=l)},{default:s(()=>[t(a(X),{value:"on_sale"},{default:s(()=>e[32]||(e[32]=[d("上架")])),_:1}),t(a(X),{value:"off_sale"},{default:s(()=>e[33]||(e[33]=[d("下架")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(n),{label:"是否推荐",name:"isRecommended"},{default:s(()=>[t(a(ke),{checked:o.isRecommended,"onUpdate:checked":e[13]||(e[13]=l=>o.isRecommended=l),"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:1}),t(a(n),{label:"封面图",name:"cover"},{default:s(()=>[t(a(Z),{"file-list":$.value,"onUpdate:fileList":e[14]||(e[14]=l=>$.value=l),"list-type":"picture-card","show-upload-list":!1,action:E,headers:N,name:"image","before-upload":H,onChange:se},{default:s(()=>[o.cover?(u(),m("div",Je,[v("img",{src:o.cover,alt:"商品封面",style:{width:"100%"}},null,8,Ye)])):(u(),m("div",Ke,[t(a(j)),e[34]||(e[34]=v("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),t(a(n),{label:"商品图片",name:"images"},{default:s(()=>[t(a(Z),{"file-list":I.value,"onUpdate:fileList":e[15]||(e[15]=l=>I.value=l),"list-type":"picture-card",action:E,headers:N,name:"image","before-upload":H,onChange:re},{default:s(()=>[I.value.length>=5?(u(),m("div",Qe,e[35]||(e[35]=[v("div",null,"最多上传5张",-1)]))):(u(),m("div",We,[t(a(j)),e[36]||(e[36]=v("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),t(a(n),{label:"商品描述",name:"description"},{default:s(()=>[t(a(be),{value:o.description,"onUpdate:value":e[16]||(e[16]=l=>o.description=l),placeholder:"请输入商品描述",rows:4},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]))}}),ia=Ie(Xe,[["__scopeId","data-v-938e972f"]]);export{ia as default};
