var x=(y,c,n)=>new Promise((b,g)=>{var i=s=>{try{N(n.next(s))}catch(P){g(P)}},v=s=>{try{N(n.throw(s))}catch(P){g(P)}},N=s=>s.done?b(s.value):Promise.resolve(s.value).then(i,v);N((n=n.apply(y,c)).next())});import{A as l,d as ie,r as q,I as T,o as me,a as k,b as p,z as r,e as $,g as a,B as d,t as M,l as I,f as U,G as pe,J as ce}from"../jse/index-index-IK0MbYCQ.js";import{x as fe,y as ve,z as ye,A as be,B as ge,C as ke,D as Ce}from"./operation-Dt6NDkf8.js";import{D as Ne,a as _}from"./index-DKJMJ4f4.js";import{I as Pe,O as qe,Z as Me,B as w,P as z,R as C,U as h,a1 as j,ac as Ue,ad as R,a3 as _e,b as u,_ as xe}from"./bootstrap-Be81Tyra.js";import{C as F,T as we,a as L,P as he}from"./index-thOj1ETX.js";import{I as G}from"./index-DQxeR_h_.js";import{T as Y}from"./index-CIITXkHm.js";import{P as E}from"./index-DmoQSauz.js";var Ie={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};function J(y){for(var c=1;c<arguments.length;c++){var n=arguments[c]!=null?Object(arguments[c]):{},b=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(n).filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable}))),b.forEach(function(g){Oe(y,g,n[g])})}return y}function Oe(y,c,n){return c in y?Object.defineProperty(y,c,{value:n,enumerable:!0,configurable:!0,writable:!0}):y[c]=n,y}var D=function(c,n){var b=J({},c,n.attrs);return l(Pe,J({},b,{icon:Ie}),null)};D.displayName="InboxOutlined";D.inheritAttrs=!1;const Ae={class:"profile-container"},Be={key:0},$e={class:"add-buttons"},De={key:0,class:"empty-state"},Se={class:"empty-content"},Te={key:0,class:"qr-preview-small"},ze={key:1},Re={key:0,class:"empty-state"},Ve={class:"empty-content"},He={key:0,class:"qr-preview"},je={key:1,class:"upload-button"},Fe=ie({__name:"my-profile",setup(y){const c=qe(),n=q(!1),b=q(!1),g=q(!1),i=q(null),v=q({qrCodes:[],bankCards:[]}),N=q(!1),s=T({name:"",email:"",phone:""}),P=q(!1),A=q("qrCode"),f=T({type:"alipay",name:"",imageUrl:""}),m=T({bankName:"",cardNumber:"",accountName:""}),Q=[{title:"收款方式",dataIndex:"type",key:"type",customRender:({text:t})=>({alipay:"支付宝",wechat:"微信",other:"其他"})[t]||t},{title:"名称",dataIndex:"name",key:"name"},{title:"二维码",dataIndex:"imageUrl",key:"imageUrl",customRender:({text:t})=>t?"已上传":"未上传"},{title:"操作",key:"action"}],Z=[{title:"银行名称",dataIndex:"bankName",key:"bankName"},{title:"卡号",dataIndex:"cardNumber",key:"cardNumber",customRender:({text:t})=>t&&t.length>8?`${t.slice(0,4)}****${t.slice(-4)}`:t},{title:"开户姓名",dataIndex:"accountName",key:"accountName"},{title:"操作",key:"action"}],V=t=>t?ce(t).format("YYYY-MM-DD HH:mm:ss"):"-",W=t=>({admin:"超级管理员",user:"普通管理员"})[t]||t,X=t=>({active:"启用",inactive:"禁用"})[t]||t,K=t=>({active:"green",inactive:"red"})[t]||"default",ee={Authorization:`Bearer ${c.accessToken}`},ae="https://qbylxb.cn/upload/image",te=t=>{const e=t.type==="image/jpeg"||t.type==="image/png";e||u.error("只能上传JPG或PNG格式的图片!");let o=!0;return t.size!==void 0&&(o=t.size/1024/1024<2),o||u.error("图片大小不能超过2MB!"),e&&o},H=()=>x(this,null,function*(){try{b.value=!0;const t=yield fe();i.value=t}catch(t){console.error("获取管理员信息失败:",t),u.error("获取管理员信息失败")}finally{b.value=!1}}),le=()=>x(this,null,function*(){try{g.value=!0;const t=yield ve();v.value=t.paymentMethods||{qrCodes:[],bankCards:[]}}catch(t){console.error("获取收款方式失败:",t),u.error("获取收款方式失败")}finally{g.value=!1}}),re=()=>{i.value&&(s.name=i.value.name||"",s.email=i.value.email||"",s.phone=i.value.phone||""),N.value=!0},oe=()=>x(this,null,function*(){try{n.value=!0,yield ge(s),u.success("个人信息更新成功"),N.value=!1,H()}catch(t){console.error("更新个人信息失败:",t),u.error("更新个人信息失败")}finally{n.value=!1}}),B=t=>{A.value=t,f.type="alipay",f.name="",f.imageUrl="",m.bankName="",m.cardNumber="",m.accountName="",P.value=!0},ne=()=>x(this,null,function*(){try{if(n.value=!0,A.value==="qrCode"){if(!f.name||!f.imageUrl){u.error("请填写完整的收款码信息");return}const t=yield ke(f);v.value=t.paymentMethods,u.success("收款码添加成功")}else{if(!m.bankName||!m.cardNumber||!m.accountName){u.error("请填写完整的银行卡信息");return}const t=m.cardNumber.replace(/\s/g,"");if(!/^\d{16,19}$/.test(t)){u.error("银行卡号格式不正确，应为16-19位数字");return}const e=yield Ce(m);v.value=e.paymentMethods,u.success("银行卡添加成功")}P.value=!1}catch(t){console.error("保存收款方式失败:",t),u.error("保存收款方式失败")}finally{n.value=!1}}),se=t=>x(this,null,function*(){try{const e=yield ye(t);v.value=e.paymentMethods,u.success("收款码删除成功")}catch(e){console.error("删除收款码失败:",e),u.error("删除收款码失败")}}),ue=t=>x(this,null,function*(){try{const e=yield be(t);v.value=e.paymentMethods,u.success("银行卡删除成功")}catch(e){console.error("删除银行卡失败:",e),u.error("删除银行卡失败")}}),de=t=>{if(t.file.status!=="uploading")if(t.file.status==="done"){const e=t.file.response;e.code===0?(f.imageUrl=`https://qbylxb.cn${e.data.image.url}`,u.success("二维码上传成功")):u.error("二维码上传失败")}else t.file.status==="error"&&u.error("二维码上传失败")};return me(()=>{H(),le()}),(t,e)=>(p(),k("div",Ae,[l(a(F),{title:"个人信息",loading:b.value,class:"mb-4"},{extra:r(()=>[l(a(w),{type:"primary",onClick:re},{default:r(()=>e[14]||(e[14]=[d("编辑信息")])),_:1})]),default:r(()=>[i.value?(p(),k("div",Be,[l(a(Ne),{column:2,bordered:""},{default:r(()=>[l(a(_),{label:"用户名"},{default:r(()=>[d(M(i.value.username),1)]),_:1}),l(a(_),{label:"姓名"},{default:r(()=>[d(M(i.value.name||"-"),1)]),_:1}),l(a(_),{label:"手机号"},{default:r(()=>[d(M(i.value.phone||"-"),1)]),_:1}),l(a(_),{label:"邮箱"},{default:r(()=>[d(M(i.value.email||"-"),1)]),_:1}),l(a(_),{label:"角色"},{default:r(()=>[d(M(W(i.value.role)),1)]),_:1}),l(a(_),{label:"状态"},{default:r(()=>[l(a(Me),{color:K(i.value.status)},{default:r(()=>[d(M(X(i.value.status)),1)]),_:1},8,["color"])]),_:1}),l(a(_),{label:"注册时间"},{default:r(()=>[d(M(V(i.value.createdAt)),1)]),_:1}),l(a(_),{label:"更新时间"},{default:r(()=>[d(M(V(i.value.updatedAt)),1)]),_:1})]),_:1})])):$("",!0)]),_:1},8,["loading"]),l(a(F),{title:"收款方式",loading:g.value},{extra:r(()=>[U("div",$e,[l(a(w),{type:"primary",onClick:e[0]||(e[0]=o=>B("qrCode")),class:"mr-2"},{default:r(()=>e[15]||(e[15]=[d(" 添加收款码 ")])),_:1}),l(a(w),{type:"primary",onClick:e[1]||(e[1]=o=>B("bankCard"))},{default:r(()=>e[16]||(e[16]=[d(" 添加银行卡 ")])),_:1})])]),default:r(()=>[l(a(we),{"default-active-key":"qrCode"},{default:r(()=>[l(a(L),{key:"qrCode",tab:"收款码"},{default:r(()=>[v.value.qrCodes.length===0?(p(),k("div",De,[U("div",Se,[l(a(D),{class:"empty-icon"}),e[18]||(e[18]=U("p",{class:"empty-text"},"暂无收款码",-1)),e[19]||(e[19]=U("p",{class:"empty-description"}," 您可以添加支付宝、微信等收款二维码 ",-1)),l(a(w),{type:"primary",onClick:e[2]||(e[2]=o=>B("qrCode"))},{default:r(()=>e[17]||(e[17]=[d(" 立即添加 ")])),_:1})])])):(p(),I(a(Y),{key:1,columns:Q,"data-source":v.value.qrCodes,pagination:!1,"row-key":"name"},{bodyCell:r(({column:o,index:O})=>{var S;return[o.key==="imageUrl"?(p(),k(pe,{key:0},[(S=v.value.qrCodes[O])!=null&&S.imageUrl?(p(),k("div",Te,[l(a(G),{src:v.value.qrCodes[O].imageUrl,alt:"收款码",preview:!0},null,8,["src"])])):(p(),k("span",ze,"未上传"))],64)):$("",!0),o.key==="action"?(p(),I(a(E),{key:1,title:"确定要删除这个收款码吗？",onConfirm:Le=>se(O)},{default:r(()=>[l(a(w),{type:"link",size:"small",danger:""},{default:r(()=>e[20]||(e[20]=[d("删除")])),_:1})]),_:2},1032,["onConfirm"])):$("",!0)]}),_:1},8,["data-source"]))]),_:1}),l(a(L),{key:"bankCard",tab:"银行卡"},{default:r(()=>[v.value.bankCards.length===0?(p(),k("div",Re,[U("div",Ve,[l(a(D),{class:"empty-icon"}),e[22]||(e[22]=U("p",{class:"empty-text"},"暂无银行卡",-1)),e[23]||(e[23]=U("p",{class:"empty-description"},"您可以添加银行卡信息用于收款",-1)),l(a(w),{type:"primary",onClick:e[3]||(e[3]=o=>B("bankCard"))},{default:r(()=>e[21]||(e[21]=[d(" 立即添加 ")])),_:1})])])):(p(),I(a(Y),{key:1,columns:Z,"data-source":v.value.bankCards,pagination:!1,"row-key":"cardNumber"},{bodyCell:r(({column:o,index:O})=>[o.key==="action"?(p(),I(a(E),{key:0,title:"确定要删除这张银行卡吗？",onConfirm:S=>ue(O)},{default:r(()=>[l(a(w),{type:"link",size:"small",danger:""},{default:r(()=>e[24]||(e[24]=[d("删除")])),_:1})]),_:2},1032,["onConfirm"])):$("",!0)]),_:1},8,["data-source"]))]),_:1})]),_:1})]),_:1},8,["loading"]),l(a(j),{visible:N.value,"onUpdate:visible":e[7]||(e[7]=o=>N.value=o),title:"编辑个人信息",width:"600px",onOk:oe,"confirm-loading":n.value},{default:r(()=>[l(a(z),{model:s,layout:"vertical"},{default:r(()=>[l(a(C),{label:"姓名"},{default:r(()=>[l(a(h),{value:s.name,"onUpdate:value":e[4]||(e[4]=o=>s.name=o),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),l(a(C),{label:"邮箱"},{default:r(()=>[l(a(h),{value:s.email,"onUpdate:value":e[5]||(e[5]=o=>s.email=o),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),l(a(C),{label:"手机号"},{default:r(()=>[l(a(h),{value:s.phone,"onUpdate:value":e[6]||(e[6]=o=>s.phone=o),placeholder:"请输入手机号"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"]),l(a(j),{visible:P.value,"onUpdate:visible":e[13]||(e[13]=o=>P.value=o),title:A.value==="qrCode"?"添加收款码":"添加银行卡",width:"600px",onOk:ne,"confirm-loading":n.value},{default:r(()=>[A.value==="qrCode"?(p(),I(a(z),{key:0,model:f,layout:"vertical"},{default:r(()=>[l(a(C),{label:"收款方式类型",required:""},{default:r(()=>[l(a(Ue),{value:f.type,"onUpdate:value":e[8]||(e[8]=o=>f.type=o)},{default:r(()=>[l(a(R),{value:"alipay"},{default:r(()=>e[25]||(e[25]=[d("支付宝")])),_:1}),l(a(R),{value:"wechat"},{default:r(()=>e[26]||(e[26]=[d("微信")])),_:1}),l(a(R),{value:"other"},{default:r(()=>e[27]||(e[27]=[d("其他")])),_:1})]),_:1},8,["value"])]),_:1}),l(a(C),{label:"名称",required:""},{default:r(()=>[l(a(h),{value:f.name,"onUpdate:value":e[9]||(e[9]=o=>f.name=o),placeholder:"请输入收款码名称"},null,8,["value"])]),_:1}),l(a(C),{label:"收款二维码",required:""},{default:r(()=>[l(a(_e),{name:"image","list-type":"picture-card",class:"qr-uploader","show-upload-list":!1,action:ae,headers:ee,"before-upload":te,onChange:de},{default:r(()=>[f.imageUrl?(p(),k("div",He,[l(a(G),{src:f.imageUrl,alt:"收款码",preview:!0},null,8,["src"])])):(p(),k("div",je,[l(a(he)),e[28]||(e[28]=U("div",{class:"ant-upload-text"},"上传二维码",-1))]))]),_:1})]),_:1})]),_:1},8,["model"])):(p(),I(a(z),{key:1,model:m,layout:"vertical"},{default:r(()=>[l(a(C),{label:"银行名称",required:""},{default:r(()=>[l(a(h),{value:m.bankName,"onUpdate:value":e[10]||(e[10]=o=>m.bankName=o),placeholder:"请输入银行名称"},null,8,["value"])]),_:1}),l(a(C),{label:"银行卡号",required:""},{default:r(()=>[l(a(h),{value:m.cardNumber,"onUpdate:value":e[11]||(e[11]=o=>m.cardNumber=o),placeholder:"请输入银行卡号",maxlength:19},null,8,["value"])]),_:1}),l(a(C),{label:"开户姓名",required:""},{default:r(()=>[l(a(h),{value:m.accountName,"onUpdate:value":e[12]||(e[12]=o=>m.accountName=o),placeholder:"请输入开户姓名"},null,8,["value"])]),_:1})]),_:1},8,["model"]))]),_:1},8,["visible","title","confirm-loading"])]))}}),ea=xe(Fe,[["__scopeId","data-v-a9f6545a"]]);export{ea as default};
