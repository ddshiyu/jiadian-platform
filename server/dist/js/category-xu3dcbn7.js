var h=(P,U,v)=>new Promise((b,x)=>{var B=i=>{try{c(v.next(i))}catch(n){x(n)}},A=i=>{try{c(v.throw(i))}catch(n){x(n)}},c=i=>i.done?b(i.value):Promise.resolve(i.value).then(B,A);c((v=v.apply(P,U)).next())});import{ci as te,o as p,aA as N,aB as se,aC as f,aD as O,aE as le,aF as S,n as R,B as _,aH as oe,aI as ne,cj as ie,ck as re,cl as ue,bH as L,ch as de,aJ as ce,aQ as pe}from"./bootstrap-BZ7AE4dT.js";import{t as fe,v as me,w as ve,x as ye}from"./operation-DbhJYR_B.js";import{C as V,P as q}from"./index-CpAE327s.js";import{T as ge}from"./index-Cv6jE2nv.js";import{a3 as be,P as y,T as F,J as ke,ao as Ce,a4 as C,a5 as m,x as t,ah as l,aa as a,at as r,aK as g,aB as M,ae as J,au as we}from"../jse/index-index-C31g8PXS.js";import{P as _e}from"./index-BAx3Ssq2.js";import"./Dropdown-BpOuxWnX.js";import"./index-CN8egozC.js";const xe={class:"table-header"},Ie={class:"table-action"},he={key:0,class:"category-icon"},Ue=["src"],Be={key:1,class:"no-icon"},Ae=["onClick"],De={key:0},Se=["src"],Me={key:1},Pe=be({__name:"category",setup(P){const U=[{title:"分类名称",dataIndex:"name",key:"name",width:"30%"},{title:"图标",dataIndex:"icon",key:"icon",width:100},{title:"排序",dataIndex:"sort",key:"sort",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:200}],v=y([]),b=y(!1),x=te(),B="https://qbylxb.cn/upload/image",A={Authorization:`Bearer ${x.accessToken}`},c=y(!1),i=y(null),n=F({id:0,name:"",parentId:0,icon:"",sort:0,status:"active",description:""}),$={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],status:[{required:!0,message:"请选择分类状态",trigger:"change"}]},I=y([]),k=y(!1),D=y(!1),z=ke(()=>n.id?"编辑分类":"新增分类"),u=F({name:"",status:""});Ce(()=>{w()});const w=()=>h(this,null,function*(){b.value=!0;try{const s=yield fe();if(s){const e=E(s);v.value=u.name||u.status?G(e,u):e}b.value=!1}catch(s){console.error("获取分类列表失败:",s),p.error("获取分类列表失败"),b.value=!1}}),E=s=>s.list.filter(e=>!e.parentId||e.parentId===0).map(e=>({id:e.id||0,name:e.name,icon:e.icon||"",sort:e.sort||0,status:"active",parentId:0,description:e.description||""})),G=(s,e)=>s.filter(o=>{let d=!0,j=!0;return e.name&&(d=o.name.includes(e.name)),e.status&&(j=o.status===e.status),d&&j}),H=()=>{w()},K=()=>{Object.assign(u,{name:"",status:""}),w()},Q=()=>{W()},W=()=>{c.value=!1,Object.assign(n,{id:0,name:"",parentId:0,icon:"",sort:0,status:"active",description:""}),I.value=[],k.value=!0},X=s=>{c.value=!0,Object.assign(n,{id:s.id,name:s.name,parentId:0,icon:s.icon,sort:s.sort,status:s.status,description:s.description||""}),I.value=s.icon?[{uid:"-1",name:"icon.jpg",url:s.icon}]:[],k.value=!0},Y=s=>h(this,null,function*(){try{yield me(s.id),p.success("删除成功"),w()}catch(e){console.error("删除分类失败:",e),p.error("删除分类失败")}}),T=()=>{k.value=!1,c.value=!1},Z=()=>h(this,null,function*(){if(i.value)try{yield i.value.validate(),D.value=!0;const s={name:n.name,icon:n.icon,sort:n.sort,parentId:0};try{n.id?(yield ve(n.id,s),p.success("修改成功")):(yield ye(s),p.success("添加成功")),yield w(),k.value=!1,c.value=!1}catch(e){console.error("保存分类失败:",e),p.error("保存分类失败")}finally{D.value=!1}}catch(s){console.error("表单验证失败:",s)}}),ee=s=>{const e=s.type==="image/jpeg"||s.type==="image/png";e||p.error("只能上传JPG/PNG格式的图片!");const o=s.size!==void 0&&s.size/1024/1024<2;return o||p.error("图片必须小于2MB!"),e&&o},ae=s=>{s.file.status!=="uploading"&&s.file.status==="done"&&(n.icon=`https://qbylxb.cn${s.file.response.data.image.url}`)};return(s,e)=>(m(),C("div",null,[t(a(V),{bordered:!1,class:"mb-20"},{default:l(()=>[t(a(N),{model:u,layout:"inline",class:"search-form",onSubmit:se(H,["prevent"])},{default:l(()=>[t(a(f),{label:"分类名称"},{default:l(()=>[t(a(O),{value:u.name,"onUpdate:value":e[0]||(e[0]=o=>u.name=o),placeholder:"请输入分类名称","allow-clear":""},null,8,["value"])]),_:1}),t(a(f),{label:"状态"},{default:l(()=>[t(a(le),{value:u.status,"onUpdate:value":e[1]||(e[1]=o=>u.status=o),placeholder:"请选择状态",style:{width:"140px"},"allow-clear":""},{default:l(()=>[t(a(S),{value:""},{default:l(()=>e[8]||(e[8]=[r("全部")])),_:1}),t(a(S),{value:"active"},{default:l(()=>e[9]||(e[9]=[r("启用")])),_:1}),t(a(S),{value:"inactive"},{default:l(()=>e[10]||(e[10]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(f),null,{default:l(()=>[t(a(R),null,{default:l(()=>[t(a(_),{type:"primary","html-type":"submit"},{default:l(()=>e[11]||(e[11]=[r("查询")])),_:1}),t(a(_),{onClick:K},{default:l(()=>e[12]||(e[12]=[r("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(a(V),{bordered:!1},{default:l(()=>[g("div",xe,[e[14]||(e[14]=g("div",{class:"table-title"},"商品分类",-1)),g("div",Ie,[t(a(_),{type:"primary",onClick:Q},{icon:l(()=>[t(a(q))]),default:l(()=>[e[13]||(e[13]=r(" 新增分类 "))]),_:1})])]),t(a(ge),{columns:U,"data-source":v.value,loading:b.value,pagination:!1,"row-key":"id"},{bodyCell:l(({column:o,record:d})=>[o.key==="icon"?(m(),C("div",he,[d.icon?(m(),C("img",{key:0,src:d.icon,alt:"分类图标"},null,8,Ue)):(m(),C("div",Be,"无"))])):M("",!0),o.key==="status"?(m(),J(a(oe),{key:1,color:d.status==="active"?"green":"orange"},{default:l(()=>[r(we(d.status==="active"?"启用":"禁用"),1)]),_:2},1032,["color"])):M("",!0),o.key==="action"?(m(),J(a(R),{key:2},{default:l(()=>[g("a",{onClick:()=>X(d)},"编辑",8,Ae),t(a(ne),{type:"vertical"}),t(a(_e),{title:"确定删除该分类吗？",onConfirm:()=>Y(d),"ok-text":"确定","cancel-text":"取消"},{default:l(()=>e[15]||(e[15]=[g("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):M("",!0)]),_:1},8,["data-source","loading"])]),_:1}),t(a(ce),{visible:k.value,"onUpdate:visible":e[7]||(e[7]=o=>k.value=o),title:z.value,width:"600px","mask-closable":!1,onCancel:T},{footer:l(()=>[t(a(_),{onClick:T},{default:l(()=>e[19]||(e[19]=[r("取消")])),_:1}),t(a(_),{type:"primary",loading:D.value,onClick:Z},{default:l(()=>e[20]||(e[20]=[r(" 确定 ")])),_:1},8,["loading"])]),default:l(()=>[t(a(N),{ref_key:"formRef",ref:i,model:n,rules:$,"label-col":{span:4},"wrapper-col":{span:18}},{default:l(()=>[t(a(f),{label:"分类名称",name:"name"},{default:l(()=>[t(a(O),{value:n.name,"onUpdate:value":e[2]||(e[2]=o=>n.name=o),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),t(a(f),{label:"分类图标",name:"icon"},{default:l(()=>[t(a(ie),{"file-list":I.value,"onUpdate:fileList":e[3]||(e[3]=o=>I.value=o),"list-type":"picture-card","show-upload-list":!1,action:B,headers:A,name:"image","before-upload":ee,onChange:ae},{default:l(()=>[n.icon?(m(),C("div",De,[g("img",{src:n.icon,alt:"分类图标",style:{width:"100%"}},null,8,Se)])):(m(),C("div",Me,[t(a(q)),e[16]||(e[16]=g("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),t(a(f),{label:"排序",name:"sort"},{default:l(()=>[t(a(re),{value:n.sort,"onUpdate:value":e[4]||(e[4]=o=>n.sort=o),placeholder:"数字越小越靠前",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(f),{label:"状态",name:"status"},{default:l(()=>[t(a(ue),{value:n.status,"onUpdate:value":e[5]||(e[5]=o=>n.status=o)},{default:l(()=>[t(a(L),{value:"active"},{default:l(()=>e[17]||(e[17]=[r("启用")])),_:1}),t(a(L),{value:"inactive"},{default:l(()=>e[18]||(e[18]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(f),{label:"描述",name:"description"},{default:l(()=>[t(a(de),{value:n.description,"onUpdate:value":e[6]||(e[6]=o=>n.description=o),placeholder:"请输入分类描述",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]))}}),Je=pe(Pe,[["__scopeId","data-v-0bad51e3"]]);export{Je as default};
