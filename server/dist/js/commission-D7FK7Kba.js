var B=(o,d,i)=>new Promise((u,m)=>{var y=r=>{try{p(i.next(r))}catch(n){m(n)}},v=r=>{try{p(i.throw(r))}catch(n){m(n)}},p=r=>r.done?u(r.value):Promise.resolve(r.value).then(y,v);p((i=i.apply(o,d)).next())});import{bf as ae,cd as ue,a6 as re,a7 as de,M as T,a8 as ce,ab as le,ah as fe,a0 as L,an as me,av as Q,c2 as ve,N as pe,ao as ne,ad as ge,ce as ye,o as H,aA as Se,aB as be,aC as q,aE as _e,aF as j,aD as xe,n as Z,B as U,aH as ee,aI as V,aJ as Ce,aQ as ke}from"./bootstrap-BZ7AE4dT.js";import{x as e,a3 as W,P as A,ao as se,p as we,aI as De,T as te,a4 as F,a5 as _,ah as a,aa as t,at as c,aK as N,ae as R,aB as $,au as S,F as Ie,bl as $e}from"../jse/index-index-C31g8PXS.js";import{g as Te,a as he,b as Fe,u as Ne}from"./operation-DbhJYR_B.js";import{S as Re,C as M}from"./index-CpAE327s.js";import{D as P,a as b}from"./index-CiktrRvK.js";import{T as Ae}from"./index-Cv6jE2nv.js";import{P as E}from"./index-BAx3Ssq2.js";import"./Dropdown-BpOuxWnX.js";import"./index-CN8egozC.js";const Y=ae(ue),oe=o=>{const{value:d,formatter:i,precision:u,decimalSeparator:m,groupSeparator:y="",prefixCls:v}=o;let p;if(typeof i=="function")p=i({value:d});else{const r=String(d),n=r.match(/^(-?)(\d*)(\.(\d+))?$/);if(!n)p=r;else{const k=n[1];let f=n[2]||"0",g=n[4]||"";f=f.replace(/\B(?=(\d{3})+(?!\d))/g,y),typeof u=="number"&&(g=g.padEnd(u,"0").slice(0,u>0?u:0)),g&&(g=`${m}${g}`),p=[e("span",{key:"int",class:`${v}-content-value-int`},[k,f]),g&&e("span",{key:"decimal",class:`${v}-content-value-decimal`},[g])]}}return e("span",{class:`${v}-content-value`},[p])};oe.displayName="StatisticNumber";const ze=o=>{const{componentCls:d,marginXXS:i,padding:u,colorTextDescription:m,statisticTitleFontSize:y,colorTextHeading:v,statisticContentFontSize:p,statisticFontFamily:r}=o;return{[`${d}`]:T(T({},ce(o)),{[`${d}-title`]:{marginBottom:i,color:m,fontSize:y},[`${d}-skeleton`]:{paddingTop:u},[`${d}-content`]:{color:v,fontSize:p,fontFamily:r,[`${d}-content-value`]:{display:"inline-block",direction:"ltr"},[`${d}-content-prefix, ${d}-content-suffix`]:{display:"inline-block"},[`${d}-content-prefix`]:{marginInlineEnd:i},[`${d}-content-suffix`]:{marginInlineStart:i}}})}},Me=re("Statistic",o=>{const{fontSizeHeading3:d,fontSize:i,fontFamily:u}=o,m=de(o,{statisticTitleFontSize:i,statisticContentFontSize:d,statisticFontFamily:u});return[ze(m)]}),ie=()=>({prefixCls:String,decimalSeparator:String,groupSeparator:String,format:String,value:ne([Number,String,Object]),valueStyle:{type:Object,default:void 0},valueRender:pe(),formatter:ve(),precision:Number,prefix:Q(),suffix:Q(),title:Q(),loading:me()}),I=W({compatConfig:{MODE:3},name:"AStatistic",inheritAttrs:!1,props:le(ie(),{decimalSeparator:".",groupSeparator:",",loading:!1}),slots:Object,setup(o,d){let{slots:i,attrs:u}=d;const{prefixCls:m,direction:y}=fe("statistic",o),[v,p]=Me(m);return()=>{var r,n,k,f,g,w,h;const{value:X=0,valueStyle:J,valueRender:O}=o,D=m.value,z=(r=o.title)!==null&&r!==void 0?r:(n=i.title)===null||n===void 0?void 0:n.call(i),s=(k=o.prefix)!==null&&k!==void 0?k:(f=i.prefix)===null||f===void 0?void 0:f.call(i),l=(g=o.suffix)!==null&&g!==void 0?g:(w=i.suffix)===null||w===void 0?void 0:w.call(i),x=(h=o.formatter)!==null&&h!==void 0?h:i.formatter;let C=e(oe,L({"data-for-update":Date.now()},T(T({},o),{prefixCls:D,value:X,formatter:x})),null);return O&&(C=O(C)),v(e("div",L(L({},u),{},{class:[D,{[`${D}-rtl`]:y.value==="rtl"},u.class,p.value]}),[z&&e("div",{class:`${D}-title`},[z]),e(Re,{paragraph:!1,loading:o.loading},{default:()=>[e("div",{style:J,class:`${D}-content`},[s&&e("span",{class:`${D}-content-prefix`},[s]),C,l&&e("span",{class:`${D}-content-suffix`},[l])])]})]))}}}),Be=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function He(o,d){let i=o;const u=/\[[^\]]*]/g,m=(d.match(u)||[]).map(r=>r.slice(1,-1)),y=d.replace(u,"[]"),v=Be.reduce((r,n)=>{let[k,f]=n;if(r.includes(k)){const g=Math.floor(i/f);return i-=g*f,r.replace(new RegExp(`${k}+`,"g"),w=>{const h=w.length;return g.toString().padStart(h,"0")})}return r},y);let p=0;return v.replace(u,()=>{const r=m[p];return p+=1,r})}function Ee(o,d){const{format:i=""}=d,u=new Date(o).getTime(),m=Date.now(),y=Math.max(u-m,0);return He(y,i)}const Oe=1e3/30;function G(o){return new Date(o).getTime()}const je=()=>T(T({},ie()),{value:ne([Number,String,Object]),format:String,onFinish:Function,onChange:Function}),Ue=W({compatConfig:{MODE:3},name:"AStatisticCountdown",props:le(je(),{format:"HH:mm:ss"}),setup(o,d){let{emit:i,slots:u}=d;const m=A(),y=A(),v=()=>{const{value:f}=o;G(f)>=Date.now()?p():r()},p=()=>{if(m.value)return;const f=G(o.value);m.value=setInterval(()=>{y.value.$forceUpdate(),f>Date.now()&&i("change",f-Date.now()),v()},Oe)},r=()=>{const{value:f}=o;m.value&&(clearInterval(m.value),m.value=void 0,G(f)<Date.now()&&i("finish"))},n=f=>{let{value:g,config:w}=f;const{format:h}=o;return Ee(g,T(T({},w),{format:h}))},k=f=>f;return se(()=>{v()}),we(()=>{v()}),De(()=>{r()}),()=>{const f=o.value;return e(I,L({ref:y},T(T({},ge(o,["onFinish","onChange"])),{value:f,valueRender:k,formatter:n})),u)}}});I.Countdown=Ue;I.install=function(o){return o.component(I.name,I),o.component(I.Countdown.name,I.Countdown),o};I.Countdown;const Ve=ae(ye),Pe=["onClick"],Ye={key:0,class:"loading-container"},Le={key:1},Xe={class:"price"},Je=["src"],Ke={key:1},Qe=["src"],qe={key:1},Ge={class:"price"},We={key:3,class:"modal-action"},Ze=W({__name:"commission",setup(o){const d=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"获得用户",dataIndex:"user",key:"user",customRender:({record:s})=>s.user?`${s.user.nickname} (${s.user.phone})`:"-"},{title:"邀请用户",dataIndex:"invitee",key:"invitee",customRender:({record:s})=>s.invitee?`${s.invitee.nickname} (${s.invitee.phone})`:"-"},{title:"订单号",dataIndex:"order",key:"order",customRender:({record:s})=>s.order?s.order.orderNo:"-"},{title:"佣金金额",dataIndex:"amount",key:"amount",width:100,customRender:({text:s})=>`¥${s.toFixed(2)}`},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:180},{title:"操作",key:"action",width:180}],i=A({totalCommission:0,todayCommission:0,monthCommission:0,totalRecords:0}),u=te({status:null,userId:null}),m=A([]),y=A(!1),v=te({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:s=>`共 ${s} 条数据`}),p=A(!1),r=A(!1),n=A(null),k={pending:"orange",settled:"green",cancelled:"red"},f={pending:"待结算",settled:"已结算",cancelled:"已取消"};se(()=>{g(),w()});const g=()=>B(this,null,function*(){try{const s=yield Te();s&&(i.value=s)}catch(s){console.error("获取佣金统计数据失败:",s),H.error("获取佣金统计数据失败")}}),w=()=>B(this,null,function*(){y.value=!0;try{const s={status:u.status||void 0,userId:u.userId===null?void 0:u.userId,pageNum:v.current,pageSize:v.pageSize},l=yield he(s);l&&(m.value=l.list,v.total=l.total),y.value=!1}catch(s){console.error("获取佣金列表失败:",s),H.error("获取佣金列表失败"),y.value=!1}}),h=s=>{s.current&&(v.current=s.current),s.pageSize&&(v.pageSize=s.pageSize),w()},X=()=>{v.current=1,w()},J=()=>{Object.assign(u,{status:null,userId:null}),v.current=1,w()},O=s=>B(this,null,function*(){r.value=!0,p.value=!0;try{const l=yield Fe(s.id);l&&(n.value=l),r.value=!1}catch(l){console.error("获取佣金详情失败:",l),H.error("获取佣金详情失败"),r.value=!1}}),D=(s,l)=>B(this,null,function*(){try{yield Ne(s.id,l),H.success("状态更新成功"),w(),g()}catch(x){console.error("更新佣金状态失败:",x),H.error("更新佣金状态失败")}}),z=s=>s?$e(s).format("YYYY-MM-DD HH:mm:ss"):"-";return(s,l)=>(_(),F("div",null,[e(t(Ve),{gutter:16,class:"mb-20"},{default:a(()=>[e(t(Y),{span:6},{default:a(()=>[e(t(M),null,{default:a(()=>[e(t(I),{title:"总佣金金额",value:i.value.totalCommission,precision:2,suffix:"元","value-style":{color:"#3f8600"}},null,8,["value"])]),_:1})]),_:1}),e(t(Y),{span:6},{default:a(()=>[e(t(M),null,{default:a(()=>[e(t(I),{title:"今日佣金",value:i.value.todayCommission,precision:2,suffix:"元","value-style":{color:"#cf1322"}},null,8,["value"])]),_:1})]),_:1}),e(t(Y),{span:6},{default:a(()=>[e(t(M),null,{default:a(()=>[e(t(I),{title:"本月佣金",value:i.value.monthCommission,precision:2,suffix:"元"},null,8,["value"])]),_:1})]),_:1}),e(t(Y),{span:6},{default:a(()=>[e(t(M),null,{default:a(()=>[e(t(I),{title:"佣金记录总数",value:i.value.totalRecords,"value-style":{color:"#1890ff"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(t(M),{bordered:!1,class:"mb-20"},{default:a(()=>[e(t(Se),{model:u,layout:"inline",class:"search-form",onSubmit:be(X,["prevent"])},{default:a(()=>[e(t(q),{label:"佣金状态"},{default:a(()=>[e(t(_e),{value:u.status,"onUpdate:value":l[0]||(l[0]=x=>u.status=x),placeholder:"请选择佣金状态",style:{width:"200px"},"allow-clear":""},{default:a(()=>[e(t(j),{value:null},{default:a(()=>l[5]||(l[5]=[c("全部")])),_:1}),e(t(j),{value:"pending"},{default:a(()=>l[6]||(l[6]=[c("待结算")])),_:1}),e(t(j),{value:"settled"},{default:a(()=>l[7]||(l[7]=[c("已结算")])),_:1}),e(t(j),{value:"cancelled"},{default:a(()=>l[8]||(l[8]=[c("已取消")])),_:1})]),_:1},8,["value"])]),_:1}),e(t(q),{label:"用户ID"},{default:a(()=>[e(t(xe),{value:u.userId===null?"":u.userId,placeholder:"请输入用户ID",style:{width:"200px"},"allow-clear":"","onUpdate:value":l[1]||(l[1]=x=>u.userId=x?Number(x):null)},null,8,["value"])]),_:1}),e(t(q),null,{default:a(()=>[e(t(Z),null,{default:a(()=>[e(t(U),{type:"primary","html-type":"submit"},{default:a(()=>l[9]||(l[9]=[c("查询")])),_:1}),e(t(U),{onClick:J},{default:a(()=>l[10]||(l[10]=[c("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(t(M),{bordered:!1},{default:a(()=>[l[14]||(l[14]=N("div",{class:"table-header"},[N("div",{class:"table-title"},"佣金记录")],-1)),e(t(Ae),{columns:d,"data-source":m.value,loading:y.value,pagination:v,onChange:h,"row-key":"id"},{bodyCell:a(({column:x,record:C})=>[x.key==="status"?(_(),R(t(ee),{key:0,color:k[C.status]},{default:a(()=>[c(S(f[C.status]),1)]),_:2},1032,["color"])):$("",!0),x.key==="createdAt"?(_(),F(Ie,{key:1},[c(S(z(C.createdAt)),1)],64)):$("",!0),x.key==="action"?(_(),R(t(Z),{key:2},{default:a(()=>[N("a",{onClick:K=>O(C)},"详情",8,Pe),e(t(V),{type:"vertical"}),C.status==="pending"?(_(),R(t(E),{key:0,title:"确定结算该佣金吗？",onConfirm:K=>D(C,"settled"),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>l[11]||(l[11]=[N("a",null,"结算",-1)])),_:2},1032,["onConfirm"])):$("",!0),C.status==="pending"?(_(),R(t(E),{key:1,title:"确定取消该佣金吗？",onConfirm:K=>D(C,"cancelled"),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>l[12]||(l[12]=[N("a",{class:"danger-link"},"取消",-1)])),_:2},1032,["onConfirm"])):$("",!0),C.status==="cancelled"?(_(),R(t(E),{key:2,title:"确定恢复为待结算状态吗？",onConfirm:K=>D(C,"pending"),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>l[13]||(l[13]=[N("a",null,"恢复",-1)])),_:2},1032,["onConfirm"])):$("",!0)]),_:2},1024)):$("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),e(t(Ce),{visible:p.value,"onUpdate:visible":l[4]||(l[4]=x=>p.value=x),title:"佣金详情",width:"800px",footer:null,"mask-closable":!0},{default:a(()=>[r.value?(_(),F("div",Ye,"加载中...")):n.value?(_(),F("div",Le,[e(t(P),{bordered:"",column:2},{default:a(()=>[e(t(b),{label:"佣金ID"},{default:a(()=>[c(S(n.value.id),1)]),_:1}),e(t(b),{label:"佣金金额"},{default:a(()=>[N("span",Xe,"¥"+S(n.value.amount.toFixed(2)),1)]),_:1}),e(t(b),{label:"佣金状态"},{default:a(()=>[e(t(ee),{color:k[n.value.status]},{default:a(()=>[c(S(f[n.value.status]),1)]),_:1},8,["color"])]),_:1}),e(t(b),{label:"创建时间"},{default:a(()=>[c(S(z(n.value.createdAt)),1)]),_:1}),e(t(b),{label:"更新时间"},{default:a(()=>[c(S(z(n.value.updatedAt)),1)]),_:1})]),_:1}),e(t(V),null,{default:a(()=>l[15]||(l[15]=[c("佣金获得者信息")])),_:1}),n.value.user?(_(),R(t(P),{key:0,bordered:"",column:2},{default:a(()=>[e(t(b),{label:"用户ID"},{default:a(()=>[c(S(n.value.user.id),1)]),_:1}),e(t(b),{label:"用户昵称"},{default:a(()=>[c(S(n.value.user.nickname),1)]),_:1}),e(t(b),{label:"手机号"},{default:a(()=>[c(S(n.value.user.phone),1)]),_:1}),e(t(b),{label:"头像"},{default:a(()=>[n.value.user.avatar?(_(),F("img",{key:0,src:n.value.user.avatar,alt:"用户头像",class:"user-avatar"},null,8,Je)):(_(),F("span",Ke,"无头像"))]),_:1})]),_:1})):$("",!0),e(t(V),null,{default:a(()=>l[16]||(l[16]=[c("邀请人信息")])),_:1}),n.value.invitee?(_(),R(t(P),{key:1,bordered:"",column:2},{default:a(()=>[e(t(b),{label:"用户ID"},{default:a(()=>[c(S(n.value.invitee.id),1)]),_:1}),e(t(b),{label:"用户昵称"},{default:a(()=>[c(S(n.value.invitee.nickname),1)]),_:1}),e(t(b),{label:"手机号"},{default:a(()=>[c(S(n.value.invitee.phone),1)]),_:1}),e(t(b),{label:"头像"},{default:a(()=>[n.value.invitee.avatar?(_(),F("img",{key:0,src:n.value.invitee.avatar,alt:"用户头像",class:"user-avatar"},null,8,Qe)):(_(),F("span",qe,"无头像"))]),_:1})]),_:1})):$("",!0),e(t(V),null,{default:a(()=>l[17]||(l[17]=[c("关联订单信息")])),_:1}),n.value.order?(_(),R(t(P),{key:2,bordered:"",column:2},{default:a(()=>[e(t(b),{label:"订单ID"},{default:a(()=>[c(S(n.value.order.id),1)]),_:1}),e(t(b),{label:"订单号"},{default:a(()=>[c(S(n.value.order.orderNo),1)]),_:1}),e(t(b),{label:"订单金额"},{default:a(()=>[N("span",Ge,"¥"+S(n.value.order.totalAmount),1)]),_:1}),e(t(b),{label:"订单状态"},{default:a(()=>[c(S(n.value.order.status),1)]),_:1}),e(t(b),{label:"下单时间"},{default:a(()=>[c(S(z(n.value.order.createdAt)),1)]),_:1})]),_:1})):$("",!0),n.value&&n.value.status==="pending"?(_(),F("div",We,[e(t(E),{title:"确定结算该佣金吗？",onConfirm:l[2]||(l[2]=()=>{D(n.value,"settled"),p.value=!1}),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>[e(t(U),{type:"primary"},{default:a(()=>l[18]||(l[18]=[c("结算佣金")])),_:1})]),_:1}),e(t(E),{title:"确定取消该佣金吗？",onConfirm:l[3]||(l[3]=()=>{D(n.value,"cancelled"),p.value=!1}),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>[e(t(U),{danger:"",style:{"margin-left":"10px"}},{default:a(()=>l[19]||(l[19]=[c("取消佣金")])),_:1})]),_:1})])):$("",!0)])):$("",!0)]),_:1},8,["visible"])]))}}),dt=ke(Ze,[["__scopeId","data-v-e219057e"]]);export{dt as default};
