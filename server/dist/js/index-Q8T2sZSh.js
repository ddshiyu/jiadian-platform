var M=(C,R,b)=>new Promise((y,U)=>{var f=h=>{try{_(b.next(h))}catch(i){U(i)}},k=h=>{try{_(b.throw(h))}catch(i){U(i)}},_=h=>h.done?y(h.value):Promise.resolve(h.value).then(f,k);_((b=b.apply(C,R)).next())});import{I as $e,O as Ve,af as He,b as u,P as me,Q as Ge,R as w,U as ee,W as Y,X as B,S as te,B as S,aJ as Je,Z as fe,a0 as ve,a4 as V,ac as We,ad as ge,aK as Ye,a3 as ae,a2 as Xe,a1 as le,_ as Ke}from"./bootstrap-Be81Tyra.js";import{A as s,a2 as X,d as Qe,c as ye,I as oe,r as A,o as Ze,a as x,b as g,z as r,g as l,B as m,G as se,H as he,l as H,t as E,f as p,e as T,J as et,F as G}from"../jse/index-index-IK0MbYCQ.js";import{j as tt,E as at,F as lt,G as ot,H as st,I as rt,J as it,K as nt,L as dt}from"./operation-Dt6NDkf8.js";import{C as we,P as re}from"./index-thOj1ETX.js";import{I as ut}from"./index-DQxeR_h_.js";import{T as ct}from"./index-CIITXkHm.js";import{P as pt}from"./index-DmoQSauz.js";var mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function be(C){for(var R=1;R<arguments.length;R++){var b=arguments[R]!=null?Object(arguments[R]):{},y=Object.keys(b);typeof Object.getOwnPropertySymbols=="function"&&(y=y.concat(Object.getOwnPropertySymbols(b).filter(function(U){return Object.getOwnPropertyDescriptor(b,U).enumerable}))),y.forEach(function(U){ft(C,U,b[U])})}return C}function ft(C,R,b){return R in C?Object.defineProperty(C,R,{value:b,enumerable:!0,configurable:!0,writable:!0}):C[R]=b,C}var Q=function(R,b){var y=be({},R,b.attrs);return s($e,be({},y,{icon:mt}),null)};Q.displayName="UploadOutlined";Q.inheritAttrs=!1;var K={exports:{}},vt=K.exports,Pe;function gt(){return Pe||(Pe=1,function(C,R){(function(b,y){y()})(vt,function(){function b(i,d){return typeof d=="undefined"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function y(i,d,a){var c=new XMLHttpRequest;c.open("GET",i),c.responseType="blob",c.onload=function(){h(c.response,d,a)},c.onerror=function(){console.error("could not download file")},c.send()}function U(i){var d=new XMLHttpRequest;d.open("HEAD",i,!1);try{d.send()}catch(a){}return 200<=d.status&&299>=d.status}function f(i){try{i.dispatchEvent(new MouseEvent("click"))}catch(a){var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(d)}}var k=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof X=="object"&&X.global===X?X:void 0,_=k.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),h=k.saveAs||(typeof window!="object"||window!==k?function(){}:"download"in HTMLAnchorElement.prototype&&!_?function(i,d,a){var c=k.URL||k.webkitURL,P=document.createElement("a");d=d||i.name||"download",P.download=d,P.rel="noopener",typeof i=="string"?(P.href=i,P.origin===location.origin?f(P):U(P.href)?y(i,d,a):f(P,P.target="_blank")):(P.href=c.createObjectURL(i),setTimeout(function(){c.revokeObjectURL(P.href)},4e4),setTimeout(function(){f(P)},0))}:"msSaveOrOpenBlob"in navigator?function(i,d,a){if(d=d||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(b(i,a),d);else if(U(i))y(i,d,a);else{var c=document.createElement("a");c.href=i,c.target="_blank",setTimeout(function(){f(c)})}}:function(i,d,a,c){if(c=c||open("","_blank"),c&&(c.document.title=c.document.body.innerText="downloading..."),typeof i=="string")return y(i,d,a);var P=i.type==="application/octet-stream",O=/constructor/i.test(k.HTMLElement)||k.safari,L=/CriOS\/[\d]+/.test(navigator.userAgent);if((L||P&&O||_)&&typeof FileReader!="undefined"){var D=new FileReader;D.onloadend=function(){var F=D.result;F=L?F:F.replace(/^data:[^;]*;/,"data:attachment/file;"),c?c.location.href=F:location=F,c=null},D.readAsDataURL(i)}else{var J=k.URL||k.webkitURL,j=J.createObjectURL(i);c?c.location=j:location.href=j,c=null,setTimeout(function(){J.revokeObjectURL(j)},4e4)}});k.saveAs=h.saveAs=h,C.exports=h})}(K)),K.exports}var yt=gt();const ht={class:"table-header"},wt={class:"table-action"},bt={key:0,class:"product-cover"},Pt={key:1,class:"price"},kt={key:2,class:"price"},xt={key:3},Rt={key:4,class:"price"},It=["onClick"],Ct=["onClick"],Ut={key:1,class:"disabled-text"},At={key:0,class:"form-item-help text-warning"},Et={key:0},St=["src"],Tt={key:1},_t={key:0},Ot={key:1},Lt={class:"import-content"},jt={class:"upload-area"},Ft=Qe({__name:"index",setup(C){const R=Ve(),b=He(),y=ye(()=>{var t;return((t=b.userInfo)==null?void 0:t.role)==="admin"}),U=[{title:"商品图片",dataIndex:"cover",key:"cover",width:100},{title:"商品名称",dataIndex:"name",key:"name"},{title:"价格",dataIndex:"price",key:"price",width:100},{title:"批发价",dataIndex:"wholesalePrice",key:"wholesalePrice",width:100},{title:"批发阈值",dataIndex:"wholesaleThreshold",key:"wholesaleThreshold",width:100},{title:"VIP价格",dataIndex:"vipPrice",key:"vipPrice",width:100},{title:"分类",dataIndex:"category",key:"category",customRender:({record:t})=>{var e;return((e=t.Category)==null?void 0:e.name)||"-"}},{title:"库存",dataIndex:"stock",key:"stock",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"推荐",dataIndex:"isRecommended",key:"isRecommended",width:80},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150},{title:"操作",key:"action",width:200}],f=oe({name:"",categoryId:null,status:null,isRecommended:null}),k=A([]),_=A([]),h=A(!1),i=oe({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:t=>`共 ${t} 条数据`}),d=A(null),a=oe({id:0,name:"",description:"",price:0,originalPrice:0,wholesalePrice:0,wholesaleThreshold:0,vipPrice:0,stock:0,categoryId:void 0,status:"off_sale",cover:"",images:[],isRecommended:!1,commissionAmount:"",feeRate:0,basePrices:{price:0,originalPrice:0,wholesalePrice:0,vipPrice:0}}),c={name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"}],wholesalePrice:[{required:!0,message:"请输入批发价格",trigger:"blur"}],wholesaleThreshold:[{required:!0,message:"请输入批发阈值",trigger:"blur"}],vipPrice:[{required:!0,message:"请输入VIP价格",trigger:"blur"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}],status:[{required:!0,message:"请选择商品状态",trigger:"change"}],stock:[{required:!0,message:"请输入库存数量",trigger:"blur"}],commissionAmount:[{validator:(t,e)=>{if(!e)return Promise.resolve();if(e.endsWith("%")){const n=parseFloat(e.slice(0,-1));return isNaN(n)||n<0||n>100?Promise.reject("佣金百分比应在0-100%之间"):Promise.resolve()}const o=parseFloat(e);return isNaN(o)||o<0?Promise.reject("佣金金额应为非负数或百分比格式（如：10 或 5%）"):Promise.resolve()},trigger:"blur"}]},P=A([]),O=A([]),L=A(!1),D=A(!1),J=ye(()=>a.id?"编辑商品":"新增商品"),j=A(!1),F=A(!1),N=A([]),ie={Authorization:`Bearer ${R.accessToken}`},ne="https://qbylxb.cn/upload/image",ke=t=>{if(t.file.status!=="uploading")if(t.file.status==="done"){const e=t.file.response;e.code===0?(a.cover=`https://qbylxb.cn${e.data.image.url}`,u.success("封面图上传成功")):u.error("封面图上传失败")}else t.file.status==="error"&&u.error("封面图上传失败")},xe=t=>{const e=[...t.fileList].slice(0,5);O.value=e,t.file.status==="done"?t.file.response.code===0&&(a.images=O.value.filter(n=>{var v,z,$;return(($=(z=(v=n.response)==null?void 0:v.data)==null?void 0:z.image)==null?void 0:$.url)||n.url}).map(n=>{var v,z,$;return`https://qbylxb.cn${($=(z=(v=n.response)==null?void 0:v.data)==null?void 0:z.image)==null?void 0:$.url}`}),u.success("商品图片上传成功")):t.file.status==="error"&&u.error("商品图片上传失败")};Ze(()=>{Re(),q()});const Re=()=>M(this,null,function*(){try{const t=yield tt();t&&t.list&&(k.value=Ie(t.list))}catch(t){console.error("获取分类选项失败:",t),u.error("获取分类选项失败")}}),Ie=t=>t.filter(e=>!e.parentId||e.parentId===0).map(e=>({id:e.id,name:e.name})),q=()=>M(this,null,function*(){h.value=!0;try{const t={keyword:f.name,categoryId:f.categoryId||void 0,status:f.status||void 0,isRecommended:f.isRecommended,pageNum:i.current,pageSize:i.pageSize},e=yield at(t);e&&(_.value=e.list,i.total=e.total),h.value=!1}catch(t){console.error("获取商品列表失败:",t),u.error("获取商品列表失败"),h.value=!1}}),Ce=t=>{t.current&&(i.current=t.current),t.pageSize&&(i.pageSize=t.pageSize),q()},Ue=()=>{i.current=1,q()},Ae=()=>{Object.assign(f,{name:"",categoryId:null,status:null,isRecommended:null}),i.current=1,q()},Ee=()=>{Object.assign(a,{id:0,name:"",description:"",price:0,originalPrice:0,wholesalePrice:0,wholesaleThreshold:0,vipPrice:0,stock:0,categoryId:void 0,status:"off_sale",cover:"",images:[],isRecommended:!1,commissionAmount:"",feeRate:0,basePrices:{price:0,originalPrice:0,wholesalePrice:0,vipPrice:0}}),P.value=[],O.value=[],L.value=!0},Se=t=>M(this,null,function*(){try{h.value=!0;const e=yield lt(t.id);if(h.value=!1,e){const o={id:e.id||0,name:e.name,description:e.description||"",price:e.price,originalPrice:e.originalPrice||0,wholesalePrice:e.wholesalePrice||0,wholesaleThreshold:e.wholesaleThreshold||0,vipPrice:e.vipPrice||0,stock:e.stock,categoryId:e.categoryId,status:e.status,cover:e.cover||"",images:e.images||[],isRecommended:e.isRecommended||!1,commissionAmount:e.commissionAmount||"",feeRate:0,basePrices:{price:e.price,originalPrice:e.originalPrice||0,wholesalePrice:e.wholesalePrice||0,vipPrice:e.vipPrice||0}};!y.value&&o.status==="on_sale"&&(o.status="off_sale",u.warning("非管理员用户编辑商品时将自动设置为下架状态")),Object.assign(a,o),P.value=e.cover?[{uid:"-1",name:"cover.jpg",url:e.cover}]:[],O.value=(e.images||[]).map((n,v)=>({uid:`-${v+1}`,name:`image-${v}.jpg`,url:n})),L.value=!0}}catch(e){h.value=!1,console.error("获取商品详情失败:",e),u.error("获取商品详情失败")}}),Te=t=>M(this,null,function*(){try{yield ot(t.id),u.success("删除成功"),q()}catch(e){console.error("删除商品失败:",e),u.error("删除商品失败")}}),_e=t=>M(this,null,function*(){try{const e=t.status==="on_sale"?"off_sale":"on_sale";if(!y.value&&e==="on_sale"){u.error("只有管理员可以将商品设置为上架状态");return}yield st(t.id,e),u.success(e==="on_sale"?"商品已上架":"商品已下架"),q()}catch(e){console.error("修改商品状态失败:",e),u.error("修改商品状态失败")}}),de=()=>{L.value=!1},Oe=()=>M(this,null,function*(){if(d.value)try{if(yield d.value.validate(),!y.value&&a.status==="on_sale"){u.error("只有管理员可以将商品设置为上架状态");return}D.value=!0;const t={name:a.name,description:a.description,price:a.price,originalPrice:a.originalPrice,wholesalePrice:a.wholesalePrice||0,wholesaleThreshold:a.wholesaleThreshold||0,vipPrice:a.vipPrice||0,stock:a.stock,categoryId:a.categoryId,status:a.status,cover:a.cover,images:a.images,isRecommended:a.isRecommended,commissionAmount:a.commissionAmount};try{a.id?(yield rt(a.id,t),u.success("修改成功")):(yield it(t),u.success("添加成功")),D.value=!1,L.value=!1,q()}catch(e){D.value=!1,console.error("保存商品失败:",e),u.error("保存商品失败")}}catch(t){console.error("表单验证失败:",t)}}),ue=t=>{const e=t.type==="image/jpeg"||t.type==="image/png";e||u.error("只能上传JPG或PNG格式的图片!");let o=!0;return t.size!==void 0&&(o=t.size/1024/1024<2),o||u.error("图片大小不能超过2MB!"),e&&o},Le=t=>t?et(t).format("YYYY-MM-DD HH:mm:ss"):"-",je=()=>{if(!a.basePrices||!a.feeRate)return;const t=1+a.feeRate/100;a.price=Number((a.basePrices.price*t).toFixed(2)),a.originalPrice=Number((a.basePrices.originalPrice*t).toFixed(2)),a.wholesalePrice=Number((a.basePrices.wholesalePrice*t).toFixed(2)),a.vipPrice=Number((a.basePrices.vipPrice*t).toFixed(2))},W=()=>{a.basePrices||(a.basePrices={price:0,originalPrice:0,wholesalePrice:0,vipPrice:0}),a.basePrices.price=a.price,a.basePrices.originalPrice=a.originalPrice||0,a.basePrices.wholesalePrice=a.wholesalePrice||0,a.basePrices.vipPrice=a.vipPrice||0},Fe=t=>{if(t==null){a.feeRate=0;return}const e=typeof t=="string"?parseFloat(t):t;a.feeRate=isNaN(e)?0:e,je()},Me=()=>M(this,null,function*(){try{console.log("开始下载模板...");const t=yield nt();if(console.log("收到Blob:",{size:t.size,type:t.type}),!t||!(t instanceof Blob)||t.size===0)throw new Error("下载的文件为空或格式不正确");const e="商品导入模板.xlsx";try{yt.saveAs(t,e),u.success("模板下载成功")}catch(o){console.error("file-saver 保存失败:",o);const n=window.URL.createObjectURL(t),v=document.createElement("a");v.href=n,v.download=e,v.style.display="none",document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(n),u.success("模板下载成功")}}catch(t){console.error("下载模板失败:",t),u.error(`下载模板失败: ${t instanceof Error?t.message:"未知错误"}`)}}),Be=()=>{N.value=[],j.value=!0},De=t=>{const e=t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||t.type==="application/vnd.ms-excel";e||u.error("只能上传Excel格式的文件!");const o=(t.size||0)/1024/1024<10;return o||u.error("文件大小不能超过10MB!"),e&&o},Ne=t=>{N.value=[...t.fileList].slice(-1)},qe=()=>M(this,null,function*(){var o,n,v,z,$;if(N.value.length===0){u.error("请选择要导入的Excel文件");return}const t=N.value[0];if(!(t!=null&&t.originFileObj)){u.error("文件格式错误");return}const e=t.originFileObj;try{F.value=!0,console.log("开始Excel导入，文件名:",e.name,"大小:",e.size);const I=yield dt(e);if(console.log("Excel导入响应:",I),I.success)u.success(`导入成功！成功导入 ${((o=I.data)==null?void 0:o.successCount)||0} 个商品`),j.value=!1,N.value=[],yield q();else throw new Error(I.message||"导入失败")}catch(I){if(console.error("Excel导入失败:",I),(v=(n=I.response)==null?void 0:n.data)!=null&&v.errors&&Array.isArray(I.response.data.errors)){const pe=I.response.data.errors,Z=I.response.data.totalErrors||pe.length;le.error({title:`导入失败 (共${Z}个错误)`,content:G("div",{style:"max-height: 300px; overflow-y: auto;"},[G("div",{style:"margin-bottom: 10px; color: #666;"},"请修正以下错误后重新导入："),G("ol",{style:"margin: 0; padding-left: 20px;"},pe.slice(0,20).map(ze=>G("li",{style:"margin-bottom: 5px;"},ze))),Z>20?G("div",{style:"margin-top: 10px; color: #999;"},`还有 ${Z-20} 个错误未显示...`):null]),width:600,okText:"我知道了"})}else($=(z=I.response)==null?void 0:z.data)!=null&&$.message?u.error(I.response.data.message):I.message?u.error(I.message):u.error("Excel导入失败，请检查文件格式")}finally{F.value=!1}}),ce=()=>{N.value=[],j.value=!1};return(t,e)=>(g(),x("div",null,[s(l(we),{bordered:!1,class:"mb-20"},{default:r(()=>[s(l(me),{model:f,layout:"inline",class:"search-form",onSubmit:Ge(Ue,["prevent"])},{default:r(()=>[s(l(w),{label:"商品名称"},{default:r(()=>[s(l(ee),{value:f.name,"onUpdate:value":e[0]||(e[0]=o=>f.name=o),placeholder:"请输入商品名称","allow-clear":""},null,8,["value"])]),_:1}),s(l(w),{label:"商品分类"},{default:r(()=>[s(l(Y),{value:f.categoryId,"onUpdate:value":e[1]||(e[1]=o=>f.categoryId=o),placeholder:"请选择商品分类",style:{width:"200px"},"allow-clear":""},{default:r(()=>[s(l(B),{value:null},{default:r(()=>e[22]||(e[22]=[m("全部")])),_:1}),(g(!0),x(se,null,he(k.value,o=>(g(),H(l(B),{key:o.id,value:o.id},{default:r(()=>[m(E(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(l(w),{label:"商品状态"},{default:r(()=>[s(l(Y),{value:f.status,"onUpdate:value":e[2]||(e[2]=o=>f.status=o),placeholder:"请选择商品状态",style:{width:"200px"},"allow-clear":""},{default:r(()=>[s(l(B),{value:null},{default:r(()=>e[23]||(e[23]=[m("全部")])),_:1}),s(l(B),{value:"on_sale"},{default:r(()=>e[24]||(e[24]=[m("在售")])),_:1}),s(l(B),{value:"off_sale"},{default:r(()=>e[25]||(e[25]=[m("下架")])),_:1})]),_:1},8,["value"])]),_:1}),s(l(w),{label:"是否推荐"},{default:r(()=>[s(l(Y),{value:f.isRecommended,"onUpdate:value":e[3]||(e[3]=o=>f.isRecommended=o),placeholder:"请选择是否推荐",style:{width:"200px"},"allow-clear":""},{default:r(()=>[s(l(B),{value:null},{default:r(()=>e[26]||(e[26]=[m("全部")])),_:1}),s(l(B),{value:"true"},{default:r(()=>e[27]||(e[27]=[m("推荐")])),_:1}),s(l(B),{value:"false"},{default:r(()=>e[28]||(e[28]=[m("不推荐")])),_:1})]),_:1},8,["value"])]),_:1}),s(l(w),null,{default:r(()=>[s(l(te),null,{default:r(()=>[s(l(S),{type:"primary","html-type":"submit"},{default:r(()=>e[29]||(e[29]=[m("查询")])),_:1}),s(l(S),{onClick:Ae},{default:r(()=>e[30]||(e[30]=[m("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(l(we),{bordered:!1},{default:r(()=>[p("div",ht,[e[34]||(e[34]=p("div",{class:"table-title"},"商品列表",-1)),p("div",wt,[s(l(te),null,{default:r(()=>[s(l(S),{onClick:Me},{icon:r(()=>[s(l(Je))]),default:r(()=>[e[31]||(e[31]=m(" 下载模板 "))]),_:1}),s(l(S),{onClick:Be},{icon:r(()=>[s(l(Q))]),default:r(()=>[e[32]||(e[32]=m(" Excel导入 "))]),_:1}),s(l(S),{type:"primary",onClick:Ee},{icon:r(()=>[s(l(re))]),default:r(()=>[e[33]||(e[33]=m(" 新增商品 "))]),_:1})]),_:1})])]),s(l(ct),{columns:U,"data-source":_.value,loading:h.value,pagination:i,onChange:Ce,"row-key":"id"},{bodyCell:r(({column:o,record:n})=>[o.key==="cover"?(g(),x("div",bt,[s(l(ut),{src:n.cover||"/images/default-product.png",alt:"商品图片",preview:!0},null,8,["src"])])):T("",!0),o.key==="price"?(g(),x("span",Pt,"¥"+E(n.price),1)):T("",!0),o.key==="wholesalePrice"?(g(),x("span",kt,"¥"+E(n.wholesalePrice),1)):T("",!0),o.key==="wholesaleThreshold"?(g(),x("span",xt,E(n.wholesaleThreshold||"-")+" "+E(n.wholesaleThreshold?"件":""),1)):T("",!0),o.key==="vipPrice"?(g(),x("span",Rt,"¥"+E(n.vipPrice),1)):T("",!0),o.key==="status"?(g(),H(l(fe),{key:5,color:n.status==="on_sale"?"green":"orange"},{default:r(()=>[m(E(n.status==="on_sale"?"在售":"下架"),1)]),_:2},1032,["color"])):T("",!0),o.key==="isRecommended"?(g(),H(l(fe),{key:6,color:n.isRecommended?"blue":"default"},{default:r(()=>[m(E(n.isRecommended?"是":"否"),1)]),_:2},1032,["color"])):T("",!0),o.key==="createdAt"?(g(),x(se,{key:7},[m(E(Le(n.createdAt)),1)],64)):T("",!0),o.key==="action"?(g(),H(l(te),{key:8},{default:r(()=>[p("a",{onClick:v=>Se(n)},"编辑",8,It),s(l(ve),{type:"vertical"}),s(l(pt),{title:"确定删除该商品吗？",onConfirm:v=>Te(n),"ok-text":"确定","cancel-text":"取消"},{default:r(()=>e[35]||(e[35]=[p("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"]),s(l(ve),{type:"vertical"}),y.value||n.status==="on_sale"?(g(),x("a",{key:0,onClick:v=>_e(n)},E(n.status==="on_sale"?"下架":"上架"),9,Ct)):(g(),x("span",Ut," 上架（需管理员权限） "))]),_:2},1024)):T("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),s(l(le),{visible:L.value,"onUpdate:visible":e[19]||(e[19]=o=>L.value=o),title:J.value,width:"800px","mask-closable":!1,onCancel:de},{footer:r(()=>[s(l(S),{onClick:de},{default:r(()=>e[45]||(e[45]=[m("取消")])),_:1}),s(l(S),{type:"primary",loading:D.value,onClick:Oe},{default:r(()=>e[46]||(e[46]=[m(" 确定 ")])),_:1},8,["loading"])]),default:r(()=>[s(l(me),{ref_key:"formRef",ref:d,model:a,rules:c,"label-col":{span:4},"wrapper-col":{span:18}},{default:r(()=>[s(l(w),{label:"商品名称",name:"name"},{default:r(()=>[s(l(ee),{value:a.name,"onUpdate:value":e[4]||(e[4]=o=>a.name=o),placeholder:"请输入商品名称"},null,8,["value"])]),_:1}),s(l(w),{label:"商品分类",name:"categoryId"},{default:r(()=>[s(l(Y),{value:a.categoryId,"onUpdate:value":e[5]||(e[5]=o=>a.categoryId=o),placeholder:"请选择商品分类"},{default:r(()=>[(g(!0),x(se,null,he(k.value,o=>(g(),H(l(B),{key:o.id,value:o.id},{default:r(()=>[m(E(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(l(w),{label:"商品价格",name:"price"},{default:r(()=>[s(l(V),{value:a.price,"onUpdate:value":e[6]||(e[6]=o=>a.price=o),placeholder:"请输入商品价格",min:0,precision:2,style:{width:"100%"},onChange:W},null,8,["value"])]),_:1}),s(l(w),{label:"原价",name:"originalPrice"},{default:r(()=>[s(l(V),{value:a.originalPrice,"onUpdate:value":e[7]||(e[7]=o=>a.originalPrice=o),placeholder:"请输入商品原价",min:0,precision:2,style:{width:"100%"},onChange:W},null,8,["value"])]),_:1}),s(l(w),{label:"批发价格",name:"wholesalePrice",required:""},{default:r(()=>[s(l(V),{value:a.wholesalePrice,"onUpdate:value":e[8]||(e[8]=o=>a.wholesalePrice=o),placeholder:"请输入批发价格",min:0,precision:2,style:{width:"100%"},onChange:W},null,8,["value"])]),_:1}),s(l(w),{label:"批发阈值",name:"wholesaleThreshold",required:""},{default:r(()=>[s(l(V),{value:a.wholesaleThreshold,"onUpdate:value":e[9]||(e[9]=o=>a.wholesaleThreshold=o),placeholder:"请输入批发阈值（件）",min:0,style:{width:"100%"}},null,8,["value"]),e[36]||(e[36]=p("div",{class:"form-item-help"},"达到此数量可享受批发价",-1))]),_:1}),s(l(w),{label:"VIP价格",name:"vipPrice",required:""},{default:r(()=>[s(l(V),{value:a.vipPrice,"onUpdate:value":e[10]||(e[10]=o=>a.vipPrice=o),placeholder:"请输入VIP价格",min:0,precision:2,style:{width:"100%"},onChange:W},null,8,["value"]),e[37]||(e[37]=p("div",{class:"form-item-help"},"VIP会员专享价格",-1))]),_:1}),s(l(w),{label:"手续费率",name:"feeRate"},{default:r(()=>[s(l(V),{value:a.feeRate,"onUpdate:value":e[11]||(e[11]=o=>a.feeRate=o),placeholder:"请输入手续费率",min:0,max:100,precision:2,style:{width:"100%"},"addon-after":"%",onChange:Fe},null,8,["value"]),e[38]||(e[38]=p("div",{class:"form-item-help"}," 输入手续费率后将自动重新计算各项价格（此字段仅用于前端计算，不会保存到后端） ",-1))]),_:1}),s(l(w),{label:"佣金设置",name:"commissionAmount"},{default:r(()=>[s(l(ee),{value:a.commissionAmount,"onUpdate:value":e[12]||(e[12]=o=>a.commissionAmount=o),placeholder:"请输入佣金（如：10 或 5%）",style:{width:"100%"}},null,8,["value"]),e[39]||(e[39]=p("div",{class:"form-item-help"}," 支持两种格式：固定金额（如：10）或百分比（如：5%） ",-1))]),_:1}),s(l(w),{label:"库存",name:"stock"},{default:r(()=>[s(l(V),{value:a.stock,"onUpdate:value":e[13]||(e[13]=o=>a.stock=o),placeholder:"请输入库存数量",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),s(l(w),{label:"状态",name:"status"},{default:r(()=>[s(l(We),{value:a.status,"onUpdate:value":e[14]||(e[14]=o=>a.status=o)},{default:r(()=>[s(l(ge),{value:"on_sale",disabled:!y.value},{default:r(()=>e[40]||(e[40]=[m("上架")])),_:1},8,["disabled"]),s(l(ge),{value:"off_sale"},{default:r(()=>e[41]||(e[41]=[m("下架")])),_:1})]),_:1},8,["value"]),y.value?T("",!0):(g(),x("div",At," 提示：只有管理员可以将商品设置为上架状态 "))]),_:1}),s(l(w),{label:"是否推荐",name:"isRecommended"},{default:r(()=>[s(l(Ye),{checked:a.isRecommended,"onUpdate:checked":e[15]||(e[15]=o=>a.isRecommended=o),"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:1}),s(l(w),{label:"封面图",name:"cover"},{default:r(()=>[s(l(ae),{"file-list":P.value,"onUpdate:fileList":e[16]||(e[16]=o=>P.value=o),"list-type":"picture-card","show-upload-list":!1,action:ne,headers:ie,name:"image","before-upload":ue,onChange:ke},{default:r(()=>[a.cover?(g(),x("div",Et,[p("img",{src:a.cover,alt:"商品封面",style:{width:"100%"}},null,8,St)])):(g(),x("div",Tt,[s(l(re)),e[42]||(e[42]=p("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),s(l(w),{label:"商品图片",name:"images"},{default:r(()=>[s(l(ae),{"file-list":O.value,"onUpdate:fileList":e[17]||(e[17]=o=>O.value=o),"list-type":"picture-card",action:ne,headers:ie,name:"image","before-upload":ue,onChange:xe},{default:r(()=>[O.value.length>=5?(g(),x("div",_t,e[43]||(e[43]=[p("div",null,"最多上传5张",-1)]))):(g(),x("div",Ot,[s(l(re)),e[44]||(e[44]=p("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),s(l(w),{label:"商品描述",name:"description"},{default:r(()=>[s(l(Xe),{value:a.description,"onUpdate:value":e[18]||(e[18]=o=>a.description=o),placeholder:"请输入商品描述",rows:4},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),s(l(le),{visible:j.value,"onUpdate:visible":e[21]||(e[21]=o=>j.value=o),title:"Excel批量导入商品",width:"600px","mask-closable":!1,onCancel:ce},{footer:r(()=>[s(l(S),{onClick:ce},{default:r(()=>e[50]||(e[50]=[m("取消")])),_:1}),s(l(S),{type:"primary",loading:F.value,onClick:qe},{default:r(()=>e[51]||(e[51]=[m(" 确认导入 ")])),_:1},8,["loading"])]),default:r(()=>[p("div",Lt,[e[49]||(e[49]=p("div",{class:"import-tips"},[p("h4",null,"导入说明："),p("ul",null,[p("li",null,"请先下载模板文件，按照模板格式填写商品信息"),p("li",null,"必填字段：商品名称、商品价格、批发价格、批发阈值、VIP价格、库存数量、分类ID、商品状态"),p("li",null,"商品状态只能填写：on_sale（上架）或 off_sale（下架）"),p("li",null,"是否推荐只能填写：true 或 false"),p("li",null,"佣金设置支持两种格式：固定金额（如：10）或百分比（如：5%）"),p("li",null,"分类ID请参考模板中的分类参考表"),p("li",null,"多张商品图片URL请用英文逗号分隔"),p("li",null,"文件大小不能超过10MB")])],-1)),p("div",jt,[s(l(ae),{"file-list":N.value,"onUpdate:fileList":e[20]||(e[20]=o=>N.value=o),"before-upload":De,"max-count":1,accept:".xlsx,.xls",onChange:Ne},{default:r(()=>[s(l(S),null,{icon:r(()=>[s(l(Q))]),default:r(()=>[e[47]||(e[47]=m(" 选择Excel文件 "))]),_:1})]),_:1},8,["file-list"]),e[48]||(e[48]=p("div",{class:"upload-tip"},"支持扩展名：.xlsx .xls",-1))])])]),_:1},8,["visible"])]))}}),Ht=Ke(Ft,[["__scopeId","data-v-8010ecbc"]]);export{Ht as default};
