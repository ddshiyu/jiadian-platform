var O=(o,d,i)=>new Promise((u,m)=>{var y=r=>{try{p(i.next(r))}catch(n){m(n)}},v=r=>{try{p(i.throw(r))}catch(n){m(n)}},p=r=>r.done?u(r.value):Promise.resolve(r.value).then(y,v);p((i=i.apply(o,d)).next())});import{w as le,aL as re,g as de,aq as ce,q as h,ar as fe,i as ne,j as me,n as X,aM as ve,aN as J,x as pe,aO as ge,aP as se,o as ye,aQ as Se,b as B,P as be,Q as _e,R as j,W as xe,X as E,U as K,S as ee,B as P,Z as te,a0 as V,a1 as Ce,_ as ke}from"./bootstrap-Be81Tyra.js";import{A as e,d as Z,r as A,o as oe,a3 as we,T as De,I as ae,a as F,b as _,z as a,g as t,B as c,f as N,l as R,e as $,t as S,G as Ie,J as $e}from"../jse/index-index-IK0MbYCQ.js";import{M as he,N as Te,O as Fe,P as Ne}from"./operation-Dt6NDkf8.js";import{S as Re,C as M}from"./index-thOj1ETX.js";import{D as L,a as b}from"./index-DKJMJ4f4.js";import{T as Ae}from"./index-CIITXkHm.js";import{P as H}from"./index-DmoQSauz.js";const Y=le(re),ie=o=>{const{value:d,formatter:i,precision:u,decimalSeparator:m,groupSeparator:y="",prefixCls:v}=o;let p;if(typeof i=="function")p=i({value:d});else{const r=String(d),n=r.match(/^(-?)(\d*)(\.(\d+))?$/);if(!n)p=r;else{const k=n[1];let f=n[2]||"0",g=n[4]||"";f=f.replace(/\B(?=(\d{3})+(?!\d))/g,y),typeof u=="number"&&(g=g.padEnd(u,"0").slice(0,u>0?u:0)),g&&(g=`${m}${g}`),p=[e("span",{key:"int",class:`${v}-content-value-int`},[k,f]),g&&e("span",{key:"decimal",class:`${v}-content-value-decimal`},[g])]}}return e("span",{class:`${v}-content-value`},[p])};ie.displayName="StatisticNumber";const ze=o=>{const{componentCls:d,marginXXS:i,padding:u,colorTextDescription:m,statisticTitleFontSize:y,colorTextHeading:v,statisticContentFontSize:p,statisticFontFamily:r}=o;return{[`${d}`]:h(h({},fe(o)),{[`${d}-title`]:{marginBottom:i,color:m,fontSize:y},[`${d}-skeleton`]:{paddingTop:u},[`${d}-content`]:{color:v,fontSize:p,fontFamily:r,[`${d}-content-value`]:{display:"inline-block",direction:"ltr"},[`${d}-content-prefix, ${d}-content-suffix`]:{display:"inline-block"},[`${d}-content-prefix`]:{marginInlineEnd:i},[`${d}-content-suffix`]:{marginInlineStart:i}}})}},Me=de("Statistic",o=>{const{fontSizeHeading3:d,fontSize:i,fontFamily:u}=o,m=ce(o,{statisticTitleFontSize:i,statisticContentFontSize:d,statisticFontFamily:u});return[ze(m)]}),ue=()=>({prefixCls:String,decimalSeparator:String,groupSeparator:String,format:String,value:se([Number,String,Object]),valueStyle:{type:Object,default:void 0},valueRender:ge(),formatter:pe(),precision:Number,prefix:J(),suffix:J(),title:J(),loading:ve()}),I=Z({compatConfig:{MODE:3},name:"AStatistic",inheritAttrs:!1,props:ne(ue(),{decimalSeparator:".",groupSeparator:",",loading:!1}),slots:Object,setup(o,d){let{slots:i,attrs:u}=d;const{prefixCls:m,direction:y}=me("statistic",o),[v,p]=Me(m);return()=>{var r,n,k,f,g,w,T;const{value:q=0,valueStyle:Q,valueRender:U}=o,D=m.value,z=(r=o.title)!==null&&r!==void 0?r:(n=i.title)===null||n===void 0?void 0:n.call(i),s=(k=o.prefix)!==null&&k!==void 0?k:(f=i.prefix)===null||f===void 0?void 0:f.call(i),l=(g=o.suffix)!==null&&g!==void 0?g:(w=i.suffix)===null||w===void 0?void 0:w.call(i),x=(T=o.formatter)!==null&&T!==void 0?T:i.formatter;let C=e(ie,X({"data-for-update":Date.now()},h(h({},o),{prefixCls:D,value:q,formatter:x})),null);return U&&(C=U(C)),v(e("div",X(X({},u),{},{class:[D,{[`${D}-rtl`]:y.value==="rtl"},u.class,p.value]}),[z&&e("div",{class:`${D}-title`},[z]),e(Re,{paragraph:!1,loading:o.loading},{default:()=>[e("div",{style:Q,class:`${D}-content`},[s&&e("span",{class:`${D}-content-prefix`},[s]),C,l&&e("span",{class:`${D}-content-suffix`},[l])])]})]))}}}),Oe=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function Be(o,d){let i=o;const u=/\[[^\]]*]/g,m=(d.match(u)||[]).map(r=>r.slice(1,-1)),y=d.replace(u,"[]"),v=Oe.reduce((r,n)=>{let[k,f]=n;if(r.includes(k)){const g=Math.floor(i/f);return i-=g*f,r.replace(new RegExp(`${k}+`,"g"),w=>{const T=w.length;return g.toString().padStart(T,"0")})}return r},y);let p=0;return v.replace(u,()=>{const r=m[p];return p+=1,r})}function He(o,d){const{format:i=""}=d,u=new Date(o).getTime(),m=Date.now(),y=Math.max(u-m,0);return Be(y,i)}const Ue=1e3/30;function W(o){return new Date(o).getTime()}const je=()=>h(h({},ue()),{value:se([Number,String,Object]),format:String,onFinish:Function,onChange:Function}),Ee=Z({compatConfig:{MODE:3},name:"AStatisticCountdown",props:ne(je(),{format:"HH:mm:ss"}),setup(o,d){let{emit:i,slots:u}=d;const m=A(),y=A(),v=()=>{const{value:f}=o;W(f)>=Date.now()?p():r()},p=()=>{if(m.value)return;const f=W(o.value);m.value=setInterval(()=>{y.value.$forceUpdate(),f>Date.now()&&i("change",f-Date.now()),v()},Ue)},r=()=>{const{value:f}=o;m.value&&(clearInterval(m.value),m.value=void 0,W(f)<Date.now()&&i("finish"))},n=f=>{let{value:g,config:w}=f;const{format:T}=o;return He(g,h(h({},w),{format:T}))},k=f=>f;return oe(()=>{v()}),we(()=>{v()}),De(()=>{r()}),()=>{const f=o.value;return e(I,X({ref:y},h(h({},ye(o,["onFinish","onChange"])),{value:f,valueRender:k,formatter:n})),u)}}});I.Countdown=Ee;I.install=function(o){return o.component(I.name,I),o.component(I.Countdown.name,I.Countdown),o};I.Countdown;const Pe=le(Se),Ve=["onClick"],Le={key:0,class:"loading-container"},Ye={key:1},Xe={class:"price"},qe=["src"],Qe={key:1},Ge=["src"],Je={key:1},We={class:"price"},Ze={key:3,class:"modal-action"},Ke=Z({__name:"commission",setup(o){const d=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"获得用户",dataIndex:"user",key:"user",customRender:({record:s})=>s.user?`${s.user.nickname} (${s.user.phone})`:"-"},{title:"邀请用户",dataIndex:"invitee",key:"invitee",customRender:({record:s})=>s.invitee?`${s.invitee.nickname} (${s.invitee.phone})`:"-"},{title:"订单号",dataIndex:"order",key:"order",customRender:({record:s})=>s.order?s.order.orderNo:"-"},{title:"佣金金额",dataIndex:"amount",key:"amount",width:100,customRender:({text:s})=>`¥${(+s).toFixed(2)}`},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:180},{title:"操作",key:"action",width:180}],i=A({totalCommission:0,todayCommission:0,monthCommission:0,totalRecords:0}),u=ae({status:null,userId:null,phone:""}),m=A([]),y=A(!1),v=ae({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:s=>`共 ${s} 条数据`}),p=A(!1),r=A(!1),n=A(null),k={pending:"orange",settled:"green",cancelled:"red"},f={pending:"待结算",settled:"已结算",cancelled:"已取消"};oe(()=>{g(),w()});const g=()=>O(this,null,function*(){try{const s=yield he();s&&(i.value=s)}catch(s){console.error("获取佣金统计数据失败:",s),B.error("获取佣金统计数据失败")}}),w=()=>O(this,null,function*(){y.value=!0;try{const s={status:u.status||void 0,userId:u.userId===null?void 0:u.userId,phone:u.phone||void 0,pageNum:v.current,pageSize:v.pageSize},l=yield Te(s);l&&(m.value=l.list,v.total=l.total),y.value=!1}catch(s){console.error("获取佣金列表失败:",s),B.error("获取佣金列表失败"),y.value=!1}}),T=s=>{s.current&&(v.current=s.current),s.pageSize&&(v.pageSize=s.pageSize),w()},q=()=>{v.current=1,w()},Q=()=>{Object.assign(u,{status:null,userId:null,phone:""}),v.current=1,w()},U=s=>O(this,null,function*(){r.value=!0,p.value=!0;try{const l=yield Fe(s.id);l&&(n.value=l),r.value=!1}catch(l){console.error("获取佣金详情失败:",l),B.error("获取佣金详情失败"),r.value=!1}}),D=(s,l)=>O(this,null,function*(){try{yield Ne(s.id,l),B.success("状态更新成功"),w(),g()}catch(x){console.error("更新佣金状态失败:",x),B.error("更新佣金状态失败")}}),z=s=>s?$e(s).format("YYYY-MM-DD HH:mm:ss"):"-";return(s,l)=>(_(),F("div",null,[e(t(Pe),{gutter:16,class:"mb-20"},{default:a(()=>[e(t(Y),{span:6},{default:a(()=>[e(t(M),null,{default:a(()=>[e(t(I),{title:"总佣金金额",value:i.value.totalCommission,precision:2,suffix:"元","value-style":{color:"#3f8600"}},null,8,["value"])]),_:1})]),_:1}),e(t(Y),{span:6},{default:a(()=>[e(t(M),null,{default:a(()=>[e(t(I),{title:"今日佣金",value:i.value.todayCommission,precision:2,suffix:"元","value-style":{color:"#cf1322"}},null,8,["value"])]),_:1})]),_:1}),e(t(Y),{span:6},{default:a(()=>[e(t(M),null,{default:a(()=>[e(t(I),{title:"本月佣金",value:i.value.monthCommission,precision:2,suffix:"元"},null,8,["value"])]),_:1})]),_:1}),e(t(Y),{span:6},{default:a(()=>[e(t(M),null,{default:a(()=>[e(t(I),{title:"佣金记录总数",value:i.value.totalRecords,"value-style":{color:"#1890ff"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(t(M),{bordered:!1,class:"mb-20"},{default:a(()=>[e(t(be),{model:u,layout:"inline",class:"search-form",onSubmit:_e(q,["prevent"])},{default:a(()=>[e(t(j),{label:"佣金状态"},{default:a(()=>[e(t(xe),{value:u.status,"onUpdate:value":l[0]||(l[0]=x=>u.status=x),placeholder:"请选择佣金状态",style:{width:"200px"},"allow-clear":""},{default:a(()=>[e(t(E),{value:null},{default:a(()=>l[6]||(l[6]=[c("全部")])),_:1}),e(t(E),{value:"pending"},{default:a(()=>l[7]||(l[7]=[c("待结算")])),_:1}),e(t(E),{value:"settled"},{default:a(()=>l[8]||(l[8]=[c("已结算")])),_:1}),e(t(E),{value:"cancelled"},{default:a(()=>l[9]||(l[9]=[c("已取消")])),_:1})]),_:1},8,["value"])]),_:1}),e(t(j),{label:"用户ID"},{default:a(()=>[e(t(K),{value:u.userId===null?"":u.userId,placeholder:"请输入用户ID",style:{width:"200px"},"allow-clear":"","onUpdate:value":l[1]||(l[1]=x=>u.userId=x?Number(x):null)},null,8,["value"])]),_:1}),e(t(j),{label:"用户电话"},{default:a(()=>[e(t(K),{value:u.phone,"onUpdate:value":l[2]||(l[2]=x=>u.phone=x),placeholder:"请输入用户电话",style:{width:"200px"},"allow-clear":""},null,8,["value"])]),_:1}),e(t(j),null,{default:a(()=>[e(t(ee),null,{default:a(()=>[e(t(P),{type:"primary","html-type":"submit"},{default:a(()=>l[10]||(l[10]=[c("查询")])),_:1}),e(t(P),{onClick:Q},{default:a(()=>l[11]||(l[11]=[c("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(t(M),{bordered:!1},{default:a(()=>[l[15]||(l[15]=N("div",{class:"table-header"},[N("div",{class:"table-title"},"佣金记录")],-1)),e(t(Ae),{columns:d,"data-source":m.value,loading:y.value,pagination:v,onChange:T,"row-key":"id"},{bodyCell:a(({column:x,record:C})=>[x.key==="status"?(_(),R(t(te),{key:0,color:k[C.status]},{default:a(()=>[c(S(f[C.status]),1)]),_:2},1032,["color"])):$("",!0),x.key==="createdAt"?(_(),F(Ie,{key:1},[c(S(z(C.createdAt)),1)],64)):$("",!0),x.key==="action"?(_(),R(t(ee),{key:2},{default:a(()=>[N("a",{onClick:G=>U(C)},"详情",8,Ve),e(t(V),{type:"vertical"}),C.status==="pending"?(_(),R(t(H),{key:0,title:"确定结算该佣金吗？",onConfirm:G=>D(C,"settled"),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>l[12]||(l[12]=[N("a",null,"结算",-1)])),_:2},1032,["onConfirm"])):$("",!0),C.status==="pending"?(_(),R(t(H),{key:1,title:"确定取消该佣金吗？",onConfirm:G=>D(C,"cancelled"),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>l[13]||(l[13]=[N("a",{class:"danger-link"},"取消",-1)])),_:2},1032,["onConfirm"])):$("",!0),C.status==="cancelled"?(_(),R(t(H),{key:2,title:"确定恢复为待结算状态吗？",onConfirm:G=>D(C,"pending"),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>l[14]||(l[14]=[N("a",null,"恢复",-1)])),_:2},1032,["onConfirm"])):$("",!0)]),_:2},1024)):$("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),e(t(Ce),{visible:p.value,"onUpdate:visible":l[5]||(l[5]=x=>p.value=x),title:"佣金详情",width:"800px",footer:null,"mask-closable":!0},{default:a(()=>[r.value?(_(),F("div",Le,"加载中...")):n.value?(_(),F("div",Ye,[e(t(L),{bordered:"",column:2},{default:a(()=>[e(t(b),{label:"佣金ID"},{default:a(()=>[c(S(n.value.id),1)]),_:1}),e(t(b),{label:"佣金金额"},{default:a(()=>[N("span",Xe,"¥"+S((+n.value.amount).toFixed(2)),1)]),_:1}),e(t(b),{label:"佣金状态"},{default:a(()=>[e(t(te),{color:k[n.value.status]},{default:a(()=>[c(S(f[n.value.status]),1)]),_:1},8,["color"])]),_:1}),e(t(b),{label:"创建时间"},{default:a(()=>[c(S(z(n.value.createdAt)),1)]),_:1}),e(t(b),{label:"更新时间"},{default:a(()=>[c(S(z(n.value.updatedAt)),1)]),_:1})]),_:1}),e(t(V),null,{default:a(()=>l[16]||(l[16]=[c("佣金获得者信息")])),_:1}),n.value.user?(_(),R(t(L),{key:0,bordered:"",column:2},{default:a(()=>[e(t(b),{label:"用户ID"},{default:a(()=>[c(S(n.value.user.id),1)]),_:1}),e(t(b),{label:"用户昵称"},{default:a(()=>[c(S(n.value.user.nickname),1)]),_:1}),e(t(b),{label:"手机号"},{default:a(()=>[c(S(n.value.user.phone),1)]),_:1}),e(t(b),{label:"头像"},{default:a(()=>[n.value.user.avatar?(_(),F("img",{key:0,src:n.value.user.avatar,alt:"用户头像",class:"user-avatar"},null,8,qe)):(_(),F("span",Qe,"无头像"))]),_:1})]),_:1})):$("",!0),e(t(V),null,{default:a(()=>l[17]||(l[17]=[c("邀请人信息")])),_:1}),n.value.invitee?(_(),R(t(L),{key:1,bordered:"",column:2},{default:a(()=>[e(t(b),{label:"用户ID"},{default:a(()=>[c(S(n.value.invitee.id),1)]),_:1}),e(t(b),{label:"用户昵称"},{default:a(()=>[c(S(n.value.invitee.nickname),1)]),_:1}),e(t(b),{label:"手机号"},{default:a(()=>[c(S(n.value.invitee.phone),1)]),_:1}),e(t(b),{label:"头像"},{default:a(()=>[n.value.invitee.avatar?(_(),F("img",{key:0,src:n.value.invitee.avatar,alt:"用户头像",class:"user-avatar"},null,8,Ge)):(_(),F("span",Je,"无头像"))]),_:1})]),_:1})):$("",!0),e(t(V),null,{default:a(()=>l[18]||(l[18]=[c("关联订单信息")])),_:1}),n.value.order?(_(),R(t(L),{key:2,bordered:"",column:2},{default:a(()=>[e(t(b),{label:"订单ID"},{default:a(()=>[c(S(n.value.order.id),1)]),_:1}),e(t(b),{label:"订单号"},{default:a(()=>[c(S(n.value.order.orderNo),1)]),_:1}),e(t(b),{label:"订单金额"},{default:a(()=>[N("span",We,"¥"+S(n.value.order.totalAmount),1)]),_:1}),e(t(b),{label:"订单状态"},{default:a(()=>[c(S(n.value.order.status),1)]),_:1}),e(t(b),{label:"下单时间"},{default:a(()=>[c(S(z(n.value.order.createdAt)),1)]),_:1})]),_:1})):$("",!0),n.value&&n.value.status==="pending"?(_(),F("div",Ze,[e(t(H),{title:"确定结算该佣金吗？",onConfirm:l[3]||(l[3]=()=>{D(n.value,"settled"),p.value=!1}),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>[e(t(P),{type:"primary"},{default:a(()=>l[19]||(l[19]=[c("结算佣金")])),_:1})]),_:1}),e(t(H),{title:"确定取消该佣金吗？",onConfirm:l[4]||(l[4]=()=>{D(n.value,"cancelled"),p.value=!1}),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>[e(t(P),{danger:"",style:{"margin-left":"10px"}},{default:a(()=>l[20]||(l[20]=[c("取消佣金")])),_:1})]),_:1})])):$("",!0)])):$("",!0)]),_:1},8,["visible"])]))}}),ut=ke(Ke,[["__scopeId","data-v-19c0ad97"]]);export{ut as default};
