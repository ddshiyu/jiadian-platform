var g=(m,r,s)=>new Promise((i,d)=>{var p=o=>{try{e(s.next(o))}catch(u){d(u)}},f=o=>{try{e(s.throw(o))}catch(u){d(u)}},e=o=>o.done?i(o.value):Promise.resolve(o.value).then(p,f);e((s=s.apply(m,r)).next())});import{u as z,M as C,f as P,N as T,i as E,_ as V}from"./layout.vue_vue_type_script_setup_true_lang-BryyCAq5.js";import{c as U,an as q,ao as O,ap as G,O as W,$ as B,aq as D,ar as H,G as Z,V as L}from"./bootstrap-BBk6SY2t.js";import{useWatermark as j}from"./index-BGuEsQ5h.js";import{_ as F}from"./avatar.vue_vue_type_script_setup_true_lang-DD5B2msR.js";import{d as S,R as J,S as Q,T as N,c as y,a as K,b as A,A as l,z as c,g as n,i as X,r as _,U as b,q as I,o as Y,V as ee,l as ae}from"../jse/index-index-Pp9M58hi.js";import"./index-DNH35IXx.js";import"./tabbar-WuEecmk3.js";import"./use-tabs-BXnwW8F1.js";import"./theme-toggle.vue_vue_type_script_setup_true_lang-K31q2ts1.js";import"./TabsList.vue_vue_type_script_setup_true_lang-D9XS0ne_.js";import"./rotate-cw-DpsznE0g.js";const te=U("BookOpenTextIcon",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M16 12h2",key:"7q9ll5"}],["path",{d:"M16 8h2",key:"msurwy"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}],["path",{d:"M6 12h2",key:"32wvfc"}],["path",{d:"M6 8h2",key:"30oboj"}]]),oe=S({name:"LoginExpiredModal",__name:"login-expired-modal",props:J({avatar:{default:""},zIndex:{default:0},codeLoginPath:{},forgetPasswordPath:{},loading:{type:Boolean},qrCodeLoginPath:{},registerPath:{},showCodeLogin:{type:Boolean},showForgetPassword:{type:Boolean},showQrcodeLogin:{type:Boolean},showRegister:{type:Boolean},showRememberMe:{type:Boolean},showThirdPartyLogin:{type:Boolean},subTitle:{},title:{},submitButtonText:{}},{open:{type:Boolean},openModifiers:{}}),emits:["update:open"],setup(m){const r=m,s=Q(m,"open"),[i,d]=z();N(()=>s.value,e=>{d.setState({isOpen:e})});const p=y(()=>r.zIndex||f());function f(){let e=0;return[...document.querySelectorAll("*")].forEach(u=>{const h=window.getComputedStyle(u).getPropertyValue("z-index");h&&!Number.isNaN(Number.parseInt(h))&&(e=Math.max(e,Number.parseInt(h)))}),e+1}return(e,o)=>(A(),K("div",null,[l(n(i),{closable:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,footer:!1,"fullscreen-button":!1,header:!1,"z-index":p.value,class:"border-none px-10 py-6 text-center shadow-xl sm:w-[600px] sm:rounded-2xl md:h-[unset]"},{default:c(()=>[l(n(F),{src:e.avatar,class:"mx-auto mb-6 size-20"},null,8,["src"]),l(n(q),{"show-forget-password":!1,"show-register":!1,"show-remember-me":!1,"sub-title":e.$t("authentication.loginAgainSubTitle"),title:e.$t("authentication.loginAgainTitle")},{default:c(()=>[X(e.$slots,"default")]),_:3},8,["sub-title","title"])]),_:3},8,["z-index"])]))}}),ge=S({__name:"basic",setup(m){const r=_([]),s=_(!1),i=O(),d=G(),p=W(),{destroyWatermark:f,updateWatermark:e}=j(),o=y(()=>r.value.some(a=>!a.isRead)),u=y(()=>[{handler:()=>{b(Z,{target:"_blank"})},icon:te,text:B("ui.widgets.document")},{handler:()=>{b(L,{target:"_blank"})},icon:C,text:"GitHub"},{handler:()=>{b(`${L}/issues`,{target:"_blank"})},icon:D,text:B("ui.widgets.qa")}]),v=y(()=>{var a,t;return(t=(a=i.userInfo)==null?void 0:a.avatar)!=null?t:I.app.defaultAvatar}),h=()=>g(this,null,function*(){s.value=!0;try{const a=yield getMessageListApi({pageNum:1,pageSize:10});r.value=a.row.map(t=>({id:t.id,title:t.title,message:t.content,isRead:t.isRead===1,date:new Date().toLocaleString(),avatar:""}))}catch(a){console.error("获取消息失败")}finally{s.value=!1}}),k=a=>g(this,null,function*(){});function x(){return g(this,null,function*(){yield d.logout(!1)})}function $(){r.value=[]}function R(){r.value.forEach(a=>{a.isRead=!0,k()})}N(()=>I.app.watermark,a=>g(this,null,function*(){var t;a?yield e({content:`${(t=i.userInfo)==null?void 0:t.username}`}):f()}),{immediate:!0});const M=_(null);return Y(()=>{M.value=setInterval(()=>{h()},1e4)}),ee(()=>{clearInterval(M.value)}),(a,t)=>(A(),ae(n(V),{onClearPreferencesAndLogout:x},{"user-dropdown":c(()=>{var w;return[l(n(E),{avatar:v.value,menus:u.value,text:(w=n(i).userInfo)==null?void 0:w.realName,description:"ann.vben@gmail.com","tag-text":"Pro",onLogout:x},null,8,["avatar","menus","text"])]}),notification:c(()=>[l(n(T),{dot:o.value,loading:s.value,notifications:r.value,onClear:$,onMakeAll:R,onRead:k},null,8,["dot","loading","notifications"])]),extra:c(()=>[l(n(oe),{open:n(p).loginExpired,"onUpdate:open":t[0]||(t[0]=w=>n(p).loginExpired=w),avatar:v.value},{default:c(()=>[l(H)]),_:1},8,["open","avatar"])]),"lock-screen":c(()=>[l(n(P),{avatar:v.value,onToLogin:x},null,8,["avatar"])]),_:1}))}});export{ge as default};
