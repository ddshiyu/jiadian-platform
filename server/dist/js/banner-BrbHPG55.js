var x=(L,S,p)=>new Promise((b,D)=>{var I=i=>{try{c(p.next(i))}catch(o){D(o)}},M=i=>{try{c(p.throw(i))}catch(o){D(o)}},c=i=>i.done?b(i.value):Promise.resolve(i.value).then(I,M);c((p=p.apply(L,S)).next())});import{cc as ne,o as f,aD as R,aE as se,aF as v,aI as j,aG as le,aH as A,n as z,B as C,aJ as oe,aK as ie,cd as re,ce as ue,cf as de,bC as V,aL as ce,aM as fe}from"./bootstrap-DhTUe00I.js";import{m as me,T as pe,n as ve,o as ge,p as ye}from"./operation-DVEqFYlT.js";import{C as $,P as q}from"./index-Cu6YPyTo.js";import{a3 as be,P as g,T as P,J as ke,ao as Be,a4 as w,a5 as m,x as n,ah as s,aa as a,at as r,aK as y,aB as T,ae as F,au as we}from"../jse/index-index-DRKrrGAz.js";import{P as he}from"./index-roCd-cpn.js";import"./Dropdown-NjH4VmsC.js";import"./index-Cfl0mBFW.js";const Ce={class:"table-header"},_e={class:"table-action"},xe={key:0,class:"banner-image"},Se=["src"],De={key:1,class:"no-image"},Ie=["onClick"],Me={key:0},Ue=["src"],Ae={key:1},Pe=be({__name:"banner",setup(L){const S=[{title:"图片",dataIndex:"image",key:"image",width:150},{title:"内容描述",dataIndex:"content",key:"content",width:"30%"},{title:"排序",dataIndex:"sort",key:"sort",width:80},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"操作",key:"action",width:150}],p=g([]),b=g(!1),I={Authorization:`Bearer ${ne().accessToken}`},M="https://qbylxb.cn/upload/image",c=g(!1),i=g(null),o=P({id:0,image:"",content:"",link:"",sort:0,status:"active"}),G={image:[{required:!0,message:"请上传Banner图片",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},_=g([]),k=g(!1),U=g(!1),J=ke(()=>o.id?"编辑Banner":"新增Banner"),u=P({content:"",status:""}),B=P({current:1,pageSize:10,total:0,showTotal:t=>`共 ${t} 条记录`,onChange:t=>{B.current=t}});Be(()=>{h()});const h=()=>x(this,null,function*(){b.value=!0;try{const t=yield me();if(t){const e=E(t),l=u.content||u.status?H(e,u):e;p.value=l,B.total=l.length,l.length>0&&Math.ceil(l.length/B.pageSize)<B.current&&(B.current=1)}b.value=!1}catch(t){console.error("获取Banner列表失败:",t),f.error("获取Banner列表失败"),b.value=!1}}),E=t=>!t||!t.list?[]:t.list.map(e=>({id:e.id||0,image:e.image||"",content:e.content||"",link:e.link||"",sort:e.sort||0,status:e.status||"active"})),H=(t,e)=>t.filter(l=>{let d=!0,O=!0;return e.content&&(d=l.content.includes(e.content)),e.status&&(O=l.status===e.status),d&&O}),K=()=>{h()},Q=()=>{Object.assign(u,{content:"",status:""}),h()},W=()=>{X()},X=()=>{c.value=!1,Object.assign(o,{id:0,image:"",content:"",link:"",sort:0,status:"active"}),_.value=[],k.value=!0},Y=t=>{c.value=!0,Object.assign(o,{id:t.id,image:t.image,content:t.content,link:t.link,sort:t.sort,status:t.status}),_.value=t.image?[{uid:"-1",name:"banner.jpg",url:t.image}]:[],k.value=!0},Z=t=>x(this,null,function*(){try{yield ve(t.id),f.success("删除成功"),h()}catch(e){console.error("删除Banner失败:",e),f.error("删除Banner失败")}}),N=()=>{k.value=!1,c.value=!1},ee=()=>x(this,null,function*(){if(i.value)try{yield i.value.validate(),U.value=!0;const t={image:o.image,content:o.content,link:o.link,sort:o.sort,status:o.status};try{o.id?(yield ge(o.id,t),f.success("修改成功")):(yield ye(t),f.success("添加成功")),yield h(),k.value=!1,c.value=!1}catch(e){console.error("保存Banner失败:",e),f.error("保存Banner失败")}finally{U.value=!1}}catch(t){console.error("表单验证失败:",t)}}),te=t=>{const e=t.type==="image/jpeg"||t.type==="image/png";e||f.error("只能上传JPG/PNG格式的图片!");const l=t.size!==void 0&&t.size/1024/1024<2;return l||f.error("图片必须小于2MB!"),e&&l},ae=t=>{t.file.status!=="uploading"&&t.file.status==="done"&&(o.image=`https://qbylxb.cn${t.file.response.data.image.url}`)};return(t,e)=>(m(),w("div",null,[n(a($),{bordered:!1,class:"mb-20"},{default:s(()=>[n(a(R),{model:u,layout:"inline",class:"search-form",onSubmit:se(K,["prevent"])},{default:s(()=>[n(a(v),{label:"内容描述"},{default:s(()=>[n(a(j),{value:u.content,"onUpdate:value":e[0]||(e[0]=l=>u.content=l),placeholder:"请输入Banner内容描述","allow-clear":""},null,8,["value"])]),_:1}),n(a(v),{label:"状态"},{default:s(()=>[n(a(le),{value:u.status,"onUpdate:value":e[1]||(e[1]=l=>u.status=l),placeholder:"请选择状态",style:{width:"140px"},"allow-clear":""},{default:s(()=>[n(a(A),{value:""},{default:s(()=>e[7]||(e[7]=[r("全部")])),_:1}),n(a(A),{value:"active"},{default:s(()=>e[8]||(e[8]=[r("启用")])),_:1}),n(a(A),{value:"inactive"},{default:s(()=>e[9]||(e[9]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),n(a(v),null,{default:s(()=>[n(a(z),null,{default:s(()=>[n(a(C),{type:"primary","html-type":"submit"},{default:s(()=>e[10]||(e[10]=[r("查询")])),_:1}),n(a(C),{onClick:Q},{default:s(()=>e[11]||(e[11]=[r("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(a($),{bordered:!1},{default:s(()=>[y("div",Ce,[e[13]||(e[13]=y("div",{class:"table-title"},"Banner管理",-1)),y("div",_e,[n(a(C),{type:"primary",onClick:W},{icon:s(()=>[n(a(q))]),default:s(()=>[e[12]||(e[12]=r(" 新增Banner "))]),_:1})])]),n(a(pe),{columns:S,"data-source":p.value,loading:b.value,pagination:B,"row-key":"id"},{bodyCell:s(({column:l,record:d})=>[l.key==="image"?(m(),w("div",xe,[d.image?(m(),w("img",{key:0,src:d.image,alt:"Banner图片"},null,8,Se)):(m(),w("div",De,"无"))])):T("",!0),l.key==="status"?(m(),F(a(oe),{key:1,color:d.status==="active"?"green":"orange"},{default:s(()=>[r(we(d.status==="active"?"启用":"禁用"),1)]),_:2},1032,["color"])):T("",!0),l.key==="action"?(m(),F(a(z),{key:2},{default:s(()=>[y("a",{onClick:()=>Y(d)},"编辑",8,Ie),n(a(ie),{type:"vertical"}),n(a(he),{title:"确定删除该Banner吗？",onConfirm:()=>Z(d),"ok-text":"确定","cancel-text":"取消"},{default:s(()=>e[14]||(e[14]=[y("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):T("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),n(a(ce),{visible:k.value,"onUpdate:visible":e[6]||(e[6]=l=>k.value=l),title:J.value,width:"600px","mask-closable":!1,onCancel:N},{footer:s(()=>[n(a(C),{onClick:N},{default:s(()=>e[18]||(e[18]=[r("取消")])),_:1}),n(a(C),{type:"primary",loading:U.value,onClick:ee},{default:s(()=>e[19]||(e[19]=[r(" 确定 ")])),_:1},8,["loading"])]),default:s(()=>[n(a(R),{ref_key:"formRef",ref:i,model:o,rules:G,"label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[n(a(v),{label:"图片",name:"image"},{default:s(()=>[n(a(re),{"file-list":_.value,"onUpdate:fileList":e[2]||(e[2]=l=>_.value=l),"list-type":"picture-card","show-upload-list":!1,action:M,headers:I,name:"image","before-upload":te,onChange:ae},{default:s(()=>[o.image?(m(),w("div",Me,[y("img",{src:o.image,alt:"Banner图片",style:{width:"100%"}},null,8,Ue)])):(m(),w("div",Ae,[n(a(q)),e[15]||(e[15]=y("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),n(a(v),{label:"内容描述",name:"content"},{default:s(()=>[n(a(j),{value:o.content,"onUpdate:value":e[3]||(e[3]=l=>o.content=l),placeholder:"请输入Banner内容描述"},null,8,["value"])]),_:1}),n(a(v),{label:"排序",name:"sort"},{default:s(()=>[n(a(ue),{value:o.sort,"onUpdate:value":e[4]||(e[4]=l=>o.sort=l),placeholder:"数字越小越靠前",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),n(a(v),{label:"状态",name:"status"},{default:s(()=>[n(a(de),{value:o.status,"onUpdate:value":e[5]||(e[5]=l=>o.status=l)},{default:s(()=>[n(a(V),{value:"active"},{default:s(()=>e[16]||(e[16]=[r("启用")])),_:1}),n(a(V),{value:"inactive"},{default:s(()=>e[17]||(e[17]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]))}}),$e=fe(Pe,[["__scopeId","data-v-1ebf35f8"]]);export{$e as default};
