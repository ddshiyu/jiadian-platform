var F=(j,N,A)=>new Promise((S,k)=>{var i=m=>{try{d(A.next(m))}catch(C){k(C)}},v=m=>{try{d(A.throw(m))}catch(C){k(C)}},d=m=>m.done?S(m.value):Promise.resolve(m.value).then(i,v);d((A=A.apply(j,N)).next())});import{az as ge,aA as q,aB as be,aC as f,aD as P,aE as W,aF as Y,n as H,B as w,aG as ke,aH as $,aI as we,aJ as L,aK as De,o as y,aL as Ce,aM as xe,aN as _e,aO as Ae,aP as Ue,aQ as he}from"./bootstrap-BZ7AE4dT.js";import{a3 as Fe,P as c,T as B,ao as Pe,a4 as I,a5 as g,x as t,ah as l,aa as a,at as n,aK as O,ae as z,aB as D,au as p,F as X,bl as Se}from"../jse/index-index-C31g8PXS.js";import{C as Z}from"./index-CpAE327s.js";import{R as Re}from"./ReloadOutlined-DdxkEmYV.js";import{T as ee}from"./index-Cv6jE2nv.js";import{P as Ye}from"./index-BAx3Ssq2.js";import{D as ae,a as b}from"./index-CiktrRvK.js";import"./Dropdown-BpOuxWnX.js";import"./index-CN8egozC.js";const Ie={class:"table-header"},Me={class:"table-action"},Te={key:0},$e={key:0,class:"mt-20"},Be=Fe({__name:"admin-users",setup(j){const{RangePicker:N}=ge,A=[{title:"用户名",dataIndex:"username",key:"username"},{title:"手机号",dataIndex:"phone",key:"phone"},{title:"角色",dataIndex:"role",key:"role"},{title:"状态",dataIndex:"status",key:"status"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt"},{title:"操作",key:"action",fixed:"right",width:300}],S=c([]),k=c(!1),i=c(null),v=B({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条记录`}),d=B({keyword:"",role:"",startDate:"",endDate:""}),m=c(void 0),C=c(!1),U=c(!1),r=B({id:0,username:"",password:"",name:"",phone:"",role:"user"}),V=c(null),te={username:[{required:!0,message:"请输入用户名",trigger:"blur",type:"string"}],password:[{required:!0,message:"请输入密码",trigger:"blur",type:"string"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur",type:"string"}]},R=c(!1),x=B({id:0,password:""}),E=c(null),le={password:[{required:!0,message:"请输入新密码",trigger:"blur",type:"string"},{min:6,message:"密码长度至少6位",trigger:"blur",type:"string"}]},h=c(!1),_=()=>F(this,null,function*(){var s,e;k.value=!0;try{m.value&&m.value.length===2?(d.startDate=m.value[0].format("YYYY-MM-DD"),d.endDate=m.value[1].format("YYYY-MM-DD")):(d.startDate="",d.endDate="");const o={keyword:d.keyword||void 0,role:d.role||void 0,startDate:d.startDate||void 0,endDate:d.endDate||void 0,page:v.current,pageSize:v.pageSize},u=yield De(o);S.value=u.list||[],v.total=((s=u.pagination)==null?void 0:s.total)||0,v.current=((e=u.pagination)==null?void 0:e.current)||1}catch(o){console.error("获取用户列表失败:",o),y.error(`获取用户列表失败: ${o.message||"未知错误"}`),S.value=[],v.total=0}finally{k.value=!1}}),se=()=>{v.current=1,_()},re=()=>{Object.assign(d,{keyword:"",role:"",startDate:"",endDate:""}),m.value=void 0,v.current=1,_()},oe=s=>{v.current=s.current,v.pageSize=s.pageSize,_()},ne=s=>F(this,null,function*(){try{k.value=!0;const e=yield Ce(s.id);i.value=e,C.value=!0}catch(e){console.error("获取用户详情失败:",e),y.error(`获取用户详情失败: ${e.message||"未知错误"}`)}finally{k.value=!1}}),ue=()=>{r.id=0,r.username="",r.password="",r.name="",r.phone="",r.role="user",U.value=!0},de=s=>{r.id=s.id,r.username=s.username,r.password="",r.name=s.name||"",r.phone=s.phone||"",r.role=s.role,U.value=!0},ie=()=>{U.value=!1},me=()=>F(this,null,function*(){if(V.value)try{const s=r.id?["username","phone"]:["username","password","phone"];yield V.value.validateFields(s),h.value=!0,r.id?(yield _e(r.id,{name:r.name,phone:r.phone,role:r.role}),y.success("更新用户成功")):(yield Ae({username:r.username,password:r.password,name:r.name,phone:r.phone,role:r.role}),y.success("创建用户成功")),U.value=!1,_()}catch(s){console.error("保存用户失败:",s),y.error(`保存用户失败: ${s.message||"未知错误"}`)}finally{h.value=!1}}),pe=s=>{x.id=s.id,x.password="",R.value=!0},ve=()=>{R.value=!1},fe=()=>F(this,null,function*(){if(E.value)try{yield E.value.validateFields(),h.value=!0,yield Ue(x.id,x.password),y.success("重置密码成功"),R.value=!1}catch(s){console.error("重置密码失败:",s),y.error(`重置密码失败: ${s.message||"未知错误"}`)}finally{h.value=!1}}),ce=s=>F(this,null,function*(){try{const e=s.status==="active"?"inactive":"active";yield xe(s.id,e),y.success(`${e==="active"?"启用":"禁用"}用户成功`),_()}catch(e){console.error("更新用户状态失败:",e),y.error(`更新用户状态失败: ${e.message||"未知错误"}`)}}),J=s=>s==="admin"?"管理员":"普通用户",K=s=>s==="admin"?"blue":"green",Q=s=>s==="active"?"正常":"禁用",G=s=>s==="active"?"success":"error",M=s=>s?Se(s).format("YYYY-MM-DD HH:mm:ss"):"";return Pe(()=>{_()}),(s,e)=>(g(),I("div",null,[t(a(Z),{bordered:!1,class:"mb-20"},{default:l(()=>[t(a(q),{model:d,layout:"inline",class:"search-form",onSubmit:be(se,["prevent"])},{default:l(()=>[t(a(f),{label:"关键词"},{default:l(()=>[t(a(P),{value:d.keyword,"onUpdate:value":e[0]||(e[0]=o=>d.keyword=o),placeholder:"用户名/姓名/手机号","allow-clear":""},null,8,["value"])]),_:1}),t(a(f),{label:"角色"},{default:l(()=>[t(a(W),{value:d.role,"onUpdate:value":e[1]||(e[1]=o=>d.role=o),placeholder:"请选择角色",style:{width:"140px"},"allow-clear":""},{default:l(()=>[t(a(Y),{value:""},{default:l(()=>e[12]||(e[12]=[n("全部")])),_:1}),t(a(Y),{value:"admin"},{default:l(()=>e[13]||(e[13]=[n("管理员")])),_:1}),t(a(Y),{value:"user"},{default:l(()=>e[14]||(e[14]=[n("普通用户")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(f),{label:"创建时间"},{default:l(()=>[t(a(N),{value:m.value,"onUpdate:value":e[2]||(e[2]=o=>m.value=o),format:"YYYY-MM-DD",placeholder:["开始日期","结束日期"],style:{width:"240px"}},null,8,["value"])]),_:1}),t(a(f),null,{default:l(()=>[t(a(H),null,{default:l(()=>[t(a(w),{type:"primary","html-type":"submit"},{default:l(()=>e[15]||(e[15]=[n("查询")])),_:1}),t(a(w),{onClick:re},{default:l(()=>e[16]||(e[16]=[n("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(a(Z),{bordered:!1},{default:l(()=>[O("div",Ie,[e[18]||(e[18]=O("div",{class:"table-title"},"用户列表",-1)),O("div",Me,[t(a(H),null,{default:l(()=>[t(a(w),{type:"primary",onClick:ue},{default:l(()=>e[17]||(e[17]=[n("新增用户")])),_:1}),t(a(ke),{title:"刷新"},{default:l(()=>[t(a(w),{onClick:_},{icon:l(()=>[t(a(Re))]),_:1})]),_:1})]),_:1})])]),t(a(ee),{columns:A,"data-source":S.value,loading:k.value,pagination:v,onChange:oe,"row-key":"id"},{bodyCell:l(({column:o,record:u})=>[o.key==="role"?(g(),z(a($),{key:0,color:K(u.role)},{default:l(()=>[n(p(J(u.role)),1)]),_:2},1032,["color"])):D("",!0),o.key==="status"?(g(),z(a($),{key:1,color:G(u.status)},{default:l(()=>[n(p(Q(u.status)),1)]),_:2},1032,["color"])):D("",!0),o.key==="createdAt"?(g(),I(X,{key:2},[n(p(M(u.createdAt)),1)],64)):D("",!0),o.key==="action"?(g(),z(a(H),{key:3},{default:l(()=>[t(a(w),{type:"link",onClick:()=>ne(u)},{default:l(()=>e[19]||(e[19]=[n(" 详情 ")])),_:2},1032,["onClick"]),t(a(w),{type:"link",onClick:()=>de(u)},{default:l(()=>e[20]||(e[20]=[n(" 编辑 ")])),_:2},1032,["onClick"]),t(a(w),{type:"link",onClick:()=>pe(u)},{default:l(()=>e[21]||(e[21]=[n(" 重置密码 ")])),_:2},1032,["onClick"]),t(a(Ye),{title:`确定${u.status==="active"?"禁用":"启用"}该用户吗？`,onConfirm:()=>ce(u),"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[t(a(w),{type:"link",danger:u.status==="active"},{default:l(()=>[n(p(u.status==="active"?"禁用":"启用"),1)]),_:2},1032,["danger"])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):D("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),t(a(L),{visible:C.value,"onUpdate:visible":e[3]||(e[3]=o=>C.value=o),title:"用户详情",width:"800px",footer:null,"mask-closable":!0},{default:l(()=>{var o,u;return[i.value?(g(),I("div",Te,[t(a(ae),{title:"基本信息",bordered:"",column:2},{default:l(()=>[t(a(b),{label:"ID"},{default:l(()=>[n(p(i.value.id),1)]),_:1}),t(a(b),{label:"用户名"},{default:l(()=>[n(p(i.value.username),1)]),_:1}),t(a(b),{label:"姓名"},{default:l(()=>[n(p(i.value.name||"-"),1)]),_:1}),t(a(b),{label:"手机号"},{default:l(()=>[n(p(i.value.phone||"-"),1)]),_:1}),t(a(b),{label:"角色"},{default:l(()=>[t(a($),{color:K(i.value.role)},{default:l(()=>[n(p(J(i.value.role)),1)]),_:1},8,["color"])]),_:1}),t(a(b),{label:"状态"},{default:l(()=>[t(a($),{color:G(i.value.status)},{default:l(()=>[n(p(Q(i.value.status)),1)]),_:1},8,["color"])]),_:1}),t(a(b),{label:"创建时间"},{default:l(()=>[n(p(M(i.value.createdAt)),1)]),_:1}),t(a(b),{label:"更新时间"},{default:l(()=>[n(p(M(i.value.updatedAt)),1)]),_:1})]),_:1}),t(a(we)),t(a(ae),{title:"统计信息",bordered:"",column:1},{default:l(()=>[t(a(b),{label:"订单数量"},{default:l(()=>{var T;return[n(p(((T=i.value.stats)==null?void 0:T.orderCount)||0),1)]}),_:1})]),_:1}),(u=(o=i.value.stats)==null?void 0:o.recentOrders)!=null&&u.length?(g(),I("div",$e,[e[22]||(e[22]=O("h3",null,"最近订单",-1)),t(a(ee),{columns:[{title:"订单号",dataIndex:"orderNo",key:"orderNo"},{title:"金额",dataIndex:"totalAmount",key:"totalAmount"},{title:"状态",dataIndex:"status",key:"status"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt"}],"data-source":i.value.stats.recentOrders,pagination:!1,"row-key":"id"},{bodyCell:l(({column:T,record:ye})=>[T.key==="createdAt"?(g(),I(X,{key:0},[n(p(M(ye.createdAt)),1)],64)):D("",!0)]),_:1},8,["data-source"])])):D("",!0)])):D("",!0)]}),_:1},8,["visible"]),t(a(L),{visible:U.value,"onUpdate:visible":e[9]||(e[9]=o=>U.value=o),title:r.id?"编辑用户":"新增用户",onOk:me,"confirm-loading":h.value,onCancel:ie,"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[t(a(q),{ref_key:"editFormRef",ref:V,model:r,rules:te,"label-col":{span:4},"wrapper-col":{span:20}},{default:l(()=>[t(a(f),{label:"用户名",name:"username"},{default:l(()=>[t(a(P),{value:r.username,"onUpdate:value":e[4]||(e[4]=o=>r.username=o),placeholder:"请输入用户名",disabled:!!r.id},null,8,["value","disabled"])]),_:1}),r.id?D("",!0):(g(),z(a(f),{key:0,label:"密码",name:"password"},{default:l(()=>[t(a(P).Password,{value:r.password,"onUpdate:value":e[5]||(e[5]=o=>r.password=o),placeholder:"请输入密码"},null,8,["value"])]),_:1})),t(a(f),{label:"姓名",name:"name"},{default:l(()=>[t(a(P),{value:r.name,"onUpdate:value":e[6]||(e[6]=o=>r.name=o),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),t(a(f),{label:"手机号",name:"phone"},{default:l(()=>[t(a(P),{value:r.phone,"onUpdate:value":e[7]||(e[7]=o=>r.phone=o),placeholder:"请输入手机号"},null,8,["value"])]),_:1}),t(a(f),{label:"角色",name:"role"},{default:l(()=>[t(a(W),{value:r.role,"onUpdate:value":e[8]||(e[8]=o=>r.role=o)},{default:l(()=>[t(a(Y),{value:"admin"},{default:l(()=>e[23]||(e[23]=[n("管理员")])),_:1}),t(a(Y),{value:"user"},{default:l(()=>e[24]||(e[24]=[n("普通用户")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","confirm-loading"]),t(a(L),{visible:R.value,"onUpdate:visible":e[11]||(e[11]=o=>R.value=o),title:"重置密码",onOk:fe,"confirm-loading":h.value,onCancel:ve,"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[t(a(q),{ref_key:"resetPasswordFormRef",ref:E,model:x,rules:le,"label-col":{span:4},"wrapper-col":{span:20}},{default:l(()=>[t(a(f),{label:"新密码",name:"password"},{default:l(()=>[t(a(P).Password,{value:x.password,"onUpdate:value":e[10]||(e[10]=o=>x.password=o),placeholder:"请输入新密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])]))}}),Ke=he(Be,[["__scopeId","data-v-c07a93f2"]]);export{Ke as default};
