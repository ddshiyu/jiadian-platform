var v=(p,r,s)=>new Promise((i,d)=>{var m=o=>{try{e(s.next(o))}catch(u){d(u)}},f=o=>{try{e(s.throw(o))}catch(u){d(u)}},e=o=>o.done?i(o.value):Promise.resolve(o.value).then(m,f);e((s=s.apply(p,r)).next())});import{a7 as k,a8 as P,a9 as z,O as $,aa as C}from"./bootstrap-PxKnX6yB.js";import{useWatermark as R}from"./index-xxfD4swJ.js";import{u as E,f as T,N as q,i as U,_ as V}from"./layout.vue_vue_type_script_setup_true_lang-C3XUTQLY.js";import{_ as W}from"./avatar.vue_vue_type_script_setup_true_lang-y7cdcdPD.js";import{d as S,K as Z,L as D,M as A,c as x,a as F,b as B,A as l,z as c,g as n,i as O,r as _,q as L,o as J,N as K,l as Q}from"../jse/index-index-D7J90qLZ.js";import"./use-tabs-BekHUgH_.js";import"./tabbar-BN5XRhat.js";import"./index-M2RsLbEE.js";import"./theme-toggle.vue_vue_type_script_setup_true_lang-0VCJRqDm.js";import"./TabsList.vue_vue_type_script_setup_true_lang-0V8U8FsP.js";import"./rotate-cw-CvsGbAFn.js";const j=S({name:"LoginExpiredModal",__name:"login-expired-modal",props:Z({avatar:{default:""},zIndex:{default:0},codeLoginPath:{},forgetPasswordPath:{},loading:{type:Boolean},qrCodeLoginPath:{},registerPath:{},showCodeLogin:{type:Boolean},showForgetPassword:{type:Boolean},showQrcodeLogin:{type:Boolean},showRegister:{type:Boolean},showRememberMe:{type:Boolean},showThirdPartyLogin:{type:Boolean},subTitle:{},title:{},submitButtonText:{}},{open:{type:Boolean},openModifiers:{}}),emits:["update:open"],setup(p){const r=p,s=D(p,"open"),[i,d]=E();A(()=>s.value,e=>{d.setState({isOpen:e})});const m=x(()=>r.zIndex||f());function f(){let e=0;return[...document.querySelectorAll("*")].forEach(u=>{const g=window.getComputedStyle(u).getPropertyValue("z-index");g&&!Number.isNaN(Number.parseInt(g))&&(e=Math.max(e,Number.parseInt(g)))}),e+1}return(e,o)=>(B(),F("div",null,[l(n(i),{closable:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,footer:!1,"fullscreen-button":!1,header:!1,"z-index":m.value,class:"border-none px-10 py-6 text-center shadow-xl sm:w-[600px] sm:rounded-2xl md:h-[unset]"},{default:c(()=>[l(n(W),{src:e.avatar,class:"mx-auto mb-6 size-20"},null,8,["src"]),l(n(k),{"show-forget-password":!1,"show-register":!1,"show-remember-me":!1,"sub-title":e.$t("authentication.loginAgainSubTitle"),title:e.$t("authentication.loginAgainTitle")},{default:c(()=>[O(e.$slots,"default")]),_:3},8,["sub-title","title"])]),_:3},8,["z-index"])]))}}),ie=S({__name:"basic",setup(p){const r=_([]),s=_(!1),i=P(),d=z(),m=$(),{destroyWatermark:f,updateWatermark:e}=R(),o=x(()=>r.value.some(a=>!a.isRead)),u=x(()=>[]),h=x(()=>{var a,t;return(t=(a=i.userInfo)==null?void 0:a.avatar)!=null?t:L.app.defaultAvatar}),g=()=>v(this,null,function*(){s.value=!0;try{const a=yield getMessageListApi({pageNum:1,pageSize:10});r.value=a.row.map(t=>({id:t.id,title:t.title,message:t.content,isRead:t.isRead===1,date:new Date().toLocaleString(),avatar:""}))}catch(a){console.error("获取消息失败")}finally{s.value=!1}}),b=a=>v(this,null,function*(){});function y(){return v(this,null,function*(){yield d.logout(!1)})}function I(){r.value=[]}function N(){r.value.forEach(a=>{a.isRead=!0,b()})}A(()=>L.app.watermark,a=>v(this,null,function*(){var t;a?yield e({content:`${(t=i.userInfo)==null?void 0:t.username}`}):f()}),{immediate:!0});const M=_(null);return J(()=>{M.value=setInterval(()=>{g()},1e4)}),K(()=>{clearInterval(M.value)}),(a,t)=>(B(),Q(n(V),{onClearPreferencesAndLogout:y},{"user-dropdown":c(()=>{var w;return[l(n(U),{avatar:h.value,menus:u.value,text:(w=n(i).userInfo)==null?void 0:w.realName,description:"ann.vben@gmail.com","tag-text":"Pro",onLogout:y},null,8,["avatar","menus","text"])]}),notification:c(()=>[l(n(q),{dot:o.value,loading:s.value,notifications:r.value,onClear:I,onMakeAll:N,onRead:b},null,8,["dot","loading","notifications"])]),extra:c(()=>[l(n(j),{open:n(m).loginExpired,"onUpdate:open":t[0]||(t[0]=w=>n(m).loginExpired=w),avatar:h.value},{default:c(()=>[l(C)]),_:1},8,["open","avatar"])]),"lock-screen":c(()=>[l(n(T),{avatar:h.value,onToLogin:y},null,8,["avatar"])]),_:1}))}});export{ie as default};
