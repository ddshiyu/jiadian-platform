var h=(P,S,f)=>new Promise((g,U)=>{var B=o=>{try{m(f.next(o))}catch(w){U(w)}},b=o=>{try{m(f.throw(o))}catch(w){U(w)}},m=o=>o.done?g(o.value):Promise.resolve(o.value).then(B,b);m((f=f.apply(P,S)).next())});import{cd as ae,o as d,aD as N,aE as te,aF as c,aI as O,aG as se,aH as M,n as R,B as I,aJ as le,aK as oe,ce as ne,ca as ie,cf as re,bC as j,cc as ue,aL as de,aM as ce}from"./bootstrap-DQlkkZAY.js";import{q as pe,T as fe,t as me,v as ve,w as ye}from"./operation-Cao-9zmS.js";import{C as V,P as F}from"./index-CrE2fLll.js";import{a3 as ge,P as v,T as G,J as be,ao as ke,a4 as C,a5 as p,x as t,ah as l,aa as a,at as i,aK as y,aB as A,ae as J,au as Ce}from"../jse/index-index-_HsMvMo5.js";import{P as we}from"./index-CQs6e48e.js";import"./Dropdown-BE9qtqDz.js";import"./index-BAe2oAwF.js";const _e={class:"table-header"},Ie={class:"table-action"},xe={key:0,class:"category-icon"},he=["src"],Se={key:1,class:"no-icon"},Ue=["onClick"],Be={key:0},De=["src"],Me={key:1},Ae=ge({__name:"category",setup(P){const S=[{title:"分类名称",dataIndex:"name",key:"name",width:"30%"},{title:"图标",dataIndex:"icon",key:"icon",width:100},{title:"排序",dataIndex:"sort",key:"sort",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:200}],f=v([]),g=v(!1),B={Authorization:`Bearer ${ae().accessToken}`},b=v(!1),m=v(null),o=G({id:0,name:"",parentId:0,icon:"",sort:0,status:"active",description:""}),w={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],status:[{required:!0,message:"请选择分类状态",trigger:"change"}]},x=v([]),k=v(!1),D=v(!1),q=be(()=>o.id?"编辑分类":"新增分类"),r=G({name:"",status:""});ke(()=>{_()});const _=()=>h(this,null,function*(){g.value=!0;try{const s=yield pe();if(s){const e=z(s);f.value=r.name||r.status?E(e,r):e}g.value=!1}catch(s){console.error("获取分类列表失败:",s),d.error("获取分类列表失败"),g.value=!1}}),z=s=>s.list.filter(e=>!e.parentId||e.parentId===0).map(e=>({id:e.id||0,name:e.name,icon:e.icon||"",sort:e.sort||0,status:"active",parentId:0,description:e.description||""})),E=(s,e)=>s.filter(n=>{let u=!0,L=!0;return e.name&&(u=n.name.includes(e.name)),e.status&&(L=n.status===e.status),u&&L}),$=()=>{_()},H=()=>{Object.assign(r,{name:"",status:""}),_()},K=()=>{Q()},Q=()=>{b.value=!1,Object.assign(o,{id:0,name:"",parentId:0,icon:"",sort:0,status:"active",description:""}),x.value=[],k.value=!0},W=s=>{b.value=!0,Object.assign(o,{id:s.id,name:s.name,parentId:0,icon:s.icon,sort:s.sort,status:s.status,description:s.description||""}),x.value=s.icon?[{uid:"-1",name:"icon.jpg",url:s.icon}]:[],k.value=!0},X=s=>h(this,null,function*(){try{yield me(s.id),d.success("删除成功"),_()}catch(e){console.error("删除分类失败:",e),d.error("删除分类失败")}}),T=()=>{k.value=!1,b.value=!1},Y=()=>h(this,null,function*(){if(m.value)try{yield m.value.validate(),D.value=!0;const s={name:o.name,icon:o.icon,sort:o.sort,parentId:0};try{o.id?(yield ve(o.id,s),d.success("修改成功")):(yield ye(s),d.success("添加成功")),yield _(),k.value=!1,b.value=!1}catch(e){console.error("保存分类失败:",e),d.error("保存分类失败")}finally{D.value=!1}}catch(s){console.error("表单验证失败:",s)}}),Z=s=>{const e=s.type==="image/jpeg"||s.type==="image/png";e||d.error("只能上传JPG/PNG格式的图片!");const n=s.size!==void 0&&s.size/1024/1024<2;return n||d.error("图片必须小于2MB!"),e&&n},ee=s=>{s.file.status!=="uploading"&&s.file.status==="done"&&(o.icon=`http://8.140.251.91${s.file.response.data.image.url}`)};return(s,e)=>(p(),C("div",null,[t(a(V),{bordered:!1,class:"mb-20"},{default:l(()=>[t(a(N),{model:r,layout:"inline",class:"search-form",onSubmit:te($,["prevent"])},{default:l(()=>[t(a(c),{label:"分类名称"},{default:l(()=>[t(a(O),{value:r.name,"onUpdate:value":e[0]||(e[0]=n=>r.name=n),placeholder:"请输入分类名称","allow-clear":""},null,8,["value"])]),_:1}),t(a(c),{label:"状态"},{default:l(()=>[t(a(se),{value:r.status,"onUpdate:value":e[1]||(e[1]=n=>r.status=n),placeholder:"请选择状态",style:{width:"140px"},"allow-clear":""},{default:l(()=>[t(a(M),{value:""},{default:l(()=>e[8]||(e[8]=[i("全部")])),_:1}),t(a(M),{value:"active"},{default:l(()=>e[9]||(e[9]=[i("启用")])),_:1}),t(a(M),{value:"inactive"},{default:l(()=>e[10]||(e[10]=[i("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(c),null,{default:l(()=>[t(a(R),null,{default:l(()=>[t(a(I),{type:"primary","html-type":"submit"},{default:l(()=>e[11]||(e[11]=[i("查询")])),_:1}),t(a(I),{onClick:H},{default:l(()=>e[12]||(e[12]=[i("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(a(V),{bordered:!1},{default:l(()=>[y("div",_e,[e[14]||(e[14]=y("div",{class:"table-title"},"商品分类",-1)),y("div",Ie,[t(a(I),{type:"primary",onClick:K},{icon:l(()=>[t(a(F))]),default:l(()=>[e[13]||(e[13]=i(" 新增分类 "))]),_:1})])]),t(a(fe),{columns:S,"data-source":f.value,loading:g.value,pagination:!1,"row-key":"id"},{bodyCell:l(({column:n,record:u})=>[n.key==="icon"?(p(),C("div",xe,[u.icon?(p(),C("img",{key:0,src:u.icon,alt:"分类图标"},null,8,he)):(p(),C("div",Se,"无"))])):A("",!0),n.key==="status"?(p(),J(a(le),{key:1,color:u.status==="active"?"green":"orange"},{default:l(()=>[i(Ce(u.status==="active"?"启用":"禁用"),1)]),_:2},1032,["color"])):A("",!0),n.key==="action"?(p(),J(a(R),{key:2},{default:l(()=>[y("a",{onClick:()=>W(u)},"编辑",8,Ue),t(a(oe),{type:"vertical"}),t(a(we),{title:"确定删除该分类吗？",onConfirm:()=>X(u),"ok-text":"确定","cancel-text":"取消"},{default:l(()=>e[15]||(e[15]=[y("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):A("",!0)]),_:1},8,["data-source","loading"])]),_:1}),t(a(de),{visible:k.value,"onUpdate:visible":e[7]||(e[7]=n=>k.value=n),title:q.value,width:"600px","mask-closable":!1,onCancel:T},{footer:l(()=>[t(a(I),{onClick:T},{default:l(()=>e[19]||(e[19]=[i("取消")])),_:1}),t(a(I),{type:"primary",loading:D.value,onClick:Y},{default:l(()=>e[20]||(e[20]=[i(" 确定 ")])),_:1},8,["loading"])]),default:l(()=>[t(a(N),{ref_key:"formRef",ref:m,model:o,rules:w,"label-col":{span:4},"wrapper-col":{span:18}},{default:l(()=>[t(a(c),{label:"分类名称",name:"name"},{default:l(()=>[t(a(O),{value:o.name,"onUpdate:value":e[2]||(e[2]=n=>o.name=n),placeholder:"请输入分类名称"},null,8,["value"])]),_:1}),t(a(c),{label:"分类图标",name:"icon"},{default:l(()=>[t(a(ne),{"file-list":x.value,"onUpdate:fileList":e[3]||(e[3]=n=>x.value=n),"list-type":"picture-card","show-upload-list":!1,action:"http://8.140.251.91/upload/image",headers:B,name:"image","before-upload":Z,onChange:ee},{default:l(()=>[o.icon?(p(),C("div",Be,[y("img",{src:o.icon,alt:"分类图标",style:{width:"100%"}},null,8,De)])):(p(),C("div",Me,[t(a(F)),e[16]||(e[16]=y("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),t(a(c),{label:"排序",name:"sort"},{default:l(()=>[t(a(ie),{value:o.sort,"onUpdate:value":e[4]||(e[4]=n=>o.sort=n),placeholder:"数字越小越靠前",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),t(a(c),{label:"状态",name:"status"},{default:l(()=>[t(a(re),{value:o.status,"onUpdate:value":e[5]||(e[5]=n=>o.status=n)},{default:l(()=>[t(a(j),{value:"active"},{default:l(()=>e[17]||(e[17]=[i("启用")])),_:1}),t(a(j),{value:"inactive"},{default:l(()=>e[18]||(e[18]=[i("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(c),{label:"描述",name:"description"},{default:l(()=>[t(a(ue),{value:o.description,"onUpdate:value":e[6]||(e[6]=n=>o.description=n),placeholder:"请输入分类描述",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]))}}),Fe=ce(Ae,[["__scopeId","data-v-836a623f"]]);export{Fe as default};
