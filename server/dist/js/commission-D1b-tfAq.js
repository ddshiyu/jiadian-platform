var M=(o,d,i)=>new Promise((u,m)=>{var y=r=>{try{p(i.next(r))}catch(n){m(n)}},v=r=>{try{p(i.throw(r))}catch(n){m(n)}},p=r=>r.done?u(r.value):Promise.resolve(r.value).then(y,v);p((i=i.apply(o,d)).next())});import{w as ae,aE as ue,g as re,af as de,q as T,ag as ce,i as le,j as fe,n as L,aF as me,aG as q,x as ve,aH as pe,aI as ne,o as ge,aJ as ye,b as E,P as Se,Q as _e,R as Q,W as be,X as O,U as xe,S as K,B as U,Z as ee,a0 as P,a1 as Ce,_ as ke}from"./bootstrap-BBk6SY2t.js";import{A as e,d as Z,r as N,o as se,a3 as we,P as Ie,I as te,a as F,b,z as a,g as t,B as c,f as R,l as A,e as $,t as S,G as De,J as $e}from"../jse/index-index-Pp9M58hi.js";import{E as Te,F as he,G as Fe,H as Re}from"./operation-UX5_STqx.js";import{S as Ae,C as H}from"./index-BSDYYvsn.js";import{D as V,a as _}from"./index-DX7J8Pls.js";import{T as Ne}from"./index-VmR0-qbv.js";import{P as B}from"./index-CixpByLt.js";const Y=ae(ue),oe=o=>{const{value:d,formatter:i,precision:u,decimalSeparator:m,groupSeparator:y="",prefixCls:v}=o;let p;if(typeof i=="function")p=i({value:d});else{const r=String(d),n=r.match(/^(-?)(\d*)(\.(\d+))?$/);if(!n)p=r;else{const k=n[1];let f=n[2]||"0",g=n[4]||"";f=f.replace(/\B(?=(\d{3})+(?!\d))/g,y),typeof u=="number"&&(g=g.padEnd(u,"0").slice(0,u>0?u:0)),g&&(g=`${m}${g}`),p=[e("span",{key:"int",class:`${v}-content-value-int`},[k,f]),g&&e("span",{key:"decimal",class:`${v}-content-value-decimal`},[g])]}}return e("span",{class:`${v}-content-value`},[p])};oe.displayName="StatisticNumber";const ze=o=>{const{componentCls:d,marginXXS:i,padding:u,colorTextDescription:m,statisticTitleFontSize:y,colorTextHeading:v,statisticContentFontSize:p,statisticFontFamily:r}=o;return{[`${d}`]:T(T({},ce(o)),{[`${d}-title`]:{marginBottom:i,color:m,fontSize:y},[`${d}-skeleton`]:{paddingTop:u},[`${d}-content`]:{color:v,fontSize:p,fontFamily:r,[`${d}-content-value`]:{display:"inline-block",direction:"ltr"},[`${d}-content-prefix, ${d}-content-suffix`]:{display:"inline-block"},[`${d}-content-prefix`]:{marginInlineEnd:i},[`${d}-content-suffix`]:{marginInlineStart:i}}})}},He=re("Statistic",o=>{const{fontSizeHeading3:d,fontSize:i,fontFamily:u}=o,m=de(o,{statisticTitleFontSize:i,statisticContentFontSize:d,statisticFontFamily:u});return[ze(m)]}),ie=()=>({prefixCls:String,decimalSeparator:String,groupSeparator:String,format:String,value:ne([Number,String,Object]),valueStyle:{type:Object,default:void 0},valueRender:pe(),formatter:ve(),precision:Number,prefix:q(),suffix:q(),title:q(),loading:me()}),D=Z({compatConfig:{MODE:3},name:"AStatistic",inheritAttrs:!1,props:le(ie(),{decimalSeparator:".",groupSeparator:",",loading:!1}),slots:Object,setup(o,d){let{slots:i,attrs:u}=d;const{prefixCls:m,direction:y}=fe("statistic",o),[v,p]=He(m);return()=>{var r,n,k,f,g,w,h;const{value:G=0,valueStyle:X,valueRender:j}=o,I=m.value,z=(r=o.title)!==null&&r!==void 0?r:(n=i.title)===null||n===void 0?void 0:n.call(i),s=(k=o.prefix)!==null&&k!==void 0?k:(f=i.prefix)===null||f===void 0?void 0:f.call(i),l=(g=o.suffix)!==null&&g!==void 0?g:(w=i.suffix)===null||w===void 0?void 0:w.call(i),x=(h=o.formatter)!==null&&h!==void 0?h:i.formatter;let C=e(oe,L({"data-for-update":Date.now()},T(T({},o),{prefixCls:I,value:G,formatter:x})),null);return j&&(C=j(C)),v(e("div",L(L({},u),{},{class:[I,{[`${I}-rtl`]:y.value==="rtl"},u.class,p.value]}),[z&&e("div",{class:`${I}-title`},[z]),e(Ae,{paragraph:!1,loading:o.loading},{default:()=>[e("div",{style:X,class:`${I}-content`},[s&&e("span",{class:`${I}-content-prefix`},[s]),C,l&&e("span",{class:`${I}-content-suffix`},[l])])]})]))}}}),Me=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function Ee(o,d){let i=o;const u=/\[[^\]]*]/g,m=(d.match(u)||[]).map(r=>r.slice(1,-1)),y=d.replace(u,"[]"),v=Me.reduce((r,n)=>{let[k,f]=n;if(r.includes(k)){const g=Math.floor(i/f);return i-=g*f,r.replace(new RegExp(`${k}+`,"g"),w=>{const h=w.length;return g.toString().padStart(h,"0")})}return r},y);let p=0;return v.replace(u,()=>{const r=m[p];return p+=1,r})}function Be(o,d){const{format:i=""}=d,u=new Date(o).getTime(),m=Date.now(),y=Math.max(u-m,0);return Ee(y,i)}const je=1e3/30;function W(o){return new Date(o).getTime()}const Oe=()=>T(T({},ie()),{value:ne([Number,String,Object]),format:String,onFinish:Function,onChange:Function}),Ue=Z({compatConfig:{MODE:3},name:"AStatisticCountdown",props:le(Oe(),{format:"HH:mm:ss"}),setup(o,d){let{emit:i,slots:u}=d;const m=N(),y=N(),v=()=>{const{value:f}=o;W(f)>=Date.now()?p():r()},p=()=>{if(m.value)return;const f=W(o.value);m.value=setInterval(()=>{y.value.$forceUpdate(),f>Date.now()&&i("change",f-Date.now()),v()},je)},r=()=>{const{value:f}=o;m.value&&(clearInterval(m.value),m.value=void 0,W(f)<Date.now()&&i("finish"))},n=f=>{let{value:g,config:w}=f;const{format:h}=o;return Be(g,T(T({},w),{format:h}))},k=f=>f;return se(()=>{v()}),we(()=>{v()}),Ie(()=>{r()}),()=>{const f=o.value;return e(D,L({ref:y},T(T({},ge(o,["onFinish","onChange"])),{value:f,valueRender:k,formatter:n})),u)}}});D.Countdown=Ue;D.install=function(o){return o.component(D.name,D),o.component(D.Countdown.name,D.Countdown),o};D.Countdown;const Pe=ae(ye),Ve=["onClick"],Ye={key:0,class:"loading-container"},Le={key:1},Ge={class:"price"},Xe=["src"],Je={key:1},qe=["src"],Qe={key:1},We={class:"price"},Ze={key:3,class:"modal-action"},Ke=Z({__name:"commission",setup(o){const d=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"获得用户",dataIndex:"user",key:"user",customRender:({record:s})=>s.user?`${s.user.nickname} (${s.user.phone})`:"-"},{title:"邀请用户",dataIndex:"invitee",key:"invitee",customRender:({record:s})=>s.invitee?`${s.invitee.nickname} (${s.invitee.phone})`:"-"},{title:"订单号",dataIndex:"order",key:"order",customRender:({record:s})=>s.order?s.order.orderNo:"-"},{title:"佣金金额",dataIndex:"amount",key:"amount",width:100,customRender:({text:s})=>`¥${s.toFixed(2)}`},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:180},{title:"操作",key:"action",width:180}],i=N({totalCommission:0,todayCommission:0,monthCommission:0,totalRecords:0}),u=te({status:null,userId:null}),m=N([]),y=N(!1),v=te({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:s=>`共 ${s} 条数据`}),p=N(!1),r=N(!1),n=N(null),k={pending:"orange",settled:"green",cancelled:"red"},f={pending:"待结算",settled:"已结算",cancelled:"已取消"};se(()=>{g(),w()});const g=()=>M(this,null,function*(){try{const s=yield Te();s&&(i.value=s)}catch(s){console.error("获取佣金统计数据失败:",s),E.error("获取佣金统计数据失败")}}),w=()=>M(this,null,function*(){y.value=!0;try{const s={status:u.status||void 0,userId:u.userId===null?void 0:u.userId,pageNum:v.current,pageSize:v.pageSize},l=yield he(s);l&&(m.value=l.list,v.total=l.total),y.value=!1}catch(s){console.error("获取佣金列表失败:",s),E.error("获取佣金列表失败"),y.value=!1}}),h=s=>{s.current&&(v.current=s.current),s.pageSize&&(v.pageSize=s.pageSize),w()},G=()=>{v.current=1,w()},X=()=>{Object.assign(u,{status:null,userId:null}),v.current=1,w()},j=s=>M(this,null,function*(){r.value=!0,p.value=!0;try{const l=yield Fe(s.id);l&&(n.value=l),r.value=!1}catch(l){console.error("获取佣金详情失败:",l),E.error("获取佣金详情失败"),r.value=!1}}),I=(s,l)=>M(this,null,function*(){try{yield Re(s.id,l),E.success("状态更新成功"),w(),g()}catch(x){console.error("更新佣金状态失败:",x),E.error("更新佣金状态失败")}}),z=s=>s?$e(s).format("YYYY-MM-DD HH:mm:ss"):"-";return(s,l)=>(b(),F("div",null,[e(t(Pe),{gutter:16,class:"mb-20"},{default:a(()=>[e(t(Y),{span:6},{default:a(()=>[e(t(H),null,{default:a(()=>[e(t(D),{title:"总佣金金额",value:i.value.totalCommission,precision:2,suffix:"元","value-style":{color:"#3f8600"}},null,8,["value"])]),_:1})]),_:1}),e(t(Y),{span:6},{default:a(()=>[e(t(H),null,{default:a(()=>[e(t(D),{title:"今日佣金",value:i.value.todayCommission,precision:2,suffix:"元","value-style":{color:"#cf1322"}},null,8,["value"])]),_:1})]),_:1}),e(t(Y),{span:6},{default:a(()=>[e(t(H),null,{default:a(()=>[e(t(D),{title:"本月佣金",value:i.value.monthCommission,precision:2,suffix:"元"},null,8,["value"])]),_:1})]),_:1}),e(t(Y),{span:6},{default:a(()=>[e(t(H),null,{default:a(()=>[e(t(D),{title:"佣金记录总数",value:i.value.totalRecords,"value-style":{color:"#1890ff"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(t(H),{bordered:!1,class:"mb-20"},{default:a(()=>[e(t(Se),{model:u,layout:"inline",class:"search-form",onSubmit:_e(G,["prevent"])},{default:a(()=>[e(t(Q),{label:"佣金状态"},{default:a(()=>[e(t(be),{value:u.status,"onUpdate:value":l[0]||(l[0]=x=>u.status=x),placeholder:"请选择佣金状态",style:{width:"200px"},"allow-clear":""},{default:a(()=>[e(t(O),{value:null},{default:a(()=>l[5]||(l[5]=[c("全部")])),_:1}),e(t(O),{value:"pending"},{default:a(()=>l[6]||(l[6]=[c("待结算")])),_:1}),e(t(O),{value:"settled"},{default:a(()=>l[7]||(l[7]=[c("已结算")])),_:1}),e(t(O),{value:"cancelled"},{default:a(()=>l[8]||(l[8]=[c("已取消")])),_:1})]),_:1},8,["value"])]),_:1}),e(t(Q),{label:"用户ID"},{default:a(()=>[e(t(xe),{value:u.userId===null?"":u.userId,placeholder:"请输入用户ID",style:{width:"200px"},"allow-clear":"","onUpdate:value":l[1]||(l[1]=x=>u.userId=x?Number(x):null)},null,8,["value"])]),_:1}),e(t(Q),null,{default:a(()=>[e(t(K),null,{default:a(()=>[e(t(U),{type:"primary","html-type":"submit"},{default:a(()=>l[9]||(l[9]=[c("查询")])),_:1}),e(t(U),{onClick:X},{default:a(()=>l[10]||(l[10]=[c("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(t(H),{bordered:!1},{default:a(()=>[l[14]||(l[14]=R("div",{class:"table-header"},[R("div",{class:"table-title"},"佣金记录")],-1)),e(t(Ne),{columns:d,"data-source":m.value,loading:y.value,pagination:v,onChange:h,"row-key":"id"},{bodyCell:a(({column:x,record:C})=>[x.key==="status"?(b(),A(t(ee),{key:0,color:k[C.status]},{default:a(()=>[c(S(f[C.status]),1)]),_:2},1032,["color"])):$("",!0),x.key==="createdAt"?(b(),F(De,{key:1},[c(S(z(C.createdAt)),1)],64)):$("",!0),x.key==="action"?(b(),A(t(K),{key:2},{default:a(()=>[R("a",{onClick:J=>j(C)},"详情",8,Ve),e(t(P),{type:"vertical"}),C.status==="pending"?(b(),A(t(B),{key:0,title:"确定结算该佣金吗？",onConfirm:J=>I(C,"settled"),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>l[11]||(l[11]=[R("a",null,"结算",-1)])),_:2},1032,["onConfirm"])):$("",!0),C.status==="pending"?(b(),A(t(B),{key:1,title:"确定取消该佣金吗？",onConfirm:J=>I(C,"cancelled"),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>l[12]||(l[12]=[R("a",{class:"danger-link"},"取消",-1)])),_:2},1032,["onConfirm"])):$("",!0),C.status==="cancelled"?(b(),A(t(B),{key:2,title:"确定恢复为待结算状态吗？",onConfirm:J=>I(C,"pending"),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>l[13]||(l[13]=[R("a",null,"恢复",-1)])),_:2},1032,["onConfirm"])):$("",!0)]),_:2},1024)):$("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),e(t(Ce),{visible:p.value,"onUpdate:visible":l[4]||(l[4]=x=>p.value=x),title:"佣金详情",width:"800px",footer:null,"mask-closable":!0},{default:a(()=>[r.value?(b(),F("div",Ye,"加载中...")):n.value?(b(),F("div",Le,[e(t(V),{bordered:"",column:2},{default:a(()=>[e(t(_),{label:"佣金ID"},{default:a(()=>[c(S(n.value.id),1)]),_:1}),e(t(_),{label:"佣金金额"},{default:a(()=>[R("span",Ge,"¥"+S(n.value.amount.toFixed(2)),1)]),_:1}),e(t(_),{label:"佣金状态"},{default:a(()=>[e(t(ee),{color:k[n.value.status]},{default:a(()=>[c(S(f[n.value.status]),1)]),_:1},8,["color"])]),_:1}),e(t(_),{label:"创建时间"},{default:a(()=>[c(S(z(n.value.createdAt)),1)]),_:1}),e(t(_),{label:"更新时间"},{default:a(()=>[c(S(z(n.value.updatedAt)),1)]),_:1})]),_:1}),e(t(P),null,{default:a(()=>l[15]||(l[15]=[c("佣金获得者信息")])),_:1}),n.value.user?(b(),A(t(V),{key:0,bordered:"",column:2},{default:a(()=>[e(t(_),{label:"用户ID"},{default:a(()=>[c(S(n.value.user.id),1)]),_:1}),e(t(_),{label:"用户昵称"},{default:a(()=>[c(S(n.value.user.nickname),1)]),_:1}),e(t(_),{label:"手机号"},{default:a(()=>[c(S(n.value.user.phone),1)]),_:1}),e(t(_),{label:"头像"},{default:a(()=>[n.value.user.avatar?(b(),F("img",{key:0,src:n.value.user.avatar,alt:"用户头像",class:"user-avatar"},null,8,Xe)):(b(),F("span",Je,"无头像"))]),_:1})]),_:1})):$("",!0),e(t(P),null,{default:a(()=>l[16]||(l[16]=[c("邀请人信息")])),_:1}),n.value.invitee?(b(),A(t(V),{key:1,bordered:"",column:2},{default:a(()=>[e(t(_),{label:"用户ID"},{default:a(()=>[c(S(n.value.invitee.id),1)]),_:1}),e(t(_),{label:"用户昵称"},{default:a(()=>[c(S(n.value.invitee.nickname),1)]),_:1}),e(t(_),{label:"手机号"},{default:a(()=>[c(S(n.value.invitee.phone),1)]),_:1}),e(t(_),{label:"头像"},{default:a(()=>[n.value.invitee.avatar?(b(),F("img",{key:0,src:n.value.invitee.avatar,alt:"用户头像",class:"user-avatar"},null,8,qe)):(b(),F("span",Qe,"无头像"))]),_:1})]),_:1})):$("",!0),e(t(P),null,{default:a(()=>l[17]||(l[17]=[c("关联订单信息")])),_:1}),n.value.order?(b(),A(t(V),{key:2,bordered:"",column:2},{default:a(()=>[e(t(_),{label:"订单ID"},{default:a(()=>[c(S(n.value.order.id),1)]),_:1}),e(t(_),{label:"订单号"},{default:a(()=>[c(S(n.value.order.orderNo),1)]),_:1}),e(t(_),{label:"订单金额"},{default:a(()=>[R("span",We,"¥"+S(n.value.order.totalAmount),1)]),_:1}),e(t(_),{label:"订单状态"},{default:a(()=>[c(S(n.value.order.status),1)]),_:1}),e(t(_),{label:"下单时间"},{default:a(()=>[c(S(z(n.value.order.createdAt)),1)]),_:1})]),_:1})):$("",!0),n.value&&n.value.status==="pending"?(b(),F("div",Ze,[e(t(B),{title:"确定结算该佣金吗？",onConfirm:l[2]||(l[2]=()=>{I(n.value,"settled"),p.value=!1}),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>[e(t(U),{type:"primary"},{default:a(()=>l[18]||(l[18]=[c("结算佣金")])),_:1})]),_:1}),e(t(B),{title:"确定取消该佣金吗？",onConfirm:l[3]||(l[3]=()=>{I(n.value,"cancelled"),p.value=!1}),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>[e(t(U),{danger:"",style:{"margin-left":"10px"}},{default:a(()=>l[19]||(l[19]=[c("取消佣金")])),_:1})]),_:1})])):$("",!0)])):$("",!0)]),_:1},8,["visible"])]))}}),ut=ke(Ke,[["__scopeId","data-v-e219057e"]]);export{ut as default};
