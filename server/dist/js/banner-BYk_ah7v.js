var x=(R,S,p)=>new Promise((b,U)=>{var I=i=>{try{c(p.next(i))}catch(o){U(o)}},A=i=>{try{c(p.throw(i))}catch(o){U(o)}},c=i=>i.done?b(i.value):Promise.resolve(i.value).then(I,A);c((p=p.apply(R,S)).next())});import{O as ne,b as f,P as N,Q as se,R as v,U as j,W as le,X as M,S as L,B as h,Z as oe,a0 as ie,a3 as re,a4 as ue,a5 as de,a6 as V,a1 as ce,_ as fe}from"./bootstrap-PxKnX6yB.js";import{e as me,f as pe,u as ve,i as ge}from"./operation-Be0XMEqK.js";import{C as $,P as q}from"./index-G_a0DtsV.js";import{T as ye}from"./index-C7aTtTZL.js";import{d as be,r as g,I as P,c as ke,o as Be,a as w,b as m,A as n,z as s,g as a,B as r,f as y,e as O,l as F,t as we}from"../jse/index-index-D7J90qLZ.js";import{P as _e}from"./index-DLFp5g9l.js";const he={class:"table-header"},Ce={class:"table-action"},xe={key:0,class:"banner-image"},Se=["src"],Ue={key:1,class:"no-image"},Ie=["onClick"],Ae={key:0},De=["src"],Me={key:1},Pe=be({__name:"banner",setup(R){const S=[{title:"图片",dataIndex:"image",key:"image",width:150},{title:"内容描述",dataIndex:"content",key:"content",width:"30%"},{title:"排序",dataIndex:"sort",key:"sort",width:80},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"操作",key:"action",width:150}],p=g([]),b=g(!1),I={Authorization:`Bearer ${ne().accessToken}`},A="https://qbylxb.cn/upload/image",c=g(!1),i=g(null),o=P({id:0,image:"",content:"",link:"",sort:0,status:"active"}),G={image:[{required:!0,message:"请上传Banner图片",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},C=g([]),k=g(!1),D=g(!1),E=ke(()=>o.id?"编辑Banner":"新增Banner"),u=P({content:"",status:""}),B=P({current:1,pageSize:10,total:0,showTotal:t=>`共 ${t} 条记录`,onChange:t=>{B.current=t}});Be(()=>{_()});const _=()=>x(this,null,function*(){b.value=!0;try{const t=yield me();if(t){const e=J(t),l=u.content||u.status?H(e,u):e;p.value=l,B.total=l.length,l.length>0&&Math.ceil(l.length/B.pageSize)<B.current&&(B.current=1)}b.value=!1}catch(t){console.error("获取Banner列表失败:",t),f.error("获取Banner列表失败"),b.value=!1}}),J=t=>!t||!t.list?[]:t.list.map(e=>({id:e.id||0,image:e.image||"",content:e.content||"",link:e.link||"",sort:e.sort||0,status:e.status||"active"})),H=(t,e)=>t.filter(l=>{let d=!0,z=!0;return e.content&&(d=l.content.includes(e.content)),e.status&&(z=l.status===e.status),d&&z}),Q=()=>{_()},W=()=>{Object.assign(u,{content:"",status:""}),_()},X=()=>{Z()},Z=()=>{c.value=!1,Object.assign(o,{id:0,image:"",content:"",link:"",sort:0,status:"active"}),C.value=[],k.value=!0},K=t=>{c.value=!0,Object.assign(o,{id:t.id,image:t.image,content:t.content,link:t.link,sort:t.sort,status:t.status}),C.value=t.image?[{uid:"-1",name:"banner.jpg",url:t.image}]:[],k.value=!0},Y=t=>x(this,null,function*(){try{yield pe(t.id),f.success("删除成功"),_()}catch(e){console.error("删除Banner失败:",e),f.error("删除Banner失败")}}),T=()=>{k.value=!1,c.value=!1},ee=()=>x(this,null,function*(){if(i.value)try{yield i.value.validate(),D.value=!0;const t={image:o.image,content:o.content,link:o.link,sort:o.sort,status:o.status};try{o.id?(yield ve(o.id,t),f.success("修改成功")):(yield ge(t),f.success("添加成功")),yield _(),k.value=!1,c.value=!1}catch(e){console.error("保存Banner失败:",e),f.error("保存Banner失败")}finally{D.value=!1}}catch(t){console.error("表单验证失败:",t)}}),te=t=>{const e=t.type==="image/jpeg"||t.type==="image/png";e||f.error("只能上传JPG/PNG格式的图片!");const l=t.size!==void 0&&t.size/1024/1024<2;return l||f.error("图片必须小于2MB!"),e&&l},ae=t=>{t.file.status!=="uploading"&&t.file.status==="done"&&(o.image=`https://qbylxb.cn${t.file.response.data.image.url}`)};return(t,e)=>(m(),w("div",null,[n(a($),{bordered:!1,class:"mb-20"},{default:s(()=>[n(a(N),{model:u,layout:"inline",class:"search-form",onSubmit:se(Q,["prevent"])},{default:s(()=>[n(a(v),{label:"内容描述"},{default:s(()=>[n(a(j),{value:u.content,"onUpdate:value":e[0]||(e[0]=l=>u.content=l),placeholder:"请输入Banner内容描述","allow-clear":""},null,8,["value"])]),_:1}),n(a(v),{label:"状态"},{default:s(()=>[n(a(le),{value:u.status,"onUpdate:value":e[1]||(e[1]=l=>u.status=l),placeholder:"请选择状态",style:{width:"140px"},"allow-clear":""},{default:s(()=>[n(a(M),{value:""},{default:s(()=>e[7]||(e[7]=[r("全部")])),_:1}),n(a(M),{value:"active"},{default:s(()=>e[8]||(e[8]=[r("启用")])),_:1}),n(a(M),{value:"inactive"},{default:s(()=>e[9]||(e[9]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),n(a(v),null,{default:s(()=>[n(a(L),null,{default:s(()=>[n(a(h),{type:"primary","html-type":"submit"},{default:s(()=>e[10]||(e[10]=[r("查询")])),_:1}),n(a(h),{onClick:W},{default:s(()=>e[11]||(e[11]=[r("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(a($),{bordered:!1},{default:s(()=>[y("div",he,[e[13]||(e[13]=y("div",{class:"table-title"},"Banner管理",-1)),y("div",Ce,[n(a(h),{type:"primary",onClick:X},{icon:s(()=>[n(a(q))]),default:s(()=>[e[12]||(e[12]=r(" 新增Banner "))]),_:1})])]),n(a(ye),{columns:S,"data-source":p.value,loading:b.value,pagination:B,"row-key":"id"},{bodyCell:s(({column:l,record:d})=>[l.key==="image"?(m(),w("div",xe,[d.image?(m(),w("img",{key:0,src:d.image,alt:"Banner图片"},null,8,Se)):(m(),w("div",Ue,"无"))])):O("",!0),l.key==="status"?(m(),F(a(oe),{key:1,color:d.status==="active"?"green":"orange"},{default:s(()=>[r(we(d.status==="active"?"启用":"禁用"),1)]),_:2},1032,["color"])):O("",!0),l.key==="action"?(m(),F(a(L),{key:2},{default:s(()=>[y("a",{onClick:()=>K(d)},"编辑",8,Ie),n(a(ie),{type:"vertical"}),n(a(_e),{title:"确定删除该Banner吗？",onConfirm:()=>Y(d),"ok-text":"确定","cancel-text":"取消"},{default:s(()=>e[14]||(e[14]=[y("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):O("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),n(a(ce),{visible:k.value,"onUpdate:visible":e[6]||(e[6]=l=>k.value=l),title:E.value,width:"600px","mask-closable":!1,onCancel:T},{footer:s(()=>[n(a(h),{onClick:T},{default:s(()=>e[18]||(e[18]=[r("取消")])),_:1}),n(a(h),{type:"primary",loading:D.value,onClick:ee},{default:s(()=>e[19]||(e[19]=[r(" 确定 ")])),_:1},8,["loading"])]),default:s(()=>[n(a(N),{ref_key:"formRef",ref:i,model:o,rules:G,"label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[n(a(v),{label:"图片",name:"image"},{default:s(()=>[n(a(re),{"file-list":C.value,"onUpdate:fileList":e[2]||(e[2]=l=>C.value=l),"list-type":"picture-card","show-upload-list":!1,action:A,headers:I,name:"image","before-upload":te,onChange:ae},{default:s(()=>[o.image?(m(),w("div",Ae,[y("img",{src:o.image,alt:"Banner图片",style:{width:"100%"}},null,8,De)])):(m(),w("div",Me,[n(a(q)),e[15]||(e[15]=y("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),n(a(v),{label:"内容描述",name:"content"},{default:s(()=>[n(a(j),{value:o.content,"onUpdate:value":e[3]||(e[3]=l=>o.content=l),placeholder:"请输入Banner内容描述"},null,8,["value"])]),_:1}),n(a(v),{label:"排序",name:"sort"},{default:s(()=>[n(a(ue),{value:o.sort,"onUpdate:value":e[4]||(e[4]=l=>o.sort=l),placeholder:"数字越小越靠前",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),n(a(v),{label:"状态",name:"status"},{default:s(()=>[n(a(de),{value:o.status,"onUpdate:value":e[5]||(e[5]=l=>o.status=l)},{default:s(()=>[n(a(V),{value:"active"},{default:s(()=>e[16]||(e[16]=[r("启用")])),_:1}),n(a(V),{value:"inactive"},{default:s(()=>e[17]||(e[17]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]))}}),Ve=fe(Pe,[["__scopeId","data-v-1ebf35f8"]]);export{Ve as default};
