var B=(C,I,w)=>new Promise((y,U)=>{var f=h=>{try{T(w.next(h))}catch(n){U(n)}},x=h=>{try{T(w.throw(h))}catch(n){U(n)}},T=h=>h.done?y(h.value):Promise.resolve(h.value).then(f,x);T((w=w.apply(C,I)).next())});import{I as ze,O as qe,ao as $e,b as u,P as pe,Q as Ve,R as b,U as K,W as J,X as F,S as ee,B as E,aC as Ne,Z as me,a0 as fe,a4 as N,a5 as He,a6 as ve,aD as Ge,a3 as te,a2 as Ye,a1 as ae,_ as Je}from"./bootstrap-CBNqZsYX.js";import{A as o,a2 as W,d as We,c as ge,I as le,r as A,o as Xe,a as P,b as g,z as s,g as t,B as m,G as oe,H as ye,l as H,t as _,f as p,e as S,J as Qe,F as G}from"../jse/index-index-Cfj6TwKU.js";import{i as Ze,w as Ke,x as et,y as tt,z as at,A as lt,B as ot,C as st,D as rt}from"./operation-C8U6V3qw.js";import{C as he,P as se}from"./index-oBtY6qbd.js";import{T as nt}from"./index-BwHvTSl1.js";import{P as it}from"./index-BeE9O9oY.js";var dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function we(C){for(var I=1;I<arguments.length;I++){var w=arguments[I]!=null?Object(arguments[I]):{},y=Object.keys(w);typeof Object.getOwnPropertySymbols=="function"&&(y=y.concat(Object.getOwnPropertySymbols(w).filter(function(U){return Object.getOwnPropertyDescriptor(w,U).enumerable}))),y.forEach(function(U){ut(C,U,w[U])})}return C}function ut(C,I,w){return I in C?Object.defineProperty(C,I,{value:w,enumerable:!0,configurable:!0,writable:!0}):C[I]=w,C}var Q=function(I,w){var y=we({},I,w.attrs);return o(ze,we({},y,{icon:dt}),null)};Q.displayName="UploadOutlined";Q.inheritAttrs=!1;var X={exports:{}},ct=X.exports,be;function pt(){return be||(be=1,function(C,I){(function(w,y){y()})(ct,function(){function w(n,d){return typeof d=="undefined"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}function y(n,d,r){var c=new XMLHttpRequest;c.open("GET",n),c.responseType="blob",c.onload=function(){h(c.response,d,r)},c.onerror=function(){console.error("could not download file")},c.send()}function U(n){var d=new XMLHttpRequest;d.open("HEAD",n,!1);try{d.send()}catch(r){}return 200<=d.status&&299>=d.status}function f(n){try{n.dispatchEvent(new MouseEvent("click"))}catch(r){var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(d)}}var x=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof W=="object"&&W.global===W?W:void 0,T=x.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),h=x.saveAs||(typeof window!="object"||window!==x?function(){}:"download"in HTMLAnchorElement.prototype&&!T?function(n,d,r){var c=x.URL||x.webkitURL,k=document.createElement("a");d=d||n.name||"download",k.download=d,k.rel="noopener",typeof n=="string"?(k.href=n,k.origin===location.origin?f(k):U(k.href)?y(n,d,r):f(k,k.target="_blank")):(k.href=c.createObjectURL(n),setTimeout(function(){c.revokeObjectURL(k.href)},4e4),setTimeout(function(){f(k)},0))}:"msSaveOrOpenBlob"in navigator?function(n,d,r){if(d=d||n.name||"download",typeof n!="string")navigator.msSaveOrOpenBlob(w(n,r),d);else if(U(n))y(n,d,r);else{var c=document.createElement("a");c.href=n,c.target="_blank",setTimeout(function(){f(c)})}}:function(n,d,r,c){if(c=c||open("","_blank"),c&&(c.document.title=c.document.body.innerText="downloading..."),typeof n=="string")return y(n,d,r);var k=n.type==="application/octet-stream",O=/constructor/i.test(x.HTMLElement)||x.safari,L=/CriOS\/[\d]+/.test(navigator.userAgent);if((L||k&&O||T)&&typeof FileReader!="undefined"){var M=new FileReader;M.onloadend=function(){var D=M.result;D=L?D:D.replace(/^data:[^;]*;/,"data:attachment/file;"),c?c.location.href=D:location=D,c=null},M.readAsDataURL(n)}else{var Y=x.URL||x.webkitURL,j=Y.createObjectURL(n);c?c.location=j:location.href=j,c=null,setTimeout(function(){Y.revokeObjectURL(j)},4e4)}});x.saveAs=h.saveAs=h,C.exports=h})}(X)),X.exports}var mt=pt();const ft={class:"table-header"},vt={class:"table-action"},gt={key:0,class:"product-cover"},yt=["src"],ht={key:1,class:"price"},wt={key:2,class:"price"},bt={key:3},kt={key:4,class:"price"},xt=["onClick"],Pt=["onClick"],It={key:1,class:"disabled-text"},Rt={key:0,class:"form-item-help text-warning"},Ct={key:0},Ut=["src"],At={key:1},_t={key:0},Et={key:1},St={class:"import-content"},Tt={class:"upload-area"},Ot=We({__name:"index",setup(C){const I=qe(),w=$e(),y=ge(()=>{var a;return((a=w.userInfo)==null?void 0:a.role)==="admin"}),U=[{title:"商品图片",dataIndex:"cover",key:"cover",width:100},{title:"商品名称",dataIndex:"name",key:"name"},{title:"价格",dataIndex:"price",key:"price",width:100},{title:"批发价",dataIndex:"wholesalePrice",key:"wholesalePrice",width:100},{title:"批发阈值",dataIndex:"wholesaleThreshold",key:"wholesaleThreshold",width:100},{title:"VIP价格",dataIndex:"vipPrice",key:"vipPrice",width:100},{title:"分类",dataIndex:"category",key:"category",customRender:({record:a})=>{var e;return((e=a.category)==null?void 0:e.name)||"-"}},{title:"库存",dataIndex:"stock",key:"stock",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"推荐",dataIndex:"isRecommended",key:"isRecommended",width:80},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150},{title:"操作",key:"action",width:200}],f=le({name:"",categoryId:null,status:null,isRecommended:null}),x=A([]),T=A([]),h=A(!1),n=le({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:a=>`共 ${a} 条数据`}),d=A(null),r=le({id:0,name:"",description:"",price:0,originalPrice:0,wholesalePrice:0,wholesaleThreshold:0,vipPrice:0,stock:0,categoryId:void 0,status:"off_sale",cover:"",images:[],isRecommended:!1,commissionAmount:""}),c={name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"}],wholesalePrice:[{required:!0,message:"请输入批发价格",trigger:"blur"}],wholesaleThreshold:[{required:!0,message:"请输入批发阈值",trigger:"blur"}],vipPrice:[{required:!0,message:"请输入VIP价格",trigger:"blur"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}],status:[{required:!0,message:"请选择商品状态",trigger:"change"}],stock:[{required:!0,message:"请输入库存数量",trigger:"blur"}],commissionAmount:[{validator:(a,e)=>{if(!e)return Promise.resolve();if(e.endsWith("%")){const i=parseFloat(e.slice(0,-1));return isNaN(i)||i<0||i>100?Promise.reject("佣金百分比应在0-100%之间"):Promise.resolve()}const l=parseFloat(e);return isNaN(l)||l<0?Promise.reject("佣金金额应为非负数或百分比格式（如：10 或 5%）"):Promise.resolve()},trigger:"blur"}]},k=A([]),O=A([]),L=A(!1),M=A(!1),Y=ge(()=>r.id?"编辑商品":"新增商品"),j=A(!1),D=A(!1),z=A([]),re={Authorization:`Bearer ${I.accessToken}`},ne="https://qbylxb.cn/upload/image",ke=a=>{if(a.file.status!=="uploading")if(a.file.status==="done"){const e=a.file.response;e.code===0?(r.cover=`https://qbylxb.cn${e.data.image.url}`,u.success("封面图上传成功")):u.error("封面图上传失败")}else a.file.status==="error"&&u.error("封面图上传失败")},xe=a=>{const e=[...a.fileList].slice(0,5);O.value=e,a.file.status==="done"?a.file.response.code===0&&(r.images=O.value.filter(i=>{var v,$,V;return((V=($=(v=i.response)==null?void 0:v.data)==null?void 0:$.image)==null?void 0:V.url)||i.url}).map(i=>{var v,$,V;return`https://qbylxb.cn${(V=($=(v=i.response)==null?void 0:v.data)==null?void 0:$.image)==null?void 0:V.url}`}),u.success("商品图片上传成功")):a.file.status==="error"&&u.error("商品图片上传失败")};Xe(()=>{Pe(),q()});const Pe=()=>B(this,null,function*(){try{const a=yield Ze();a&&a.list&&(x.value=Ie(a.list))}catch(a){console.error("获取分类选项失败:",a),u.error("获取分类选项失败")}}),Ie=a=>a.filter(e=>!e.parentId||e.parentId===0).map(e=>({id:e.id,name:e.name})),q=()=>B(this,null,function*(){h.value=!0;try{const a={keyword:f.name,categoryId:f.categoryId||void 0,status:f.status||void 0,isRecommended:f.isRecommended,pageNum:n.current,pageSize:n.pageSize},e=yield Ke(a);e&&(T.value=e.list,n.total=e.total),h.value=!1}catch(a){console.error("获取商品列表失败:",a),u.error("获取商品列表失败"),h.value=!1}}),Re=a=>{a.current&&(n.current=a.current),a.pageSize&&(n.pageSize=a.pageSize),q()},Ce=()=>{n.current=1,q()},Ue=()=>{Object.assign(f,{name:"",categoryId:null,status:null,isRecommended:null}),n.current=1,q()},Ae=()=>{Object.assign(r,{id:0,name:"",description:"",price:0,originalPrice:0,wholesalePrice:0,wholesaleThreshold:0,vipPrice:0,stock:0,categoryId:void 0,status:"off_sale",cover:"",images:[],isRecommended:!1,commissionAmount:""}),k.value=[],O.value=[],L.value=!0},_e=a=>B(this,null,function*(){try{h.value=!0;const e=yield et(a.id);if(h.value=!1,e){const l={id:e.id||0,name:e.name,description:e.description||"",price:e.price,originalPrice:e.originalPrice||0,wholesalePrice:e.wholesalePrice||0,wholesaleThreshold:e.wholesaleThreshold||0,vipPrice:e.vipPrice||0,stock:e.stock,categoryId:e.categoryId,status:e.status,cover:e.cover||"",images:e.images||[],isRecommended:e.isRecommended||!1,commissionAmount:e.commissionAmount||""};!y.value&&l.status==="on_sale"&&(l.status="off_sale",u.warning("非管理员用户编辑商品时将自动设置为下架状态")),Object.assign(r,l),k.value=e.cover?[{uid:"-1",name:"cover.jpg",url:e.cover}]:[],O.value=(e.images||[]).map((i,v)=>({uid:`-${v+1}`,name:`image-${v}.jpg`,url:i})),L.value=!0}}catch(e){h.value=!1,console.error("获取商品详情失败:",e),u.error("获取商品详情失败")}}),Ee=a=>B(this,null,function*(){try{yield tt(a.id),u.success("删除成功"),q()}catch(e){console.error("删除商品失败:",e),u.error("删除商品失败")}}),Se=a=>B(this,null,function*(){try{const e=a.status==="on_sale"?"off_sale":"on_sale";if(!y.value&&e==="on_sale"){u.error("只有管理员可以将商品设置为上架状态");return}yield at(a.id,e),u.success(e==="on_sale"?"商品已上架":"商品已下架"),q()}catch(e){console.error("修改商品状态失败:",e),u.error("修改商品状态失败")}}),ie=()=>{L.value=!1},Te=()=>B(this,null,function*(){if(d.value)try{if(yield d.value.validate(),!y.value&&r.status==="on_sale"){u.error("只有管理员可以将商品设置为上架状态");return}M.value=!0;const a={name:r.name,description:r.description,price:r.price,originalPrice:r.originalPrice,wholesalePrice:r.wholesalePrice||0,wholesaleThreshold:r.wholesaleThreshold||0,vipPrice:r.vipPrice||0,stock:r.stock,categoryId:r.categoryId,status:r.status,cover:r.cover,images:r.images,isRecommended:r.isRecommended,commissionAmount:r.commissionAmount};try{r.id?(yield lt(r.id,a),u.success("修改成功")):(yield ot(a),u.success("添加成功")),M.value=!1,L.value=!1,q()}catch(e){M.value=!1,console.error("保存商品失败:",e),u.error("保存商品失败")}}catch(a){console.error("表单验证失败:",a)}}),de=a=>{const e=a.type==="image/jpeg"||a.type==="image/png";e||u.error("只能上传JPG或PNG格式的图片!");let l=!0;return a.size!==void 0&&(l=a.size/1024/1024<2),l||u.error("图片大小不能超过2MB!"),e&&l},Oe=a=>a?Qe(a).format("YYYY-MM-DD HH:mm:ss"):"-",Le=()=>B(this,null,function*(){try{console.log("开始下载模板...");const a=yield st();if(console.log("收到Blob:",{size:a.size,type:a.type}),!a||!(a instanceof Blob)||a.size===0)throw new Error("下载的文件为空或格式不正确");const e="商品导入模板.xlsx";try{mt.saveAs(a,e),u.success("模板下载成功")}catch(l){console.error("file-saver 保存失败:",l);const i=window.URL.createObjectURL(a),v=document.createElement("a");v.href=i,v.download=e,v.style.display="none",document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(i),u.success("模板下载成功")}}catch(a){console.error("下载模板失败:",a),u.error(`下载模板失败: ${a instanceof Error?a.message:"未知错误"}`)}}),je=()=>{z.value=[],j.value=!0},De=a=>{const e=a.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||a.type==="application/vnd.ms-excel";e||u.error("只能上传Excel格式的文件!");const l=(a.size||0)/1024/1024<10;return l||u.error("文件大小不能超过10MB!"),e&&l},Be=a=>{z.value=[...a.fileList].slice(-1)},Fe=()=>B(this,null,function*(){var l,i,v,$,V;if(z.value.length===0){u.error("请选择要导入的Excel文件");return}const a=z.value[0];if(!(a!=null&&a.originFileObj)){u.error("文件格式错误");return}const e=a.originFileObj;try{D.value=!0,console.log("开始Excel导入，文件名:",e.name,"大小:",e.size);const R=yield rt(e);if(console.log("Excel导入响应:",R),R.success)u.success(`导入成功！成功导入 ${((l=R.data)==null?void 0:l.successCount)||0} 个商品`),j.value=!1,z.value=[],yield q();else throw new Error(R.message||"导入失败")}catch(R){if(console.error("Excel导入失败:",R),(v=(i=R.response)==null?void 0:i.data)!=null&&v.errors&&Array.isArray(R.response.data.errors)){const ce=R.response.data.errors,Z=R.response.data.totalErrors||ce.length;ae.error({title:`导入失败 (共${Z}个错误)`,content:G("div",{style:"max-height: 300px; overflow-y: auto;"},[G("div",{style:"margin-bottom: 10px; color: #666;"},"请修正以下错误后重新导入："),G("ol",{style:"margin: 0; padding-left: 20px;"},ce.slice(0,20).map(Me=>G("li",{style:"margin-bottom: 5px;"},Me))),Z>20?G("div",{style:"margin-top: 10px; color: #999;"},`还有 ${Z-20} 个错误未显示...`):null]),width:600,okText:"我知道了"})}else(V=($=R.response)==null?void 0:$.data)!=null&&V.message?u.error(R.response.data.message):R.message?u.error(R.message):u.error("Excel导入失败，请检查文件格式")}finally{D.value=!1}}),ue=()=>{z.value=[],j.value=!1};return(a,e)=>(g(),P("div",null,[o(t(he),{bordered:!1,class:"mb-20"},{default:s(()=>[o(t(pe),{model:f,layout:"inline",class:"search-form",onSubmit:Ve(Ce,["prevent"])},{default:s(()=>[o(t(b),{label:"商品名称"},{default:s(()=>[o(t(K),{value:f.name,"onUpdate:value":e[0]||(e[0]=l=>f.name=l),placeholder:"请输入商品名称","allow-clear":""},null,8,["value"])]),_:1}),o(t(b),{label:"商品分类"},{default:s(()=>[o(t(J),{value:f.categoryId,"onUpdate:value":e[1]||(e[1]=l=>f.categoryId=l),placeholder:"请选择商品分类",style:{width:"200px"},"allow-clear":""},{default:s(()=>[o(t(F),{value:null},{default:s(()=>e[21]||(e[21]=[m("全部")])),_:1}),(g(!0),P(oe,null,ye(x.value,l=>(g(),H(t(F),{key:l.id,value:l.id},{default:s(()=>[m(_(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(t(b),{label:"商品状态"},{default:s(()=>[o(t(J),{value:f.status,"onUpdate:value":e[2]||(e[2]=l=>f.status=l),placeholder:"请选择商品状态",style:{width:"200px"},"allow-clear":""},{default:s(()=>[o(t(F),{value:null},{default:s(()=>e[22]||(e[22]=[m("全部")])),_:1}),o(t(F),{value:"on_sale"},{default:s(()=>e[23]||(e[23]=[m("在售")])),_:1}),o(t(F),{value:"off_sale"},{default:s(()=>e[24]||(e[24]=[m("下架")])),_:1})]),_:1},8,["value"])]),_:1}),o(t(b),{label:"是否推荐"},{default:s(()=>[o(t(J),{value:f.isRecommended,"onUpdate:value":e[3]||(e[3]=l=>f.isRecommended=l),placeholder:"请选择是否推荐",style:{width:"200px"},"allow-clear":""},{default:s(()=>[o(t(F),{value:null},{default:s(()=>e[25]||(e[25]=[m("全部")])),_:1}),o(t(F),{value:"true"},{default:s(()=>e[26]||(e[26]=[m("推荐")])),_:1}),o(t(F),{value:"false"},{default:s(()=>e[27]||(e[27]=[m("不推荐")])),_:1})]),_:1},8,["value"])]),_:1}),o(t(b),null,{default:s(()=>[o(t(ee),null,{default:s(()=>[o(t(E),{type:"primary","html-type":"submit"},{default:s(()=>e[28]||(e[28]=[m("查询")])),_:1}),o(t(E),{onClick:Ue},{default:s(()=>e[29]||(e[29]=[m("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(t(he),{bordered:!1},{default:s(()=>[p("div",ft,[e[33]||(e[33]=p("div",{class:"table-title"},"商品列表",-1)),p("div",vt,[o(t(ee),null,{default:s(()=>[o(t(E),{onClick:Le},{icon:s(()=>[o(t(Ne))]),default:s(()=>[e[30]||(e[30]=m(" 下载模板 "))]),_:1}),o(t(E),{onClick:je},{icon:s(()=>[o(t(Q))]),default:s(()=>[e[31]||(e[31]=m(" Excel导入 "))]),_:1}),o(t(E),{type:"primary",onClick:Ae},{icon:s(()=>[o(t(se))]),default:s(()=>[e[32]||(e[32]=m(" 新增商品 "))]),_:1})]),_:1})])]),o(t(nt),{columns:U,"data-source":T.value,loading:h.value,pagination:n,onChange:Re,"row-key":"id"},{bodyCell:s(({column:l,record:i})=>[l.key==="cover"?(g(),P("div",gt,[p("img",{src:i.cover||"/images/default-product.png",alt:"商品图片"},null,8,yt)])):S("",!0),l.key==="price"?(g(),P("span",ht,"¥"+_(i.price),1)):S("",!0),l.key==="wholesalePrice"?(g(),P("span",wt,"¥"+_(i.wholesalePrice),1)):S("",!0),l.key==="wholesaleThreshold"?(g(),P("span",bt,_(i.wholesaleThreshold||"-")+" "+_(i.wholesaleThreshold?"件":""),1)):S("",!0),l.key==="vipPrice"?(g(),P("span",kt,"¥"+_(i.vipPrice),1)):S("",!0),l.key==="status"?(g(),H(t(me),{key:5,color:i.status==="on_sale"?"green":"orange"},{default:s(()=>[m(_(i.status==="on_sale"?"在售":"下架"),1)]),_:2},1032,["color"])):S("",!0),l.key==="isRecommended"?(g(),H(t(me),{key:6,color:i.isRecommended?"blue":"default"},{default:s(()=>[m(_(i.isRecommended?"是":"否"),1)]),_:2},1032,["color"])):S("",!0),l.key==="createdAt"?(g(),P(oe,{key:7},[m(_(Oe(i.createdAt)),1)],64)):S("",!0),l.key==="action"?(g(),H(t(ee),{key:8},{default:s(()=>[p("a",{onClick:v=>_e(i)},"编辑",8,xt),o(t(fe),{type:"vertical"}),o(t(it),{title:"确定删除该商品吗？",onConfirm:v=>Ee(i),"ok-text":"确定","cancel-text":"取消"},{default:s(()=>e[34]||(e[34]=[p("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"]),o(t(fe),{type:"vertical"}),y.value||i.status==="on_sale"?(g(),P("a",{key:0,onClick:v=>Se(i)},_(i.status==="on_sale"?"下架":"上架"),9,Pt)):(g(),P("span",It," 上架（需管理员权限） "))]),_:2},1024)):S("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),o(t(ae),{visible:L.value,"onUpdate:visible":e[18]||(e[18]=l=>L.value=l),title:Y.value,width:"800px","mask-closable":!1,onCancel:ie},{footer:s(()=>[o(t(E),{onClick:ie},{default:s(()=>e[43]||(e[43]=[m("取消")])),_:1}),o(t(E),{type:"primary",loading:M.value,onClick:Te},{default:s(()=>e[44]||(e[44]=[m(" 确定 ")])),_:1},8,["loading"])]),default:s(()=>[o(t(pe),{ref_key:"formRef",ref:d,model:r,rules:c,"label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[o(t(b),{label:"商品名称",name:"name"},{default:s(()=>[o(t(K),{value:r.name,"onUpdate:value":e[4]||(e[4]=l=>r.name=l),placeholder:"请输入商品名称"},null,8,["value"])]),_:1}),o(t(b),{label:"商品分类",name:"categoryId"},{default:s(()=>[o(t(J),{value:r.categoryId,"onUpdate:value":e[5]||(e[5]=l=>r.categoryId=l),placeholder:"请选择商品分类"},{default:s(()=>[(g(!0),P(oe,null,ye(x.value,l=>(g(),H(t(F),{key:l.id,value:l.id},{default:s(()=>[m(_(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(t(b),{label:"商品价格",name:"price"},{default:s(()=>[o(t(N),{value:r.price,"onUpdate:value":e[6]||(e[6]=l=>r.price=l),placeholder:"请输入商品价格",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1}),o(t(b),{label:"原价",name:"originalPrice"},{default:s(()=>[o(t(N),{value:r.originalPrice,"onUpdate:value":e[7]||(e[7]=l=>r.originalPrice=l),placeholder:"请输入商品原价",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1}),o(t(b),{label:"批发价格",name:"wholesalePrice",required:""},{default:s(()=>[o(t(N),{value:r.wholesalePrice,"onUpdate:value":e[8]||(e[8]=l=>r.wholesalePrice=l),placeholder:"请输入批发价格",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1}),o(t(b),{label:"批发阈值",name:"wholesaleThreshold",required:""},{default:s(()=>[o(t(N),{value:r.wholesaleThreshold,"onUpdate:value":e[9]||(e[9]=l=>r.wholesaleThreshold=l),placeholder:"请输入批发阈值（件）",min:0,style:{width:"100%"}},null,8,["value"]),e[35]||(e[35]=p("div",{class:"form-item-help"},"达到此数量可享受批发价",-1))]),_:1}),o(t(b),{label:"VIP价格",name:"vipPrice",required:""},{default:s(()=>[o(t(N),{value:r.vipPrice,"onUpdate:value":e[10]||(e[10]=l=>r.vipPrice=l),placeholder:"请输入VIP价格",min:0,precision:2,style:{width:"100%"}},null,8,["value"]),e[36]||(e[36]=p("div",{class:"form-item-help"},"VIP会员专享价格",-1))]),_:1}),o(t(b),{label:"佣金设置",name:"commissionAmount"},{default:s(()=>[o(t(K),{value:r.commissionAmount,"onUpdate:value":e[11]||(e[11]=l=>r.commissionAmount=l),placeholder:"请输入佣金（如：10 或 5%）",style:{width:"100%"}},null,8,["value"]),e[37]||(e[37]=p("div",{class:"form-item-help"}," 支持两种格式：固定金额（如：10）或百分比（如：5%） ",-1))]),_:1}),o(t(b),{label:"库存",name:"stock"},{default:s(()=>[o(t(N),{value:r.stock,"onUpdate:value":e[12]||(e[12]=l=>r.stock=l),placeholder:"请输入库存数量",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),o(t(b),{label:"状态",name:"status"},{default:s(()=>[o(t(He),{value:r.status,"onUpdate:value":e[13]||(e[13]=l=>r.status=l)},{default:s(()=>[o(t(ve),{value:"on_sale",disabled:!y.value},{default:s(()=>e[38]||(e[38]=[m("上架")])),_:1},8,["disabled"]),o(t(ve),{value:"off_sale"},{default:s(()=>e[39]||(e[39]=[m("下架")])),_:1})]),_:1},8,["value"]),y.value?S("",!0):(g(),P("div",Rt," 提示：只有管理员可以将商品设置为上架状态 "))]),_:1}),o(t(b),{label:"是否推荐",name:"isRecommended"},{default:s(()=>[o(t(Ge),{checked:r.isRecommended,"onUpdate:checked":e[14]||(e[14]=l=>r.isRecommended=l),"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:1}),o(t(b),{label:"封面图",name:"cover"},{default:s(()=>[o(t(te),{"file-list":k.value,"onUpdate:fileList":e[15]||(e[15]=l=>k.value=l),"list-type":"picture-card","show-upload-list":!1,action:ne,headers:re,name:"image","before-upload":de,onChange:ke},{default:s(()=>[r.cover?(g(),P("div",Ct,[p("img",{src:r.cover,alt:"商品封面",style:{width:"100%"}},null,8,Ut)])):(g(),P("div",At,[o(t(se)),e[40]||(e[40]=p("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),o(t(b),{label:"商品图片",name:"images"},{default:s(()=>[o(t(te),{"file-list":O.value,"onUpdate:fileList":e[16]||(e[16]=l=>O.value=l),"list-type":"picture-card",action:ne,headers:re,name:"image","before-upload":de,onChange:xe},{default:s(()=>[O.value.length>=5?(g(),P("div",_t,e[41]||(e[41]=[p("div",null,"最多上传5张",-1)]))):(g(),P("div",Et,[o(t(se)),e[42]||(e[42]=p("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),o(t(b),{label:"商品描述",name:"description"},{default:s(()=>[o(t(Ye),{value:r.description,"onUpdate:value":e[17]||(e[17]=l=>r.description=l),placeholder:"请输入商品描述",rows:4},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),o(t(ae),{visible:j.value,"onUpdate:visible":e[20]||(e[20]=l=>j.value=l),title:"Excel批量导入商品",width:"600px","mask-closable":!1,onCancel:ue},{footer:s(()=>[o(t(E),{onClick:ue},{default:s(()=>e[48]||(e[48]=[m("取消")])),_:1}),o(t(E),{type:"primary",loading:D.value,onClick:Fe},{default:s(()=>e[49]||(e[49]=[m(" 确认导入 ")])),_:1},8,["loading"])]),default:s(()=>[p("div",St,[e[47]||(e[47]=p("div",{class:"import-tips"},[p("h4",null,"导入说明："),p("ul",null,[p("li",null,"请先下载模板文件，按照模板格式填写商品信息"),p("li",null,"必填字段：商品名称、商品价格、批发价格、批发阈值、VIP价格、库存数量、分类ID、商品状态"),p("li",null,"商品状态只能填写：on_sale（上架）或 off_sale（下架）"),p("li",null,"是否推荐只能填写：true 或 false"),p("li",null,"佣金设置支持两种格式：固定金额（如：10）或百分比（如：5%）"),p("li",null,"分类ID请参考模板中的分类参考表"),p("li",null,"多张商品图片URL请用英文逗号分隔"),p("li",null,"文件大小不能超过10MB")])],-1)),p("div",Tt,[o(t(te),{"file-list":z.value,"onUpdate:fileList":e[19]||(e[19]=l=>z.value=l),"before-upload":De,"max-count":1,accept:".xlsx,.xls",onChange:Be},{default:s(()=>[o(t(E),null,{icon:s(()=>[o(t(Q))]),default:s(()=>[e[45]||(e[45]=m(" 选择Excel文件 "))]),_:1})]),_:1},8,["file-list"]),e[46]||(e[46]=p("div",{class:"upload-tip"},"支持扩展名：.xlsx .xls",-1))])])]),_:1},8,["visible"])]))}}),qt=Je(Ot,[["__scopeId","data-v-bd21dcbc"]]);export{qt as default};
