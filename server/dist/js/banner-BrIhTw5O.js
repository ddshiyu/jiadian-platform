var S=(L,D,f)=>new Promise((y,I)=>{var M=l=>{try{m(f.next(l))}catch(h){I(h)}},k=l=>{try{m(f.throw(l))}catch(h){I(h)}},m=l=>l.done?y(l.value):Promise.resolve(l.value).then(M,k);m((f=f.apply(L,D)).next())});import{cd as ae,o as d,aD as R,aE as ne,aF as p,aI as j,aG as se,aH as A,n as z,B as _,aJ as le,aK as oe,ce as ie,ca as re,cf as ue,bC as V,aL as de,aM as ce}from"./bootstrap-DQlkkZAY.js";import{m as fe,T as me,n as pe,o as ve,p as ge}from"./operation-Cao-9zmS.js";import{C as F,P as G}from"./index-CrE2fLll.js";import{a3 as ye,P as v,T as P,J as ke,ao as be,a4 as w,a5 as c,x as n,ah as s,aa as a,at as i,aK as g,aB as T,ae as J,au as Be}from"../jse/index-index-_HsMvMo5.js";import{P as we}from"./index-CQs6e48e.js";import"./Dropdown-BE9qtqDz.js";import"./index-BAe2oAwF.js";const he={class:"table-header"},Ce={class:"table-action"},_e={key:0,class:"banner-image"},xe=["src"],Se={key:1,class:"no-image"},De=["onClick"],Ie={key:0},Me=["src"],Ue={key:1},Ae=ye({__name:"banner",setup(L){const D=[{title:"图片",dataIndex:"image",key:"image",width:150},{title:"内容描述",dataIndex:"content",key:"content",width:"30%"},{title:"排序",dataIndex:"sort",key:"sort",width:80},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"操作",key:"action",width:150}],f=v([]),y=v(!1),M={Authorization:`Bearer ${ae().accessToken}`},k=v(!1),m=v(null),l=P({id:0,image:"",content:"",link:"",sort:0,status:"active"}),h={image:[{required:!0,message:"请上传Banner图片",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},x=v([]),b=v(!1),U=v(!1),$=ke(()=>l.id?"编辑Banner":"新增Banner"),r=P({content:"",status:""}),B=P({current:1,pageSize:10,total:0,showTotal:t=>`共 ${t} 条记录`,onChange:t=>{B.current=t}});be(()=>{C()});const C=()=>S(this,null,function*(){y.value=!0;try{const t=yield fe();if(t){const e=E(t),o=r.content||r.status?q(e,r):e;f.value=o,B.total=o.length,o.length>0&&Math.ceil(o.length/B.pageSize)<B.current&&(B.current=1)}y.value=!1}catch(t){console.error("获取Banner列表失败:",t),d.error("获取Banner列表失败"),y.value=!1}}),E=t=>!t||!t.list?[]:t.list.map(e=>({id:e.id||0,image:e.image||"",content:e.content||"",link:e.link||"",sort:e.sort||0,status:e.status||"active"})),q=(t,e)=>t.filter(o=>{let u=!0,O=!0;return e.content&&(u=o.content.includes(e.content)),e.status&&(O=o.status===e.status),u&&O}),H=()=>{C()},K=()=>{Object.assign(r,{content:"",status:""}),C()},Q=()=>{W()},W=()=>{k.value=!1,Object.assign(l,{id:0,image:"",content:"",link:"",sort:0,status:"active"}),x.value=[],b.value=!0},X=t=>{k.value=!0,Object.assign(l,{id:t.id,image:t.image,content:t.content,link:t.link,sort:t.sort,status:t.status}),x.value=t.image?[{uid:"-1",name:"banner.jpg",url:t.image}]:[],b.value=!0},Y=t=>S(this,null,function*(){try{yield pe(t.id),d.success("删除成功"),C()}catch(e){console.error("删除Banner失败:",e),d.error("删除Banner失败")}}),N=()=>{b.value=!1,k.value=!1},Z=()=>S(this,null,function*(){if(m.value)try{yield m.value.validate(),U.value=!0;const t={image:l.image,content:l.content,link:l.link,sort:l.sort,status:l.status};try{l.id?(yield ve(l.id,t),d.success("修改成功")):(yield ge(t),d.success("添加成功")),yield C(),b.value=!1,k.value=!1}catch(e){console.error("保存Banner失败:",e),d.error("保存Banner失败")}finally{U.value=!1}}catch(t){console.error("表单验证失败:",t)}}),ee=t=>{const e=t.type==="image/jpeg"||t.type==="image/png";e||d.error("只能上传JPG/PNG格式的图片!");const o=t.size!==void 0&&t.size/1024/1024<2;return o||d.error("图片必须小于2MB!"),e&&o},te=t=>{t.file.status!=="uploading"&&t.file.status==="done"&&(l.image=`http://8.140.251.91${t.file.response.data.image.url}`)};return(t,e)=>(c(),w("div",null,[n(a(F),{bordered:!1,class:"mb-20"},{default:s(()=>[n(a(R),{model:r,layout:"inline",class:"search-form",onSubmit:ne(H,["prevent"])},{default:s(()=>[n(a(p),{label:"内容描述"},{default:s(()=>[n(a(j),{value:r.content,"onUpdate:value":e[0]||(e[0]=o=>r.content=o),placeholder:"请输入Banner内容描述","allow-clear":""},null,8,["value"])]),_:1}),n(a(p),{label:"状态"},{default:s(()=>[n(a(se),{value:r.status,"onUpdate:value":e[1]||(e[1]=o=>r.status=o),placeholder:"请选择状态",style:{width:"140px"},"allow-clear":""},{default:s(()=>[n(a(A),{value:""},{default:s(()=>e[7]||(e[7]=[i("全部")])),_:1}),n(a(A),{value:"active"},{default:s(()=>e[8]||(e[8]=[i("启用")])),_:1}),n(a(A),{value:"inactive"},{default:s(()=>e[9]||(e[9]=[i("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),n(a(p),null,{default:s(()=>[n(a(z),null,{default:s(()=>[n(a(_),{type:"primary","html-type":"submit"},{default:s(()=>e[10]||(e[10]=[i("查询")])),_:1}),n(a(_),{onClick:K},{default:s(()=>e[11]||(e[11]=[i("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(a(F),{bordered:!1},{default:s(()=>[g("div",he,[e[13]||(e[13]=g("div",{class:"table-title"},"Banner管理",-1)),g("div",Ce,[n(a(_),{type:"primary",onClick:Q},{icon:s(()=>[n(a(G))]),default:s(()=>[e[12]||(e[12]=i(" 新增Banner "))]),_:1})])]),n(a(me),{columns:D,"data-source":f.value,loading:y.value,pagination:B,"row-key":"id"},{bodyCell:s(({column:o,record:u})=>[o.key==="image"?(c(),w("div",_e,[u.image?(c(),w("img",{key:0,src:u.image,alt:"Banner图片"},null,8,xe)):(c(),w("div",Se,"无"))])):T("",!0),o.key==="status"?(c(),J(a(le),{key:1,color:u.status==="active"?"green":"orange"},{default:s(()=>[i(Be(u.status==="active"?"启用":"禁用"),1)]),_:2},1032,["color"])):T("",!0),o.key==="action"?(c(),J(a(z),{key:2},{default:s(()=>[g("a",{onClick:()=>X(u)},"编辑",8,De),n(a(oe),{type:"vertical"}),n(a(we),{title:"确定删除该Banner吗？",onConfirm:()=>Y(u),"ok-text":"确定","cancel-text":"取消"},{default:s(()=>e[14]||(e[14]=[g("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):T("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),n(a(de),{visible:b.value,"onUpdate:visible":e[6]||(e[6]=o=>b.value=o),title:$.value,width:"600px","mask-closable":!1,onCancel:N},{footer:s(()=>[n(a(_),{onClick:N},{default:s(()=>e[18]||(e[18]=[i("取消")])),_:1}),n(a(_),{type:"primary",loading:U.value,onClick:Z},{default:s(()=>e[19]||(e[19]=[i(" 确定 ")])),_:1},8,["loading"])]),default:s(()=>[n(a(R),{ref_key:"formRef",ref:m,model:l,rules:h,"label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[n(a(p),{label:"图片",name:"image"},{default:s(()=>[n(a(ie),{"file-list":x.value,"onUpdate:fileList":e[2]||(e[2]=o=>x.value=o),"list-type":"picture-card","show-upload-list":!1,action:"http://8.140.251.91/upload/image",headers:M,name:"image","before-upload":ee,onChange:te},{default:s(()=>[l.image?(c(),w("div",Ie,[g("img",{src:l.image,alt:"Banner图片",style:{width:"100%"}},null,8,Me)])):(c(),w("div",Ue,[n(a(G)),e[15]||(e[15]=g("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),n(a(p),{label:"内容描述",name:"content"},{default:s(()=>[n(a(j),{value:l.content,"onUpdate:value":e[3]||(e[3]=o=>l.content=o),placeholder:"请输入Banner内容描述"},null,8,["value"])]),_:1}),n(a(p),{label:"排序",name:"sort"},{default:s(()=>[n(a(re),{value:l.sort,"onUpdate:value":e[4]||(e[4]=o=>l.sort=o),placeholder:"数字越小越靠前",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),n(a(p),{label:"状态",name:"status"},{default:s(()=>[n(a(ue),{value:l.status,"onUpdate:value":e[5]||(e[5]=o=>l.status=o)},{default:s(()=>[n(a(V),{value:"active"},{default:s(()=>e[16]||(e[16]=[i("启用")])),_:1}),n(a(V),{value:"inactive"},{default:s(()=>e[17]||(e[17]=[i("禁用")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]))}}),Ve=ce(Ae,[["__scopeId","data-v-dfcfa940"]]);export{Ve as default};
