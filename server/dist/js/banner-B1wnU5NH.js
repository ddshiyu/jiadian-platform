var x=(T,S,p)=>new Promise((b,I)=>{var U=i=>{try{c(p.next(i))}catch(o){I(o)}},A=i=>{try{c(p.throw(i))}catch(o){I(o)}},c=i=>i.done?b(i.value):Promise.resolve(i.value).then(U,A);c((p=p.apply(T,S)).next())});import{O as ne,b as f,P as j,Q as se,R as v,U as L,W as le,X as M,S as V,B as h,Z as oe,a0 as ie,a3 as re,a4 as ue,ac as de,ad as $,a1 as ce,_ as fe}from"./bootstrap-Be81Tyra.js";import{e as me,f as pe,u as ve,i as ge}from"./operation-Dt6NDkf8.js";import{C as q,P as F}from"./index-thOj1ETX.js";import{I as ye}from"./index-DQxeR_h_.js";import{T as be}from"./index-CIITXkHm.js";import{d as ke,r as g,I as P,c as Be,o as we,a as C,b as m,A as n,z as s,g as a,B as r,f as y,e as O,l as R,t as he}from"../jse/index-index-IK0MbYCQ.js";import{P as Ce}from"./index-DmoQSauz.js";const _e={class:"table-header"},xe={class:"table-action"},Se={key:0,class:"banner-image"},Ie={key:1,class:"no-image"},Ue=["onClick"],Ae={key:0},De=["src"],Me={key:1},Pe=ke({__name:"banner",setup(T){const S=[{title:"图片",dataIndex:"image",key:"image",width:150},{title:"内容描述",dataIndex:"content",key:"content",width:"30%"},{title:"排序",dataIndex:"sort",key:"sort",width:80},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"操作",key:"action",width:150}],p=g([]),b=g(!1),U={Authorization:`Bearer ${ne().accessToken}`},A="https://qbylxb.cn/upload/image",c=g(!1),i=g(null),o=P({id:0,image:"",content:"",link:"",sort:0,status:"active"}),G={image:[{required:!0,message:"请上传Banner图片",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},_=g([]),k=g(!1),D=g(!1),E=Be(()=>o.id?"编辑Banner":"新增Banner"),u=P({content:"",status:""}),B=P({current:1,pageSize:10,total:0,showTotal:t=>`共 ${t} 条记录`,onChange:t=>{B.current=t}});we(()=>{w()});const w=()=>x(this,null,function*(){b.value=!0;try{const t=yield me();if(t){const e=J(t),l=u.content||u.status?H(e,u):e;p.value=l,B.total=l.length,l.length>0&&Math.ceil(l.length/B.pageSize)<B.current&&(B.current=1)}b.value=!1}catch(t){console.error("获取Banner列表失败:",t),f.error("获取Banner列表失败"),b.value=!1}}),J=t=>!t||!t.list?[]:t.list.map(e=>({id:e.id||0,image:e.image||"",content:e.content||"",link:e.link||"",sort:e.sort||0,status:e.status||"active"})),H=(t,e)=>t.filter(l=>{let d=!0,N=!0;return e.content&&(d=l.content.includes(e.content)),e.status&&(N=l.status===e.status),d&&N}),Q=()=>{w()},W=()=>{Object.assign(u,{content:"",status:""}),w()},X=()=>{Z()},Z=()=>{c.value=!1,Object.assign(o,{id:0,image:"",content:"",link:"",sort:0,status:"active"}),_.value=[],k.value=!0},K=t=>{c.value=!0,Object.assign(o,{id:t.id,image:t.image,content:t.content,link:t.link,sort:t.sort,status:t.status}),_.value=t.image?[{uid:"-1",name:"banner.jpg",url:t.image}]:[],k.value=!0},Y=t=>x(this,null,function*(){try{yield pe(t.id),f.success("删除成功"),w()}catch(e){console.error("删除Banner失败:",e),f.error("删除Banner失败")}}),z=()=>{k.value=!1,c.value=!1},ee=()=>x(this,null,function*(){if(i.value)try{yield i.value.validate(),D.value=!0;const t={image:o.image,content:o.content,link:o.link,sort:o.sort,status:o.status};try{o.id?(yield ve(o.id,t),f.success("修改成功")):(yield ge(t),f.success("添加成功")),yield w(),k.value=!1,c.value=!1}catch(e){console.error("保存Banner失败:",e),f.error("保存Banner失败")}finally{D.value=!1}}catch(t){console.error("表单验证失败:",t)}}),te=t=>{const e=t.type==="image/jpeg"||t.type==="image/png";e||f.error("只能上传JPG/PNG格式的图片!");const l=t.size!==void 0&&t.size/1024/1024<2;return l||f.error("图片必须小于2MB!"),e&&l},ae=t=>{t.file.status!=="uploading"&&t.file.status==="done"&&(o.image=`https://qbylxb.cn${t.file.response.data.image.url}`)};return(t,e)=>(m(),C("div",null,[n(a(q),{bordered:!1,class:"mb-20"},{default:s(()=>[n(a(j),{model:u,layout:"inline",class:"search-form",onSubmit:se(Q,["prevent"])},{default:s(()=>[n(a(v),{label:"内容描述"},{default:s(()=>[n(a(L),{value:u.content,"onUpdate:value":e[0]||(e[0]=l=>u.content=l),placeholder:"请输入Banner内容描述","allow-clear":""},null,8,["value"])]),_:1}),n(a(v),{label:"状态"},{default:s(()=>[n(a(le),{value:u.status,"onUpdate:value":e[1]||(e[1]=l=>u.status=l),placeholder:"请选择状态",style:{width:"140px"},"allow-clear":""},{default:s(()=>[n(a(M),{value:""},{default:s(()=>e[7]||(e[7]=[r("全部")])),_:1}),n(a(M),{value:"active"},{default:s(()=>e[8]||(e[8]=[r("启用")])),_:1}),n(a(M),{value:"inactive"},{default:s(()=>e[9]||(e[9]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1}),n(a(v),null,{default:s(()=>[n(a(V),null,{default:s(()=>[n(a(h),{type:"primary","html-type":"submit"},{default:s(()=>e[10]||(e[10]=[r("查询")])),_:1}),n(a(h),{onClick:W},{default:s(()=>e[11]||(e[11]=[r("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(a(q),{bordered:!1},{default:s(()=>[y("div",_e,[e[13]||(e[13]=y("div",{class:"table-title"},"Banner管理",-1)),y("div",xe,[n(a(h),{type:"primary",onClick:X},{icon:s(()=>[n(a(F))]),default:s(()=>[e[12]||(e[12]=r(" 新增Banner "))]),_:1})])]),n(a(be),{columns:S,"data-source":p.value,loading:b.value,pagination:B,"row-key":"id"},{bodyCell:s(({column:l,record:d})=>[l.key==="image"?(m(),C("div",Se,[d.image?(m(),R(a(ye),{key:0,src:d.image,alt:"Banner图片",preview:!0},null,8,["src"])):(m(),C("div",Ie,"无"))])):O("",!0),l.key==="status"?(m(),R(a(oe),{key:1,color:d.status==="active"?"green":"orange"},{default:s(()=>[r(he(d.status==="active"?"启用":"禁用"),1)]),_:2},1032,["color"])):O("",!0),l.key==="action"?(m(),R(a(V),{key:2},{default:s(()=>[y("a",{onClick:()=>K(d)},"编辑",8,Ue),n(a(ie),{type:"vertical"}),n(a(Ce),{title:"确定删除该Banner吗？",onConfirm:()=>Y(d),"ok-text":"确定","cancel-text":"取消"},{default:s(()=>e[14]||(e[14]=[y("a",{class:"danger-link"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):O("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),n(a(ce),{visible:k.value,"onUpdate:visible":e[6]||(e[6]=l=>k.value=l),title:E.value,width:"600px","mask-closable":!1,onCancel:z},{footer:s(()=>[n(a(h),{onClick:z},{default:s(()=>e[18]||(e[18]=[r("取消")])),_:1}),n(a(h),{type:"primary",loading:D.value,onClick:ee},{default:s(()=>e[19]||(e[19]=[r(" 确定 ")])),_:1},8,["loading"])]),default:s(()=>[n(a(j),{ref_key:"formRef",ref:i,model:o,rules:G,"label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[n(a(v),{label:"图片",name:"image"},{default:s(()=>[n(a(re),{"file-list":_.value,"onUpdate:fileList":e[2]||(e[2]=l=>_.value=l),"list-type":"picture-card","show-upload-list":!1,action:A,headers:U,name:"image","before-upload":te,onChange:ae},{default:s(()=>[o.image?(m(),C("div",Ae,[y("img",{src:o.image,alt:"Banner图片",style:{width:"100%"}},null,8,De)])):(m(),C("div",Me,[n(a(F)),e[15]||(e[15]=y("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),n(a(v),{label:"内容描述",name:"content"},{default:s(()=>[n(a(L),{value:o.content,"onUpdate:value":e[3]||(e[3]=l=>o.content=l),placeholder:"请输入Banner内容描述"},null,8,["value"])]),_:1}),n(a(v),{label:"排序",name:"sort"},{default:s(()=>[n(a(ue),{value:o.sort,"onUpdate:value":e[4]||(e[4]=l=>o.sort=l),placeholder:"数字越小越靠前",min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),n(a(v),{label:"状态",name:"status"},{default:s(()=>[n(a(de),{value:o.status,"onUpdate:value":e[5]||(e[5]=l=>o.status=l)},{default:s(()=>[n(a($),{value:"active"},{default:s(()=>e[16]||(e[16]=[r("启用")])),_:1}),n(a($),{value:"inactive"},{default:s(()=>e[17]||(e[17]=[r("禁用")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]))}}),$e=fe(Pe,[["__scopeId","data-v-124117e5"]]);export{$e as default};
