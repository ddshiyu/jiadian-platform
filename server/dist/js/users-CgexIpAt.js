var S=(G,O,U)=>new Promise((Y,h)=>{var v=u=>{try{f(U.next(u))}catch(y){h(y)}},g=u=>{try{f(U.throw(u))}catch(y){h(y)}},f=u=>u.done?Y(u.value):Promise.resolve(u.value).then(v,g);f((U=U.apply(G,O)).next())});import{N as Ce,P as H,Q as Ae,R as k,U as I,W as ee,X as T,S as L,B as D,Y as xe,Z as M,a0 as ae,a1 as j,a5 as Ue,b as w,a6 as Re,a7 as Pe,a8 as Se,a9 as Ie,aa as Ye,ab as Fe,_ as Te}from"./bootstrap-BMeI61GG.js";import{d as Me,r as b,I as q,o as $e,a as c,b as m,A as t,z as l,g as a,B as n,f as i,l as z,e as C,t as p,G as B,H as te,J as Ne}from"../jse/index-index-Du3oEA_J.js";import{C as J,T as qe,a as le}from"./index-DtIEgUNp.js";import{R as ze}from"./ReloadOutlined-CXHPlJFU.js";import{T as se}from"./index-CxgiDpDe.js";import{P as Be}from"./index-CXqpqzVa.js";import{D as oe,a as _}from"./index-C-HoIozV.js";import{I as Oe}from"./index-CUfuZ4aN.js";const Ve={class:"table-header"},Ee={class:"table-action"},Qe={key:0},He={key:0,class:"mt-20"},Le={key:0},je={class:"payment-section"},Je={key:0,class:"qr-codes-grid"},Ge={class:"qr-code-header"},We={class:"qr-code-name"},Xe={class:"qr-code-image"},Ze={key:1,class:"empty-payment"},Ke={class:"payment-section"},ea={key:0},aa={class:"bank-card-info"},ta={class:"bank-info"},la={class:"bank-name"},sa={class:"card-info"},oa={class:"card-number"},ra={class:"account-info"},na={class:"account-name"},da={key:1,class:"empty-payment"},ua={key:1,class:"empty-payment"},ia=Me({__name:"users",setup(G){const{RangePicker:O}=Ce,U=[{title:"用户名",dataIndex:"username",key:"username"},{title:"手机号",dataIndex:"phone",key:"phone"},{title:"角色",dataIndex:"role",key:"role"},{title:"状态",dataIndex:"status",key:"status"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt"},{title:"操作",key:"action",fixed:"right",width:300}],Y=b([]),h=b(!1),v=b(null),g=b(null),f=q({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条记录`}),u=q({keyword:"",role:"",startDate:"",endDate:""}),y=b(void 0),V=b(!1),R=b(!1),r=q({id:0,username:"",password:"",name:"",phone:"",role:"user"}),E=b(null),re={username:[{required:!0,message:"请输入用户名",trigger:"blur",type:"string"}],password:[{required:!0,message:"请输入密码",trigger:"blur",type:"string"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur",type:"string"}]},F=b(!1),A=q({id:0,password:""}),Q=b(null),ne={password:[{required:!0,message:"请输入新密码",trigger:"blur",type:"string"},{min:6,message:"密码长度至少6位",trigger:"blur",type:"string"}]},P=b(!1),x=()=>S(this,null,function*(){var s,e;h.value=!0;try{y.value&&y.value.length===2?(u.startDate=y.value[0].format("YYYY-MM-DD"),u.endDate=y.value[1].format("YYYY-MM-DD")):(u.startDate="",u.endDate="");const o={keyword:u.keyword||void 0,role:u.role||void 0,startDate:u.startDate||void 0,endDate:u.endDate||void 0,page:f.current,pageSize:f.pageSize},d=yield Ue(o);Y.value=d.list||[],f.total=((s=d.pagination)==null?void 0:s.total)||0,f.current=((e=d.pagination)==null?void 0:e.current)||1}catch(o){console.error("获取用户列表失败:",o),w.error(`获取用户列表失败: ${o.message||"未知错误"}`),Y.value=[],f.total=0}finally{h.value=!1}}),de=()=>{f.current=1,x()},ue=()=>{Object.assign(u,{keyword:"",role:"",startDate:"",endDate:""}),y.value=void 0,f.current=1,x()},ie=s=>{f.current=s.current,f.pageSize=s.pageSize,x()},me=s=>S(this,null,function*(){try{h.value=!0;const[e,o]=yield Promise.all([Re(s.id),Pe(s.id)]);v.value=e,g.value=o.paymentMethods,V.value=!0}catch(e){console.error("获取用户详情失败:",e),w.error(`获取用户详情失败: ${e.message||"未知错误"}`)}finally{h.value=!1}}),pe=()=>{r.id=0,r.username="",r.password="",r.name="",r.phone="",r.role="user",R.value=!0},ve=s=>{r.id=s.id,r.username=s.username,r.password="",r.name=s.name||"",r.phone=s.phone||"",r.role=s.role,R.value=!0},ce=()=>{R.value=!1},fe=()=>S(this,null,function*(){if(E.value)try{const s=r.id?["username","phone"]:["username","password","phone"];yield E.value.validateFields(s),P.value=!0,r.id?(yield Ie(r.id,{name:r.name,phone:r.phone,role:r.role}),w.success("更新用户成功")):(yield Ye({username:r.username,password:r.password,name:r.name,phone:r.phone,role:r.role}),w.success("创建用户成功")),R.value=!1,x()}catch(s){console.error("保存用户失败:",s),w.error(`保存用户失败: ${s.message||"未知错误"}`)}finally{P.value=!1}}),ye=s=>{A.id=s.id,A.password="",F.value=!0},be=()=>{F.value=!1},ge=()=>S(this,null,function*(){if(Q.value)try{yield Q.value.validateFields(),P.value=!0,yield Fe(A.id,A.password),w.success("重置密码成功"),F.value=!1}catch(s){console.error("重置密码失败:",s),w.error(`重置密码失败: ${s.message||"未知错误"}`)}finally{P.value=!1}}),ke=s=>S(this,null,function*(){try{const e=s.status==="active"?"inactive":"active";yield Se(s.id,e),w.success(`${e==="active"?"启用":"禁用"}用户成功`),x()}catch(e){console.error("更新用户状态失败:",e),w.error(`更新用户状态失败: ${e.message||"未知错误"}`)}}),W=s=>s==="admin"?"管理员":"普通用户",X=s=>s==="admin"?"blue":"green",Z=s=>s==="active"?"正常":"禁用",K=s=>s==="active"?"success":"error",$=s=>s?Ne(s).format("YYYY-MM-DD HH:mm:ss"):"",we=s=>({wechat:"微信",alipay:"支付宝",other:"其他"})[s]||s,_e=s=>({wechat:"green",alipay:"blue",other:"orange"})[s]||"default",he=s=>s?s.replace(/(\d{4})(?=\d)/g,"$1 "):"";return $e(()=>{x()}),(s,e)=>(m(),c("div",null,[t(a(J),{bordered:!1,class:"mb-20"},{default:l(()=>[t(a(H),{model:u,layout:"inline",class:"search-form",onSubmit:Ae(de,["prevent"])},{default:l(()=>[t(a(k),{label:"关键词"},{default:l(()=>[t(a(I),{value:u.keyword,"onUpdate:value":e[0]||(e[0]=o=>u.keyword=o),placeholder:"用户名/姓名/手机号","allow-clear":""},null,8,["value"])]),_:1}),t(a(k),{label:"角色"},{default:l(()=>[t(a(ee),{value:u.role,"onUpdate:value":e[1]||(e[1]=o=>u.role=o),placeholder:"请选择角色",style:{width:"140px"},"allow-clear":""},{default:l(()=>[t(a(T),{value:""},{default:l(()=>e[12]||(e[12]=[n("全部")])),_:1}),t(a(T),{value:"admin"},{default:l(()=>e[13]||(e[13]=[n("管理员")])),_:1}),t(a(T),{value:"user"},{default:l(()=>e[14]||(e[14]=[n("普通用户")])),_:1})]),_:1},8,["value"])]),_:1}),t(a(k),{label:"创建时间"},{default:l(()=>[t(a(O),{value:y.value,"onUpdate:value":e[2]||(e[2]=o=>y.value=o),format:"YYYY-MM-DD",placeholder:["开始日期","结束日期"],style:{width:"240px"}},null,8,["value"])]),_:1}),t(a(k),null,{default:l(()=>[t(a(L),null,{default:l(()=>[t(a(D),{type:"primary","html-type":"submit"},{default:l(()=>e[15]||(e[15]=[n("查询")])),_:1}),t(a(D),{onClick:ue},{default:l(()=>e[16]||(e[16]=[n("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(a(J),{bordered:!1},{default:l(()=>[i("div",Ve,[e[18]||(e[18]=i("div",{class:"table-title"},"用户列表",-1)),i("div",Ee,[t(a(L),null,{default:l(()=>[t(a(D),{type:"primary",onClick:pe},{default:l(()=>e[17]||(e[17]=[n("新增用户")])),_:1}),t(a(xe),{title:"刷新"},{default:l(()=>[t(a(D),{onClick:x},{icon:l(()=>[t(a(ze))]),_:1})]),_:1})]),_:1})])]),t(a(se),{columns:U,"data-source":Y.value,loading:h.value,pagination:f,onChange:ie,"row-key":"id"},{bodyCell:l(({column:o,record:d})=>[o.key==="role"?(m(),z(a(M),{key:0,color:X(d.role)},{default:l(()=>[n(p(W(d.role)),1)]),_:2},1032,["color"])):C("",!0),o.key==="status"?(m(),z(a(M),{key:1,color:K(d.status)},{default:l(()=>[n(p(Z(d.status)),1)]),_:2},1032,["color"])):C("",!0),o.key==="createdAt"?(m(),c(B,{key:2},[n(p($(d.createdAt)),1)],64)):C("",!0),o.key==="action"?(m(),z(a(L),{key:3},{default:l(()=>[t(a(D),{type:"link",onClick:()=>me(d)},{default:l(()=>e[19]||(e[19]=[n(" 详情 ")])),_:2},1032,["onClick"]),t(a(D),{type:"link",onClick:()=>ve(d)},{default:l(()=>e[20]||(e[20]=[n(" 编辑 ")])),_:2},1032,["onClick"]),t(a(D),{type:"link",onClick:()=>ye(d)},{default:l(()=>e[21]||(e[21]=[n(" 重置密码 ")])),_:2},1032,["onClick"]),t(a(Be),{title:`确定${d.status==="active"?"禁用":"启用"}该用户吗？`,onConfirm:()=>ke(d),"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[t(a(D),{type:"link",danger:d.status==="active"},{default:l(()=>[n(p(d.status==="active"?"禁用":"启用"),1)]),_:2},1032,["danger"])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):C("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),t(a(j),{visible:V.value,"onUpdate:visible":e[3]||(e[3]=o=>V.value=o),title:"用户详情",width:"1000px",footer:null,"mask-closable":!0},{default:l(()=>[v.value?(m(),c("div",Qe,[t(a(qe),{"default-active-key":"basic",type:"card"},{default:l(()=>[t(a(le),{key:"basic",tab:"基本信息"},{default:l(()=>{var o,d;return[t(a(oe),{title:"基本信息",bordered:"",column:2},{default:l(()=>[t(a(_),{label:"ID"},{default:l(()=>[n(p(v.value.id),1)]),_:1}),t(a(_),{label:"用户名"},{default:l(()=>[n(p(v.value.username),1)]),_:1}),t(a(_),{label:"姓名"},{default:l(()=>[n(p(v.value.name||"-"),1)]),_:1}),t(a(_),{label:"手机号"},{default:l(()=>[n(p(v.value.phone||"-"),1)]),_:1}),t(a(_),{label:"角色"},{default:l(()=>[t(a(M),{color:X(v.value.role)},{default:l(()=>[n(p(W(v.value.role)),1)]),_:1},8,["color"])]),_:1}),t(a(_),{label:"状态"},{default:l(()=>[t(a(M),{color:K(v.value.status)},{default:l(()=>[n(p(Z(v.value.status)),1)]),_:1},8,["color"])]),_:1}),t(a(_),{label:"创建时间"},{default:l(()=>[n(p($(v.value.createdAt)),1)]),_:1}),t(a(_),{label:"更新时间"},{default:l(()=>[n(p($(v.value.updatedAt)),1)]),_:1})]),_:1}),t(a(ae)),t(a(oe),{title:"统计信息",bordered:"",column:1},{default:l(()=>[t(a(_),{label:"订单数量"},{default:l(()=>{var N;return[n(p(((N=v.value.stats)==null?void 0:N.orderCount)||0),1)]}),_:1})]),_:1}),(d=(o=v.value.stats)==null?void 0:o.recentOrders)!=null&&d.length?(m(),c("div",He,[e[22]||(e[22]=i("h3",null,"最近订单",-1)),t(a(se),{columns:[{title:"订单号",dataIndex:"orderNo",key:"orderNo"},{title:"金额",dataIndex:"totalAmount",key:"totalAmount"},{title:"状态",dataIndex:"status",key:"status"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt"}],"data-source":v.value.stats.recentOrders,pagination:!1,"row-key":"id"},{bodyCell:l(({column:N,record:De})=>[N.key==="createdAt"?(m(),c(B,{key:0},[n(p($(De.createdAt)),1)],64)):C("",!0)]),_:1},8,["data-source"])])):C("",!0)]}),_:1}),t(a(le),{key:"payment",tab:"付款方式"},{default:l(()=>[g.value?(m(),c("div",Le,[i("div",je,[e[24]||(e[24]=i("h3",null,"二维码付款方式",-1)),g.value.qrCodes&&g.value.qrCodes.length>0?(m(),c("div",Je,[(m(!0),c(B,null,te(g.value.qrCodes,(o,d)=>(m(),c("div",{key:`qr-${d}`,class:"qr-code-item"},[i("div",Ge,[t(a(M),{color:_e(o.type)},{default:l(()=>[n(p(we(o.type)),1)]),_:2},1032,["color"]),i("span",We,p(o.name),1)]),i("div",Xe,[t(a(Oe),{src:o.imageUrl,alt:o.name,width:200,height:200,preview:!0},null,8,["src","alt"])])]))),128))])):(m(),c("div",Ze,e[23]||(e[23]=[i("p",null,"暂无二维码付款方式",-1)])))]),t(a(ae)),i("div",Ke,[e[26]||(e[26]=i("h3",null,"银行卡付款方式",-1)),g.value.bankCards&&g.value.bankCards.length>0?(m(),c("div",ea,[(m(!0),c(B,null,te(g.value.bankCards,(o,d)=>(m(),c("div",{key:`bank-${d}`,class:"bank-card-item"},[t(a(J),{size:"small",bordered:!0},{default:l(()=>[i("div",aa,[i("div",ta,[i("span",la,p(o.bankName),1)]),i("div",sa,[i("span",oa,p(he(o.cardNumber)),1)]),i("div",ra,[i("span",na,"户名："+p(o.accountName),1)])])]),_:2},1024)]))),128))])):(m(),c("div",da,e[25]||(e[25]=[i("p",null,"暂无银行卡付款方式",-1)])))])])):(m(),c("div",ua,e[27]||(e[27]=[i("p",null,"暂无付款方式信息",-1)])))]),_:1})]),_:1})])):C("",!0)]),_:1},8,["visible"]),t(a(j),{visible:R.value,"onUpdate:visible":e[9]||(e[9]=o=>R.value=o),title:r.id?"编辑用户":"新增用户",onOk:fe,"confirm-loading":P.value,onCancel:ce,"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[t(a(H),{ref_key:"editFormRef",ref:E,model:r,rules:re,"label-col":{span:4},"wrapper-col":{span:20}},{default:l(()=>[t(a(k),{label:"用户名",name:"username"},{default:l(()=>[t(a(I),{value:r.username,"onUpdate:value":e[4]||(e[4]=o=>r.username=o),placeholder:"请输入用户名",disabled:!!r.id},null,8,["value","disabled"])]),_:1}),r.id?C("",!0):(m(),z(a(k),{key:0,label:"密码",name:"password"},{default:l(()=>[t(a(I).Password,{value:r.password,"onUpdate:value":e[5]||(e[5]=o=>r.password=o),placeholder:"请输入密码"},null,8,["value"])]),_:1})),t(a(k),{label:"姓名",name:"name"},{default:l(()=>[t(a(I),{value:r.name,"onUpdate:value":e[6]||(e[6]=o=>r.name=o),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),t(a(k),{label:"手机号",name:"phone"},{default:l(()=>[t(a(I),{value:r.phone,"onUpdate:value":e[7]||(e[7]=o=>r.phone=o),placeholder:"请输入手机号"},null,8,["value"])]),_:1}),t(a(k),{label:"角色",name:"role"},{default:l(()=>[t(a(ee),{value:r.role,"onUpdate:value":e[8]||(e[8]=o=>r.role=o)},{default:l(()=>[t(a(T),{value:"admin"},{default:l(()=>e[28]||(e[28]=[n("管理员")])),_:1}),t(a(T),{value:"user"},{default:l(()=>e[29]||(e[29]=[n("普通用户")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","confirm-loading"]),t(a(j),{visible:F.value,"onUpdate:visible":e[11]||(e[11]=o=>F.value=o),title:"重置密码",onOk:ge,"confirm-loading":P.value,onCancel:be,"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[t(a(H),{ref_key:"resetPasswordFormRef",ref:Q,model:A,rules:ne,"label-col":{span:4},"wrapper-col":{span:20}},{default:l(()=>[t(a(k),{label:"新密码",name:"password"},{default:l(()=>[t(a(I).Password,{value:A.password,"onUpdate:value":e[10]||(e[10]=o=>A.password=o),placeholder:"请输入新密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])]))}}),wa=Te(ia,[["__scopeId","data-v-bd3bcc12"]]);export{wa as default};
